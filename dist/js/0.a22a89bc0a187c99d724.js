webpackJsonp([0],Array(87).concat([function(e,t,i){var o;!function(r,n){"use strict";void 0!==(o=function(){var e=n(r);return r.Seriously||(r.Seriously=e),e}.call(t,i,t,e))&&(e.exports=o)}(window,function(e){"use strict";function t(e,t){var i=void 0,o=void 0;if("string"==typeof e)i=E.querySelector(e);else if(!e)return!1;return e.tagName&&(i=e),i?(o=i.tagName.toLowerCase(),t&&t.indexOf(o)<0?e:i):e}function i(e,t){var o=void 0,r=void 0;e.prototype&&t.prototype&&e.prototype!==t.prototype&&i(e.prototype,t.prototype);for(o in t)t.hasOwnProperty(o)&&(r=Object.getOwnPropertyDescriptor(t,o),r.get||r.set?Object.defineProperty(e,o,{configurable:!0,enumerable:!0,get:r.get,set:r.set}):e[o]=t[o]);return e}function o(e){var t=void 0;if(!C)return O;if("function"==typeof C[e])t=C[e];else{if("function"!=typeof C.log)return O;t=C.log}return t.bind?t.bind(C):function(){t.apply(C,arguments)}}function r(t,i){if(i||(i="HTMLElement"),t instanceof e[i])return!0;if(!t||"object"!=typeof t)return!1;for(;t;)if((t=Object.getPrototypeOf(t))&&t.constructor.name===i)return!0;return!1}function n(e,t,i,o,r){function n(e,t,i){return i%=1,i<0&&(i+=1),i<1/6?e+(t-e)*i*6:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}var s=void 0,a=void 0;return a=i<.5?i*(t+1):i+t-i*t,s=2*i-a,r||(r=[]),r[0]=n(s,a,e+1/3),r[1]=n(s,a,e),r[2]=n(s,a,e-1/3),r[3]=o,r}function s(e){var t=void 0,i=void 0,o=void 0,r="#",n=e[3]<1?4:3;for(t=0;t<n;t++)i=Math.min(255,Math.round(255*e[t]||0)),o=i.toString(16),i<16&&(o="0"+o),r+=o;return r}function a(e){return Array.isArray(e)||e&&e.BYTES_PER_ELEMENT&&"length"in e}function u(t){function i(){B.length&&B.shift()()}if("function"!=typeof t)throw new Error("setTimeoutZero argument is not a function");if(B.push(t),"file:"===e.location.protocol)return void setTimeout(i,0);e.postMessage("seriously-timeout-message",e.location)}function l(t,i){var o=void 0;try{o=e.WebGLDebugUtils&&i&&i.debugContext?e.WebGLDebugUtils.makeDebugContext(t.getContext("webgl",i)):t.getContext("webgl",i)}catch(e){}if(!o)try{o=t.getContext("experimental-webgl",i)}catch(e){}return o}function c(){var t=void 0;return v&&v.getError()===v.CONTEXT_LOST_WEBGL&&(v=void 0),v||!e.WebGLRenderingContext||x?v:(t=E.createElement("canvas"),v=l(t),v?t.addEventListener("webglcontextlost",function e(i){i.preventDefault(),v&&v.canvas===this&&(v=void 0,t.removeEventListener("webglcontextlost",e,!1))},!1):p.logger.warn("Unable to access WebGL."),v)}function f(i){var o=void 0,r=void 0,n=void 0,s=void 0;if(!(o=t(i,["img","canvas","video"])))return!1;if(!(r=E.createElement("canvas")))return p.logger.warn("Browser does not support canvas or Seriously.js"),!1;if(0===o.naturalWidth&&"IMG"===o.tagName)return p.logger.warn("Image not loaded"),!1;if(0===o.readyState&&0===o.videoWidth&&"VIDEO"===o.tagName)return p.logger.warn("Video not loaded"),!1;if(n=c()){s=n.createTexture(),s||p.logger.error("Test WebGL context has been lost"),n.bindTexture(n.TEXTURE_2D,s);try{n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,o)}catch(t){return t.code===e.DOMException.SECURITY_ERR?p.logger.log("Unable to access cross-domain image"):p.logger.error("Error storing image to texture: "+t.message),n.deleteTexture(s),!1}n.deleteTexture(s)}else{n=r.getContext("2d");try{n.drawImage(o,0,0),n.getImageData(0,0,1,1)}catch(t){return t.code===e.DOMException.SECURITY_ERR?p.logger.log("Unable to access cross-domain image"):p.logger.error("Error drawing image to canvas: "+t.message),!1}}return!0}function d(e){function t(e,t){var i=void 0,n=void 0;a(e)?(i=e[0],n=e[1]||i):i=e,"string"==typeof i?i=i.toLowerCase():"number"==typeof i?i=String(i):i||(i=""),r[i]=n,t||(o.firstValue=i)}function i(e){return e}var o=void 0,r=void 0,n=void 0;for(n in e.inputs)if(e.inputs.hasOwnProperty(n)){if(e.reserved.indexOf(n)>=0||Object.prototype[n])throw new Error("Reserved input name: "+n);o=e.inputs[n],o.name=n,isNaN(o.min)&&(o.min=-1/0),isNaN(o.max)&&(o.max=1/0),isNaN(o.minCount)&&(o.minCount=-1/0),isNaN(o.maxCount)&&(o.maxCount=1/0),isNaN(o.step)&&(o.step=0),isNaN(o.mod)&&(o.mod=0),"enum"===o.type&&o.options&&a(o.options)&&o.options.length&&(r={},o.options.forEach(t),o.options=r),"vector"===o.type?o.dimensions<2?o.dimensions=2:o.dimensions>4?o.dimensions=4:!o.dimensions||isNaN(o.dimensions)?o.dimensions=4:o.dimensions=Math.round(o.dimensions):o.dimensions=1,o.shaderDirty=!!o.shaderDirty,"function"!=typeof o.validate&&(o.validate=p.inputValidators[o.type]||i),e.defaultImageInput||"image"!==o.type||(e.defaultImageInput=n)}}function h(e,t,i,o){var r=void 0,n=void 0,s=void 0,a=void 0,u=!0===o?o:o&&o.useFloat;u=!1,this.type=u?e.FLOAT:e.UNSIGNED_BYTE,r=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,r),o&&o.texture?(this.texture=o.texture,e.bindTexture(e.TEXTURE_2D,this.texture),this.ownTexture=!1):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.ownTexture=!0);try{this.type===e.FLOAT?(s=new Float32Array(t*i*4),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.FLOAT,s)):(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,null),this.type=e.UNSIGNED_BYTE)}catch(o){this.type=e.UNSIGNED_BYTE,s=new Uint8Array(t*i*4),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,i,0,e.RGBA,e.UNSIGNED_BYTE,s)}if(n=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,n),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,i),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),(a=e.checkFramebufferStatus(e.FRAMEBUFFER))===e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT)throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");if(a===e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT)throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");if(a===e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS)throw new Error("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");if(a===e.FRAMEBUFFER_UNSUPPORTED)throw new Error("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");if(a!==e.FRAMEBUFFER_COMPLETE)throw new Error("Incomplete framebuffer: "+a);e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this.gl=e,this.frameBuffer=r,this.renderBuffer=n,this.width=t,this.height=i}function m(e,t,i){function o(t,i){var o=void 0,r=void 0;if(o=i?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER),e.shaderSource(o,t),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS)){for(t=t.split(/[\n\r]/),r=0;r<t.length;r++)t[r]=r+1+":\t"+t[r];throw t.unshift("Error compiling "+(i?"fragment":"vertex")+" shader:"),p.logger.error(t.join("\n")),new Error("Shader error: "+e.getShaderInfoLog(o))}return o}var r=void 0,n=void 0,s=void 0,a="",u=void 0,l=void 0,c=void 0,f=void 0,d=void 0;if(n=o(t),s=o(i,!0),r=e.createProgram(),e.attachShader(r,n),u=e.getShaderInfoLog(n),u&&(a+="Vertex shader error: "+u+"\n"),e.attachShader(r,s),u=e.getShaderInfoLog(s),u&&(a+="Fragment shader error: "+u+"\n"),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw a+=e.getProgramInfoLog(r),e.deleteProgram(r),e.deleteShader(n),e.deleteShader(s),f=H.exec(t)||H.exec(i),f&&(a="Shader = "+f[1]+"\n"+a),G.forEach(function(t){a+="\n"+t+": "+e.getParameter(e[t])}),new Error("Could not initialize shader:\n"+a);for(e.useProgram(r),this.uniforms={},c=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),l=0;l<c;++l)d={info:e.getActiveUniform(r,l)},d.name=d.info.name.replace(/\[0\]$/,""),d.loc=e.getUniformLocation(r,d.name),d.set=function(t,i){if(t.type===e.SAMPLER_2D)return function(o){t.glTexture=e["TEXTURE"+o],e.uniform1i(i,o)};if(t.type===e.BOOL||t.type===e.INT)return t.size>1?function(t){e.uniform1iv(i,t)}:function(t){e.uniform1i(i,t)};if(t.type===e.FLOAT)return t.size>1?function(t){e.uniform1fv(i,t)}:function(t){e.uniform1f(i,t)};if(t.type===e.FLOAT_VEC2)return function(t){e.uniform2f(i,t[0],t[1])};if(t.type===e.FLOAT_VEC3)return function(t){e.uniform3f(i,t[0],t[1],t[2])};if(t.type===e.FLOAT_VEC4)return function(t){e.uniform4f(i,t[0],t[1],t[2],t[3])};if(t.type===e.FLOAT_MAT3)return function(t){e.uniformMatrix3fv(i,!1,t)};if(t.type===e.FLOAT_MAT4)return function(t){e.uniformMatrix4fv(i,!1,t)};throw new Error("Unknown shader uniform type: "+t.type)}(d.info,d.loc),d.get=function(t){return function(){return e.getUniform(r,t)}}(d.loc),this.uniforms[d.name]=d,this[d.name]||(this[d.name]=d);for(this.attributes={},this.location={},c=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),l=0;l<c;++l)d={info:e.getActiveAttrib(r,l)},d.name=d.info.name,d.location=e.getAttribLocation(r,d.name),this.attributes[d.name]=d,this.location[d.name]=d.location;this.gl=e,this.program=r,this.destroy=function(){var t=void 0;e&&(e.deleteProgram(r),e.deleteShader(n),e.deleteShader(s));for(t in this)this.hasOwnProperty(t)&&delete this[t];r=null,n=null,s=null}}function p(o){function n(e,t){var i=void 0,o=void 0,r=void 0;return!!t&&(i=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e.vertices,t.STATIC_DRAW),i.size=3,o=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.indices,t.STATIC_DRAW),r=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,e.coords,t.STATIC_DRAW),r.size=2,{vertex:i,index:o,texCoord:r,length:e.indices.length,mode:e.mode||t.TRIANGLES})}function a(e){var t={};return t.vertices=new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),t.indices=new Uint16Array([0,1,2,0,2,3]),t.coords=new Float32Array([0,0,1,0,1,1,0,1]),n(t,e)}function c(e){var t=void 0,i=void 0;if(!te){if(e.canvas.addEventListener("webglcontextlost",v,!1),e.canvas.addEventListener("webglcontextrestored",f,!1),e.isContextLost())return void p.logger.warn("Unable to attach lost WebGL context. Will try again when context is restored.");for(te=e,ee=e.canvas,oe=a(te),ne=new m(te,"#define SHADER_NAME seriously.base\n"+w,"#define SHADER_NAME seriously.base\n"+T),t=0;t<Y.length;t++)i=Y[t],i.gl=te,i.initialize(),i.buildShader();for(t=0;t<U.length;t++)i=U[t],i.initialize();for(t=0;t<I.length;t++)i=I[t],i.model||(i.model=oe,i.shader=ne)}}function f(){var e=void 0,t=void 0,i=void 0,o=void 0;if(ie&&!te){if(t=ie.target,r(t,"WebGLFramebuffer"))return void p.logger.error("Unable to restore target built on WebGLFramebuffer");if(e=l(t,{alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:ie.debugContext})){if(e.isContextLost())return void p.logger.error("Unable to restore WebGL Context");for(c(e),ie.renderToTexture?ie.frameBuffer=new h(te,ie.width,ie.height,!1):ie.frameBuffer={frameBuffer:null},i=0;i<N.length;i++)o=N[i],o.setDirty(),o.emit("webglcontextrestored");p.logger.log("WebGL context restored")}}}function v(e){var t=void 0,i=void 0;for(e&&(p.logger.warn("WebGL context lost"),e.preventDefault()),ge&&(q(ge),ge=0),ee&&ee.removeEventListener("webglcontextlost",v,!1),t=0;t<Y.length;t++)i=Y[t],i.gl=null,i.initialized=!1,i.baseShader=null,i.model=null,i.frameBuffer=null,i.texture=null,i.shader&&i.shader.destroy&&(i.shader.destroy(),i.effect.commonShader&&delete re[i.hook]),i.shaderDirty=!0,i.shader=null,i.effect.lostContext&&i.effect.lostContext.call(i),e&&i.emit("webglcontextlost");for(t=0;t<U.length;t++)i=U[t],i.texture=null,i.initialized=!1,i.allowRefresh=!1,e&&i.emit("webglcontextlost");for(t=0;t<G.length;t++)i=G[t],i.frameBuffer=null,i.texture=null,e&&i.emit("webglcontextlost");for(t=0;t<I.length;t++)i=I[t],i.model=!1,i.frameBuffer=null,e&&i.emit("webglcontextlost");ne&&ne.destroy&&ne.destroy(),te&&(te.deleteBuffer(oe.vertex),te.deleteBuffer(oe.texCoord),te.deleteBuffer(oe.index)),oe&&(delete oe.vertex,delete oe.texCoord,delete oe.index),oe=null,ne=null,te=null,ee=null}function g(e){var t=void 0,i=void 0,o=!1;if(ge=0,J.length)for(o=!0,t=0;t<J.length;t++)J[t].call(A,e);if(U&&U.length)for(o=!0,t=0;t<U.length;t++)i=U[t],(i.dirty||i.checkDirty&&i.checkDirty())&&(i.dirty=!1,i.setDirty());for(t=0;t<I.length;t++)i=I[t],i.auto&&i.dirty&&i.render();if(Q.length)for(o=!0,t=0;t<Q.length;t++)Q[t].call(A);o&&!ge&&(ge=W(g))}function x(e,t,i,o,n,s){var a=0,u=void 0,l=void 0,c=void 0,f=void 0,d=void 0,h=n&&n.gl||te,m=void 0,p=void 0,v=void 0,g=void 0;if(h){n?(f=s&&s.width||n.width||h.canvas.width,d=s&&s.height||n.height||h.canvas.height):(f=s&&s.width||h.canvas.width,d=s&&s.height||h.canvas.height),e.use(),h.viewport(0,0,f,d),h.bindFramebuffer(h.FRAMEBUFFER,o),h.enableVertexAttribArray(e.location.position),h.enableVertexAttribArray(e.location.texCoord),t.texCoord&&(h.bindBuffer(h.ARRAY_BUFFER,t.texCoord),h.vertexAttribPointer(e.location.texCoord,t.texCoord.size,h.FLOAT,!1,0,0)),h.bindBuffer(h.ARRAY_BUFFER,t.vertex),h.vertexAttribPointer(e.location.position,t.vertex.size,h.FLOAT,!1,0,0),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,t.index),s&&s.depth?te.enable(te.DEPTH_TEST):te.disable(te.DEPTH_TEST),s?void 0===s.blend||s.blend?(te.enable(te.BLEND),m=void 0===s.srcRGB?te.ONE:s.srcRGB,v=s.dstRGB||te.ZERO,p=void 0===s.srcAlpha?m:s.srcAlpha,g=void 0===s.dstAlpha?v:s.dstAlpha,te.blendFuncSeparate(m,v,p,g),te.blendEquation(s.blendEquation||te.FUNC_ADD)):te.disable(te.BLEND):(te.enable(te.BLEND),te.blendFunc(te.ONE,te.ZERO),te.blendEquation(te.FUNC_ADD));for(u in i)i.hasOwnProperty(u)&&(l=i[u],(c=e.uniforms[u])&&(r(l,"WebGLTexture")?(h.activeTexture(h.TEXTURE0+a),h.bindTexture(h.TEXTURE_2D,l),c.set(a),a++):l instanceof ae||l instanceof ue||l instanceof le?l.texture&&(h.activeTexture(h.TEXTURE0+a),h.bindTexture(h.TEXTURE_2D,l.texture),c.set(a),a++):void 0!==l&&null!==l&&c.set(l)));s&&void 0!==s.clear&&!s.clear||(h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT)),h.drawElements(t.mode,t.length,h.UNSIGNED_SHORT,0),te.enable(te.DEPTH_TEST)}}function b(e,i,o){var r=void 0,n=void 0;if(("string"!=typeof e||!i&&0!==i)&&(o&&"object"==typeof o||(o=i),i=e),"string"==typeof e&&D[e]||(e=null),i instanceof ae||i instanceof ue||i instanceof le)r=i;else if(i instanceof fe||i instanceof de||i instanceof he){if(!(r=j[i.id]))throw new Error("Cannot connect a foreign node")}else{for("string"==typeof i&&isNaN(i)&&(i=t(i,["canvas","img","video"])),n=0;n<U.length;n++)if(r=U[n],(!e||e===r.hook)&&r.compare&&r.compare(i,o))return r;r=new ae(e,i,o)}return r}function C(e,t){var i=void 0,o=void 0,r=void 0;if(!(e instanceof ue||e instanceof le))return!1;if(e===t)return!0;r=e.sources;for(i in r)if(r.hasOwnProperty(i)&&((o=r[i])===t||C(o,t)))return!0;return!1}if(e===this||!(this instanceof p)||void 0!==this.id)return new p(o);var B=++L,A=this,N=[],j={},V=0,U=[],I=[],G=[],Y=[],K={},J=[],Q=[],$={},ee=void 0,te=void 0,ie=void 0,oe=void 0,re={},ne=void 0,se=void 0,ae=void 0,ue=void 0,le=void 0,ce=void 0,fe=void 0,de=void 0,he=void 0,me=void 0,pe=!1,ve=!1,ge=void 0;se=function(){this.ready=!1,this.width=1,this.height=1,this.gl=te,this.uniforms={resolution:[this.width,this.height],transform:null},this.dirty=!0,this.isDestroyed=!1,this.seriously=A,this.listeners={},this.id=V,V++},se.prototype.setReady=function(){var e=void 0;if(!this.ready&&(this.ready=!0,this.emit("ready"),this.targets))for(e=0;e<this.targets.length;e++)this.targets[e].setReady()},se.prototype.setUnready=function(){var e=void 0;if(this.ready&&(this.ready=!1,this.emit("unready"),this.targets))for(e=0;e<this.targets.length;e++)this.targets[e].setUnready()},se.prototype.setDirty=function(){var e=void 0;if(!this.dirty&&(this.emit("dirty"),this.dirty=!0,this.targets))for(e=0;e<this.targets.length;e++)this.targets[e].setDirty()},se.prototype.initFrameBuffer=function(e){te&&(this.frameBuffer=new h(te,this.width,this.height,e))},se.prototype.readPixels=function(e,t,i,o,n){var s=this.gl||te;if(!te)throw new Error("Cannot read pixels until a canvas is connected");if(this.frameBuffer||(this.initFrameBuffer(),this.setDirty()),this.render(),void 0===n)n=new Uint8Array(i*o*4);else if(!r(n,"Uint8Array"))throw new Error("Incompatible array type");return s.bindFramebuffer(te.FRAMEBUFFER,this.frameBuffer.frameBuffer),s.readPixels(e,t,i,o,te.RGBA,te.UNSIGNED_BYTE,n),n},se.prototype.resize=function(){var e=void 0,t=void 0;this.source?(e=this.source.width,t=this.source.height):this.sources&&this.sources.source?(e=this.sources.source.width,t=this.sources.source.height):this.inputs&&this.inputs.width?(e=this.inputs.width,t=this.inputs.height||e):this.inputs&&this.inputs.height?e=t=this.inputs.height:(e=1,t=1),e=Math.floor(e),t=Math.floor(t),this.width===e&&this.height===t||(this.width=e,this.height=t,this.emit("resize"),this.setDirty()),this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=e,this.uniforms.resolution[1]=t),this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(e,t)},se.prototype.on=function(e,t){var i=void 0,o=-1;e&&"function"==typeof t&&(i=this.listeners[e],i?o=i.indexOf(t):i=this.listeners[e]=[],o<0&&i.push(t))},se.prototype.off=function(e,t){var i=void 0,o=-1;e&&"function"==typeof t&&(i=this.listeners[e])&&(o=i.indexOf(t))>=0&&i.splice(o,1)},se.prototype.emit=function(e){var t=void 0,i=this.listeners[e];if(i&&i.length)for(t=0;t<i.length;t++)u(i[t])},se.prototype.destroy=function(){var e=void 0,t=void 0;delete this.gl,delete this.seriously;for(t in this.listeners)this.listeners.hasOwnProperty(t)&&delete this.listeners[t];for(e in this.uniforms)this.uniforms.hasOwnProperty(e)&&delete this.uniforms[e];this.targets&&delete this.targets,this.frameBuffer&&this.frameBuffer.destroy&&(this.frameBuffer.destroy(),delete this.frameBuffer),e=N.indexOf(this),e>=0&&N.splice(e,1),delete j[this.id],this.isDestroyed=!0},fe=function(e){function o(e,i){var o=void 0,n=void 0,u=void 0;return u=a.effect.inputs[e],o=a.inputElements[e],"string"==typeof i&&isNaN(i)&&("enum"===u.type?u.options.hasOwnProperty(i)||(i=t(i,["select"])):"number"===u.type||"boolean"===u.type?i=t(i,["input","select"]):"image"===u.type&&(i=t(i,["canvas","img","video"]))),r(i,"HTMLInputElement")||r(i,"HTMLSelectElement")?(n=i.value,o&&o.element!==i&&(o.element.removeEventListener("change",o.listener,!0),o.element.removeEventListener("input",o.listener,!0),delete a.inputElements[e],o=null),o||(o={element:i,listener:function(e,t){return function(){var o=void 0,r=void 0;o="checkbox"===i.type?i.checked:t.value,r=a.setInput(e,o),"color"===u.type&&(r=s(r).substr(0,7)),r!==o&&(t.value=r)}}(e,i)},a.inputElements[e]=o,"range"===i.type?(i.addEventListener("input",o.listener,!0),i.addEventListener("change",o.listener,!0)):i.addEventListener("change",o.listener,!0)),o&&"checkbox"===i.type&&(n=i.checked)):(o&&(o.element.removeEventListener("change",o.listener,!0),o.element.removeEventListener("input",o.listener,!0),delete a.inputElements[e]),n=i),a.setInput(e,n),a.inputs[e]}var n=void 0,a=e;for(n in a.effect.inputs)if(a.effect.inputs.hasOwnProperty(n)){if(void 0!==this[n])throw new Error("Cannot overwrite Seriously."+n);"image"===a.effect.inputs[n].type?Object.defineProperty(this,n,{configurable:!0,enumerable:!0,get:function(e){return function(){var t=a.inputs[e];return t&&t.pub}}(n),set:function(e){return function(t){var i=o(e,t);return i&&i.pub}}(n)}):Object.defineProperty(this,n,{configurable:!0,enumerable:!0,get:function(e){return function(){return a.inputs[e]}}(n),set:function(e){return function(t){return o(e,t)}}(n)})}Object.defineProperties(this,{effect:{enumerable:!0,configurable:!0,get:function(){return a.hook}},title:{enumerable:!0,configurable:!0,get:function(){return a.effect.title||a.hook}},width:{enumerable:!0,configurable:!0,get:function(){return a.width}},height:{enumerable:!0,configurable:!0,get:function(){return a.height}},id:{enumerable:!0,configurable:!0,get:function(){return a.id}}}),this.render=function(){return a.render(),this},this.readPixels=function(e,t,i,o,r){return a.readPixels(e,t,i,o,r)},this.on=function(e,t){a.on(e,t)},this.off=function(e,t){a.off(e,t)},this.inputs=function(e){var t=void 0,o=void 0,r=void 0,n=void 0;if(r=a.effect.inputs,e)return(o=r[e])?(t={type:o.type,defaultValue:o.defaultValue,title:o.title||e},"number"===o.type?(t.min=o.min,t.max=o.max,t.step=o.step,t.mod=o.mod):"enum"===o.type?t.options=i({},o.options):"vector"===o.type&&(t.dimensions=o.dimensions),o.description&&(t.description=o.description),t):null;t={};for(n in r)r.hasOwnProperty(n)&&(t[n]=this.inputs(n));return t},this.alias=function(e,t){return a.alias(e,t),this},this.matte=function(e){a.matte(e)},this.destroy=function(){var e=void 0,t=void 0;a.destroy();for(e in this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&(t=Object.getOwnPropertyDescriptor(this,e),t.get||t.set||"function"!=typeof this[e]?delete this[e]:this[e]=O)},this.isDestroyed=function(){return a.isDestroyed},this.isReady=function(){return a.ready}},ue=function(e,t){var o=void 0,r=void 0,n=void 0,s=void 0,a={};se.call(this,t),this.gl=te,this.effectRef=R[e],this.sources={},this.targets=[],this.inputElements={},this.dirty=!0,this.shaderDirty=!0,this.hook=e,this.options=t,this.transform=null,this.effect=i({},this.effectRef),this.effectRef.definition&&i(this.effect,this.effectRef.definition.call(this,t)),d(this.effect),this.uniforms.transform=y,this.inputs={},s=$[e];for(o in this.effect.inputs)this.effect.inputs.hasOwnProperty(o)&&(r=this.effect.inputs[o],void 0!==r.defaultValue&&null!==r.defaultValue||("number"===r.type?r.defaultValue=Math.min(Math.max(0,r.min),r.max):"color"===r.type?r.defaultValue=[0,0,0,0]:"boolean"===r.type?r.defaultValue=!1:"string"===r.type?r.defaultValue="":"enum"===r.type&&(r.defaultValue=r.firstValue)),n=r.validate.call(this,r.defaultValue,r),s&&void 0!==s[o]&&(n=r.validate.call(this,s[o],r,r.defaultValue,n),s[o]=n,"image"===r.type&&(a[o]=n)),this.inputs[o]=n,r.uniform&&(this.uniforms[r.uniform]=r.defaultValue));te&&(this.initialize(),this.effect.commonShader&&this.buildShader()),this.updateReady(),this.inPlace=this.effect.inPlace,this.pub=new fe(this),N.push(this),j[this.id]=this,Y.push(this),_[e].push(this);for(o in a)a.hasOwnProperty(o)&&this.setInput(o,a[o])},ue.prototype=Object.create(se.prototype),ue.prototype.constructor=ue,ue.prototype.initialize=function(){if(!this.initialized){var e=this;this.baseShader=ne,this.shape?this.model=n(this.shape,this.gl):this.model=oe,"function"==typeof this.effect.initialize?this.effect.initialize.call(this,function(){e.initFrameBuffer(!0)},te):this.initFrameBuffer(!0),this.frameBuffer&&(this.texture=this.frameBuffer.texture),this.initialized=!0}},ue.prototype.resize=function(){var e=void 0;for(se.prototype.resize.call(this),this.effect.resize&&this.effect.resize.call(this),e=0;e<this.targets.length;e++)this.targets[e].resize()},ue.prototype.updateReady=function(){var e=void 0,t=void 0,i=void 0,o=void 0,r=!0,n=void 0;o=this.effect;for(i in o.inputs)if(o.inputs.hasOwnProperty(i)&&(t=this.effect.inputs[i],"image"===t.type&&(!this.sources[i]||!this.sources[i].ready)&&(!o.requires||o.requires.call(this,i,this.inputs)))){r=!1;break}if(this.ready!==r&&(this.ready=r,this.emit(r?"ready":"unready"),n=r?"setReady":"setUnready",this.targets))for(e=0;e<this.targets.length;e++)this.targets[e][n]()},ue.prototype.setReady=ue.prototype.updateReady,ue.prototype.setUnready=ue.prototype.updateReady,ue.prototype.addTarget=function(e){var t=void 0;for(t=0;t<this.targets.length;t++)if(this.targets[t]===e)return;this.targets.push(e)},ue.prototype.removeTarget=function(e){var t=this.targets&&this.targets.indexOf(e);t>=0&&this.targets.splice(t,1)},ue.prototype.removeSource=function(e){var t=void 0,i=e&&e.pub;for(t in this.inputs)!this.inputs.hasOwnProperty(t)||this.inputs[t]!==e&&this.inputs[t]!==i||(this.inputs[t]=null);for(t in this.sources)!this.sources.hasOwnProperty(t)||this.sources[t]!==e&&this.sources[t]!==i||(this.sources[t]=null)},ue.prototype.buildShader=function(){function e(e){return H.test(e)?e:"#define SHADER_NAME seriously."+o.hook+"\n"+e}var t=void 0,i=this.effect,o=this;this.shaderDirty&&(i.commonShader&&re[this.hook]?(this.shader||re[this.hook].count++,this.shader=re[this.hook].shader):i.shader?(this.shader&&!i.commonShader&&this.shader.destroy(),t=i.shader.call(this,this.inputs,{vertex:w,fragment:T},p.util),t instanceof m?this.shader=t:t&&t.vertex&&t.fragment?this.shader=new m(te,e(t.vertex),e(t.fragment)):this.shader=ne,i.commonShader&&(re[this.hook]={count:1,shader:this.shader})):this.shader=ne,this.shaderDirty=!1)},ue.prototype.render=function(){function e(e,t,i,o,n,s){x(e,t,i,o,n||r,s)}var t=void 0,i=void 0,o=this.effect,r=this,n=void 0;if(te){if(this.initialized||this.initialize(),this.shaderDirty&&this.buildShader(),this.dirty&&this.ready){for(t in this.sources)!this.sources.hasOwnProperty(t)||o.requires&&!o.requires.call(this,t,this.inputs)||(n="function"==typeof this.inPlace?this.inPlace(t):this.inPlace,this.sources[t].render(!n));this.frameBuffer&&(i=this.frameBuffer.frameBuffer),"function"==typeof o.draw?(o.draw.call(this,this.shader,this.model,this.uniforms,i,e),this.emit("render")):i&&(x(this.shader,this.model,this.uniforms,i,this),this.emit("render")),this.dirty=!1}return this.texture}},ue.prototype.setInput=function(e,t){var i=void 0,o=void 0,r=void 0,n=void 0,s=this,a=void 0;if(this.effect.inputs.hasOwnProperty(e)){if(i=this.effect.inputs[e],"image"===i.type){if(t){if((t=b(t))!==this.sources[e]){if(function(){var t=s.sources[e],i=void 0;if(t){for(i in s.sources)if(i!==e&&s.sources.hasOwnProperty(i)&&s.sources[i]===t)return;t.removeTarget(s)}}(),C(t,this))throw new Error("Attempt to make cyclical connection.");this.sources[e]=t,t.addTarget(this)}}else delete this.sources[e],t=!1;o=this.sources[e],r=Object.keys(this.sources),!0===this.inPlace&&1===r.length?(n=this.sources[r[0]],this.uniforms.transform=n&&n.cumulativeMatrix||y):this.uniforms.transform=y}else a=$[this.hook]&&void 0!==$[this.hook][e]?$[this.hook][e]:i.defaultValue,t=i.validate.call(this,t,i,a,this.inputs[e]),o=t;return this.inputs[e]===t&&"color"!==i.type&&"vector"!==i.type?t:(this.inputs[e]=t,i.uniform&&(this.uniforms[i.uniform]=o),"image"===i.type?(this.resize(),this.updateReady()):i.updateSources&&this.updateReady(),i.shaderDirty&&(this.shaderDirty=!0),this.setDirty(),i.update&&i.update.call(this,t),t)}},ue.prototype.alias=function(e,t){var i=this;if(Z.indexOf(t)>=0)throw new Error("'"+t+"' is a reserved name and cannot be used as an alias.");return this.effect.inputs.hasOwnProperty(e)&&(t||(t=e),A.removeAlias(t),K[t]={node:this,input:e},Object.defineProperty(A,t,{configurable:!0,enumerable:!0,get:function(){return i.inputs[e]},set:function(t){return i.setInput(e,t)}})),this},ue.prototype.matte=function(e){function t(e,t,i,o){var r=void 0,n=void 0,s=void 0,a=void 0,u=void 0;return r=(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x),n=(t.x-e.x)*(e.y-i.y)-(t.y-e.y)*(e.x-i.x),!!((s=(o.y-i.y)*(t.x-e.x)-(o.x-i.x)*(t.y-e.y))&&(a=r/s,u=n/s,a>0&&a<=1&&u>0&&u<=1))&&{x:e.x+a*(t.x-e.x),y:e.y+a*(t.y-e.y)}}var i=void 0,o=[],r=void 0,s=[],a=void 0,u=void 0,l=void 0,c=void 0,f=void 0,d={};for(i=function(e){return e&&e.length&&Array.isArray(e)?Array.isArray(e[0])?Array.isArray(e[0])&&!isNaN(e[0][0])?[e]:e:[e]:[]}(e),a=0;a<i.length;a++){for(e=i[a],f=null,r={vertices:[],edges:[]},u=0;u<e.length;u++)l=e[u],"object"!=typeof l||isNaN(l.x)||isNaN(l.y)?l.length>=2&&!isNaN(l[0])&&!isNaN(l[1])&&(c={x:l[0],y:l[1],id:s.length}):c={x:l.x,y:l.y,id:s.length},c&&(f?(f.next=c,c.prev=f,c.next=r.vertices[0],r.vertices[0].prev=c):(r.head=c,c.next=c,c.prev=c),s.push(c),r.vertices.push(c),f=c);if(r.vertices.length>2)for(3===r.vertices.length&&(r.simple=!0),o.push(r),u=0;u<r.vertices.length;u++)c=r.vertices[u],r.edges.push([c,c.next])}for(a=o.length-1;a>=0;a--)r=o[a],function(e){var i=void 0,r=void 0,n=void 0,a=void 0,u=void 0,l=[],c=void 0,f=void 0,d=void 0,h=void 0,m=void 0,p=void 0;if(!e.simple){for(i=0;i<e.edges.length;i++)for(n=e.edges[i],r=i+1;r<e.edges.length;r++)a=e.edges[r],(u=t(n[0],n[1],a[0],a[1]))&&(u.edge1=n,u.edge2=a,l.push(u));if(l.length){for(h=[],i=0;i<l.length;i++)u=l[i],n=u.edge1,a=u.edge2,m={x:u.x,y:u.y,prev:n[0],next:a[1],id:s.length},e.vertices.push(m),s.push(m),p={x:u.x,y:u.y,prev:a[0],next:n[1],id:s.length},e.vertices.push(p),s.push(m),m.prev.next=m,m.next.prev=m,p.prev.next=p,p.next.prev=p;do{c={edges:[],vertices:[],simple:!0},h.push(c),d=e.vertices[0],f=d;do{i=e.vertices.indexOf(d),e.vertices.splice(i,1),c.edges.push([d,d.next]),c.vertices.push(d),d=d.next}while(d!==f)}while(e.vertices.length);for(i=o.indexOf(e),o.splice(i,1),i=0;i<h.length;i++)o.push(h[i])}else e.simple=!0}}(r);for(a=0;a<o.length;a++)r=o[a],r.clockWise=function(e){var t=void 0,i=void 0,o=e.vertices.length,r=void 0,n=void 0,s=0;for(t=o-1,i=0;i<o;t=i,i++)r=e.vertices[t],n=e.vertices[i],s+=r.x*n.y-n.x*r.y;return s>0}(r),function(e){function t(e,t,i,o){var r=void 0,n=void 0,s=void 0,a=void 0,u=void 0,l=void 0,c=void 0,f=void 0,d=void 0,h=void 0,m=void 0,p=void 0,v=void 0,g=void 0,x=void 0;return r=i.x-t.x,n=i.y-t.y,s=e.x-i.x,a=e.y-i.y,u=t.x-e.x,l=t.y-e.y,c=o.x-e.x,f=o.y-e.y,d=o.x-t.x,h=o.y-t.y,m=o.x-i.x,p=o.y-i.y,x=r*h-n*d,v=u*f-l*c,g=s*p-a*m,x>=0&&g>=0&&v>=0}var i=void 0,o=e.vertices,n=void 0,s=[],a=[],u=void 0,l=void 0,c=void 0,f=void 0,d=void 0,h=void 0,m=void 0,p=void 0,v=void 0,g=void 0;if(n=o.length,e.clockWise)for(i=0;i<n;i++)s[i]=i;else for(i=0;i<n;i++)s[i]=n-1-i;for(u=n,l=2*u,c=0,i=u-1;u>2;){if(l--<=0)return a;if(f=i,u<=f&&(f=0),i=f+1,u<=i&&(i=0),d=i+1,u<d&&(d=0),function(e,i,r,n,s){var a=void 0,u=void 0,l=void 0,c=void 0,f=void 0;if(u=o[s[e]],l=o[s[i]],c=o[s[r]],0>(l.x-u.x)*(c.y-u.y)-(l.y-u.y)*(c.x-u.x))return!1;for(a=0;a<n;a++)if(a!==e&&a!==i&&a!==r&&(f=o[s[a]],t(u,l,c,f)))return!1;return!0}(f,i,d,u,s)){for(h=s[f],m=s[i],p=s[d],e.clockWise?(a.push(o[h]),a.push(o[m]),a.push(o[p])):(a.push(o[p]),a.push(o[m]),a.push(o[h])),c++,v=i,g=i+1;g<u;v++,g++)s[v]=s[g];u--,l=2*u}}r.indices=a}(r);for(d.vertices=[],d.coords=[],a=0;a<s.length;a++)l=s[a],d.vertices.push(2*l.x-1),d.vertices.push(-2*l.y+1),d.vertices.push(-1),d.coords.push(l.x),d.coords.push(-1*l.y+1);for(d.vertices=new Float32Array(d.vertices),d.coords=new Float32Array(d.coords),d.indices=[],a=0;a<o.length;a++)for(r=o[a],u=0;u<r.indices.length;u++)l=r.indices[u],d.indices.push(l.id);d.indices=new Uint16Array(d.indices),this.shape=d,this.gl&&n(d,this.gl)},ue.prototype.destroy=function(){var e=void 0,t=void 0,i=void 0,o=this.hook;this.effect.destroy&&"function"==typeof this.effect.destroy&&this.effect.destroy.call(this),delete this.effect,re[o]&&(--re[o].count||delete re[o]),this.shader&&this.shader.destroy&&this.shader!==ne&&!re[o]&&this.shader.destroy(),delete this.shader;for(t in this.inputElements)this.inputElements.hasOwnProperty(t)&&(i=this.inputElements[t],i.element.removeEventListener("change",i.listener,!0),i.element.removeEventListener("input",i.listener,!0));for(t in this.sources)this.sources.hasOwnProperty(t)&&(i=this.sources[t],i&&i.removeTarget&&i.removeTarget(this),delete this.sources[t]);for(;this.targets.length;)(i=this.targets.pop())&&i.removeSource&&i.removeSource(this);for(t in this)this.hasOwnProperty(t)&&"id"!==t&&delete this[t];for(t in K)K.hasOwnProperty(t)&&(i=K[t],i.node===this&&A.removeAlias(t));e=Y.indexOf(this),e>=0&&Y.splice(e,1),e=_[o].indexOf(this),e>=0&&_[o].splice(e,1),se.prototype.destroy.call(this)},de=function(e){var t=e;Object.defineProperties(this,{original:{enumerable:!0,configurable:!0,get:function(){return t.source}},id:{enumerable:!0,configurable:!0,get:function(){return t.id}},width:{enumerable:!0,configurable:!0,get:function(){return t.width}},height:{enumerable:!0,configurable:!0,get:function(){return t.height}}}),this.render=function(){t.render()},this.update=function(){t.setDirty()},this.readPixels=function(e,i,o,r,n){return t.readPixels(e,i,o,r,n)},this.on=function(e,i){t.on(e,i)},this.off=function(e,i){t.off(e,i)},this.destroy=function(){var e=void 0,i=void 0;t.destroy();for(e in this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&(i=Object.getOwnPropertyDescriptor(this,e),i.get||i.set||"function"!=typeof this[e]?delete this[e]:this[e]=O)},this.isDestroyed=function(){return t.isDestroyed},this.isReady=function(){return t.ready}},ae=function(e,o,n){function s(e,t,o,r){var n=D[e];if(n.definition){if(!(n=n.definition.call(h,t,o,r)))return null;n=i(i({},D[e]),n)}return n}function a(e){return h.source===e}var u=n||{},l=void 0===u.flip||u.flip,c=u.width,f=u.height,d=!1,h=this,m=!1,p=void 0,v=void 0;if(se.call(this),(e&&"string"!=typeof e||!o&&0!==o)&&(n&&"object"==typeof n||(n=o),o=e),"string"==typeof o&&isNaN(o)&&(o=t(o,["canvas","img","video"])),"string"==typeof e&&D[e]&&(v=s(e,o,n,!0))&&(this.hook=e,m=!0,d=v.deferTexture,this.plugin=v,this.compare=v.compare,this.checkDirty=v.checkDirty,v.source&&(o=v.source)),!v&&r(o))"CANVAS"===o.tagName?(this.width=o.width,this.height=o.height,this.render=this.renderImageCanvas,m=!0,this.hook="canvas",this.compare=a):"IMG"===o.tagName&&(this.width=o.naturalWidth||1,this.height=o.naturalHeight||1,o.complete&&o.naturalWidth||(d=!0),o.addEventListener("load",function(){h.isDestroyed||(h.width===o.naturalWidth&&h.height===o.naturalHeight||(h.width=o.naturalWidth,h.height=o.naturalHeight,h.resize()),h.setDirty(),h.setReady())},!0),this.render=this.renderImageCanvas,m=!0,this.hook="image",this.compare=a);else if(!v&&r(o,"WebGLTexture")){if(te&&!te.isTexture(o))throw new Error("Not a valid WebGL texture.");isNaN(c)?isNaN(f)||(c=f):isNaN(f)&&(f=c),this.width=c,this.height=f,void 0===u.flip&&(l=!1),m=!0,this.texture=o,this.initialized=!0,this.hook="texture",this.compare=a,this.render=function(){}}if(!m&&!v)for(p in D)if(D.hasOwnProperty(p)&&D[p]&&(v=s(p,o,n,!1))){this.hook=p,m=!0,d=v.deferTexture,this.plugin=v,this.compare=v.compare,this.checkDirty=v.checkDirty,v.source&&(o=v.source);break}if(!m)throw new Error("Unknown source type");this.source=o,void 0===this.flip&&(this.flip=l),this.targets=[],d||h.setReady(),this.pub=new de(this),N.push(this),j[this.id]=this,U.push(this),F[this.hook].push(this),U.length&&!ge&&g()},ae.prototype=Object.create(se.prototype),ae.prototype.constructor=ae,ae.prototype.initialize=function(){var e=void 0;te&&!this.texture&&this.ready&&(e=te.createTexture(),te.bindTexture(te.TEXTURE_2D,e),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.bindTexture(te.TEXTURE_2D,null),this.texture=e,this.initialized=!0,this.allowRefresh=!0,this.setDirty())},ae.prototype.initFrameBuffer=function(e){te&&(this.frameBuffer=new h(te,this.width,this.height,{texture:this.texture,useFloat:e}))},ae.prototype.addTarget=function(e){var t=void 0;for(t=0;t<this.targets.length;t++)if(this.targets[t]===e)return;this.targets.push(e)},ae.prototype.removeTarget=function(e){var t=this.targets&&this.targets.indexOf(e);t>=0&&this.targets.splice(t,1)},ae.prototype.resize=function(){var e=void 0,t=void 0;if(this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,this.framebuffer&&this.framebuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty(),this.targets)for(e=0;e<this.targets.length;e++)t=this.targets[e],t.resize(),t.setTransformDirty&&t.setTransformDirty()},ae.prototype.setReady=function(){var e=void 0;if(!this.ready&&(this.ready=!0,this.resize(),this.initialize(),this.emit("ready"),this.targets))for(e=0;e<this.targets.length;e++)this.targets[e].setReady()},ae.prototype.render=function(){var e=this.source;te&&(e||0===e)&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.plugin&&this.plugin.render&&(this.dirty||this.checkDirty&&this.checkDirty())&&this.plugin.render.call(this,te,x,oe,ne)&&(this.dirty=!1,this.emit("render")))},ae.prototype.renderImageCanvas=function(){var t=this.source;if(te&&t&&this.ready&&(this.initialized||this.initialize(),this.allowRefresh&&this.dirty)){te.bindTexture(te.TEXTURE_2D,this.texture),te.pixelStorei(te.UNPACK_FLIP_Y_WEBGL,this.flip),te.pixelStorei(te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{return te.texImage2D(te.TEXTURE_2D,0,te.RGBA,te.RGBA,te.UNSIGNED_BYTE,t),this.dirty=!1,this.emit("render"),!0}catch(t){t.code===e.DOMException.SECURITY_ERR&&(this.allowRefresh=!1,p.logger.error("Unable to access cross-domain image"))}return!1}},ae.prototype.destroy=function(){var e=void 0,t=void 0,i=void 0;for(this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this),te&&this.texture&&te.deleteTexture(this.texture);this.targets.length;)(i=this.targets.pop())&&i.removeSource&&i.removeSource(this);e=U.indexOf(this),e>=0&&U.splice(e,1),(e=F[this.hook].indexOf(this))>=0&&F[this.hook].splice(e,1);for(t in this)this.hasOwnProperty(t)&&"id"!==t&&delete this[t];se.prototype.destroy.call(this)},me=function(e){var t=e;Object.defineProperties(this,{source:{enumerable:!0,configurable:!0,get:function(){if(t.source)return t.source.pub},set:function(e){t.setSource(e)}},original:{enumerable:!0,configurable:!0,get:function(){return t.target}},width:{enumerable:!0,configurable:!0,get:function(){return t.width},set:function(e){!isNaN(e)&&e>0&&t.width!==e&&(t.width=e,t.resize(),t.setTransformDirty())}},height:{enumerable:!0,configurable:!0,get:function(){return t.height},set:function(e){!isNaN(e)&&e>0&&t.height!==e&&(t.height=e,t.resize(),t.setTransformDirty())}},id:{enumerable:!0,configurable:!0,get:function(){return t.id}}}),this.render=function(){t.render()},this.readPixels=function(e,i,o,r,n){return t.readPixels(e,i,o,r,n)},this.on=function(e,i){t.on(e,i)},this.off=function(e,i){t.off(e,i)},this.go=function(e){t.go(e)},this.stop=function(){t.stop()},this.getTexture=function(){return t.frameBuffer.texture},this.destroy=function(){var e=void 0,i=void 0;t.destroy();for(e in this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&(i=Object.getOwnPropertyDescriptor(this,e),i.get||i.set||"function"!=typeof this[e]?delete this[e]:this[e]=O)},this.inputs=function(e){return{source:{type:"image"}}},this.isDestroyed=function(){return t.isDestroyed},this.isReady=function(){return t.ready}},ce=function(e,t,o){function n(e,t,o,r){var n=S[e];if(n.definition){if(!(n=n.definition.call(v,t,o,r)))return null;n=i(i({},S[e]),n),v.hook=C,g=!0,v.plugin=n,v.compare=n.compare,n.target&&(t=n.target),n.gl&&!v.gl&&(v.gl=n.gl,te||c(n.gl)),v.gl===te&&(v.model=oe,v.shader=ne)}return n}var s=void 0,u=void 0,f=void 0,d=void 0,v=this,g=!1,x=void 0,y=void 0,b=void 0,E=void 0,C=void 0;if(se.call(this),(e&&"string"!=typeof e||!t&&0!==t)&&(o&&"object"==typeof o||(o=t),t=e),s=o||{},u=void 0===s.flip||s.flip,f=parseInt(s.width,10),d=parseInt(s.height,10),y=s.debugContext,"string"==typeof e&&S[e]&&n(e,t,s,!0),this.renderToTexture=s.renderToTexture,r(t,"WebGLFramebuffer"))if(b=t,r(s,"HTMLCanvasElement"))t=s;else if(r(s,"WebGLRenderingContext"))t=s.canvas;else if(r(s.canvas,"HTMLCanvasElement"))t=s.canvas;else{if(!r(s.context,"WebGLRenderingContext"))throw new Error("Must provide a canvas with WebGLFramebuffer target");t=s.context.canvas}if(r(t,"HTMLCanvasElement")){if(f=t.width,d=t.height,(!te||te.canvas!==t&&s.allowSecondaryWebGL)&&(x=l(t,{alpha:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0,debugContext:y})),x)te&&te!==x?(this.gl=x,this.frameBuffer={frameBuffer:b||null},this.shader=new m(this.gl,w,T),this.model=a.call(this,this.gl),this.pixels=null,this.texture=this.gl.createTexture(),this.gl.bindTexture(te.TEXTURE_2D,this.texture),this.gl.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),this.gl.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),this.gl.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),this.gl.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),this.render=this.renderSecondaryWebGL):(ie||(ie=this),te||c(x),this.render=this.renderWebGL,s.renderToTexture?te&&(this.frameBuffer=new h(te,f,d,!1)):this.frameBuffer={frameBuffer:b||null});else{if(!s.allowSecondaryWebGL&&te&&te.canvas!==t)throw new Error("Only one WebGL target canvas allowed. Set allowSecondaryWebGL option to create secondary context.");this.render=O,p.logger.log("Unable to create WebGL context.")}g=!0}if(!g)for(C in S)if(S.hasOwnProperty(C)&&S[C]&&n(C,t,s,!1))break;if(!g)throw new Error("Unknown target type");M&&(E=M.get(t),E?p.logger.warn("Target already in use by another instance",t,Object.keys(E).map(function(e){return E[e]})):(E={},M.set(t,E)),E[A.id]=A),this.target=t,this.transform=null,this.transformDirty=!0,this.flip=u,f&&(this.width=f),d&&(this.height=d),this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,void 0!==s.auto?this.auto=s.auto:this.auto=pe,this.frames=0,this.pub=new me(this),N.push(this),j[this.id]=this,I.push(this)},ce.prototype=Object.create(se.prototype),ce.prototype.constructor=ce,ce.prototype.setSource=function(e){var t=void 0;(t=b(e))!==this.source&&(this.source&&this.source.removeTarget(this),this.source=t,t.addTarget(this),t&&(this.resize(),t.ready?this.setReady():this.setUnready()),this.setDirty())},ce.prototype.setDirty=function(){this.dirty=!0,this.auto&&!ge&&(ge=W(g))},ce.prototype.resize=function(){r(this.target,"HTMLCanvasElement")?this.width===this.target.width&&this.height===this.target.height||(this.target.width=this.width,this.target.height=this.height,this.uniforms.resolution[0]=this.width,this.uniforms.resolution[1]=this.height,this.emit("resize"),this.setTransformDirty()):this.plugin&&this.plugin.resize&&this.plugin.resize.call(this),!this.source||this.source.width===this.width&&this.source.height===this.height||this.transform||(this.transform=new Float32Array(16))},ce.prototype.setTransformDirty=function(){this.transformDirty=!0,this.setDirty()},ce.prototype.go=function(){this.auto=!0,this.setDirty()},ce.prototype.stop=function(){this.auto=!1},ce.prototype.render=function(){te&&this.plugin&&this.plugin.render&&this.plugin.render.call(this,x,ne,oe)},ce.prototype.renderWebGL=function(){var e=void 0,t=void 0,i=void 0;if(this.resize(),te&&this.dirty&&this.ready){if(!this.source)return;this.source.render(),this.uniforms.source=this.source.texture,this.source.width===this.width&&this.source.height===this.height?this.uniforms.transform=this.source.cumulativeMatrix||y:this.transformDirty&&(e=this.transform,X.copy(e,this.source.cumulativeMatrix||y),t=this.source.width/this.width,i=this.source.height/this.height,e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,this.uniforms.transform=e,this.transformDirty=!1),x(ne,oe,this.uniforms,this.frameBuffer.frameBuffer,this,k),this.emit("render"),this.dirty=!1}},ce.prototype.renderSecondaryWebGL=function(){var e=void 0,t=void 0,i=void 0,o=void 0,r=void 0;this.dirty&&this.ready&&this.source&&(this.emit("render"),this.source.render(!0),e=this.source.width,t=this.source.height,this.pixels&&this.pixels.length===e*t*4||(this.pixels=new Uint8Array(e*t*4)),this.source.readPixels(0,0,e,t,this.pixels),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.pixels),e===this.width&&t===this.height?this.uniforms.transform=y:this.transformDirty&&(i=this.transform,X.copy(i,y),o=this.source.width/this.width,r=this.source.height/this.height,i[0]*=o,i[1]*=o,i[2]*=o,i[3]*=o,i[4]*=r,i[5]*=r,i[6]*=r,i[7]*=r,this.uniforms.transform=i,this.transformDirty=!1),this.uniforms.source=this.texture,x(this.shader,this.model,this.uniforms,null,this,k),this.dirty=!1)},ce.prototype.removeSource=function(e){this.source!==e&&this.source!==e.pub||(this.source=null)},ce.prototype.destroy=function(){var e=void 0,t=void 0;this.source&&this.source.removeTarget&&this.source.removeTarget(this),M&&(t=M.get(this.target),delete t[A.id],Object.keys(t).length||M.delete(this.target)),this.plugin&&this.plugin.destroy&&this.plugin.destroy.call(this),delete this.source,delete this.target,delete this.pub,delete this.uniforms,delete this.pixels,delete this.auto,e=I.indexOf(this),e>=0&&I.splice(e,1),se.prototype.destroy.call(this),this===ie&&(ee.removeEventListener("webglcontextrestored",f,!1),v(),ie=null)},he=function(e){function o(e,i,o){var a=void 0,u=void 0;a=n.inputElements[e],"string"==typeof o&&isNaN(o)&&("enum"===i.type?i.options.hasOwnProperty(o)||(o=t(o,["select"])):"number"===i.type||"boolean"===i.type?o=t(o,["input","select"]):"image"===i.type&&(o=t(o,["canvas","img","video"]))),r(o,"HTMLInputElement")||r(o,"HTMLSelectElement")?(u=o.value,a&&a.element!==o&&(a.element.removeEventListener("change",a.listener,!0),a.element.removeEventListener("input",a.listener,!0),delete n.inputElements[e],a=null),a||(a={element:o,listener:function(t){return function(){var i=void 0,r=void 0;i="checkbox"===o.type?o.checked:t.value,r=n.setInput(e,i),"color"===o.type&&(r=s(r)),r!==i&&(t.value=r)}}(o)},n.inputElements[e]=a,"range"===o.type?(o.addEventListener("input",a.listener,!0),o.addEventListener("change",a.listener,!0)):o.addEventListener("change",a.listener,!0)),a&&"checkbox"===o.type&&(u=o.checked)):(a&&(a.element.removeEventListener("change",a.listener,!0),a.element.removeEventListener("input",a.listener,!0),delete n.inputElements[e]),u=o),n.setInput(e,u)}var n=e,a=this,u=void 0;Object.defineProperties(this,{transform:{enumerable:!0,configurable:!0,get:function(){return n.hook}},title:{enumerable:!0,configurable:!0,get:function(){return n.plugin.title||n.hook}},width:{enumerable:!0,configurable:!0,get:function(){return n.width}},height:{enumerable:!0,configurable:!0,get:function(){return n.height}},id:{enumerable:!0,configurable:!0,get:function(){return n.id}},source:{enumerable:!0,configurable:!0,get:function(){return n.source&&n.source.pub},set:function(e){n.setSource(e)}}});for(u in n.methods)n.methods.hasOwnProperty(u)&&(this[u]=function(e){return function(){e.apply(n,arguments)&&n.setTransformDirty()}}(n.methods[u]));for(u in n.inputs)n.inputs.hasOwnProperty(u)&&function(e,t){Object.defineProperty(a,e,{configurable:!0,enumerable:!0,get:function(){return t.get.call(n)},set:function(i){o(e,t,i)}})}(u,n.inputs[u]);this.update=function(){n.setDirty()},this.inputs=function(e){var t=void 0,o=void 0,r=void 0,s=void 0;if(r=n.plugin.inputs,e)return!(o=r[e])||o.method?null:(t={type:o.type,defaultValue:o.defaultValue,title:o.title||e},"number"===o.type?(t.min=o.min,t.max=o.max,t.step=o.step,t.mod=o.mod):"enum"===o.type?t.options=i({},o.options):"vector"===o.type&&(t.dimensions=o.dimensions),o.description&&(t.description=o.description),t);t={};for(s in r)r.hasOwnProperty(s)&&!r[s].method&&(t[s]=this.inputs(s));return t},this.alias=function(e,t){return n.alias(e,t),this},this.on=function(e,t){n.on(e,t)},this.off=function(e,t){n.off(e,t)},this.destroy=function(){var e=void 0,t=void 0;n.destroy();for(e in this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&(t=Object.getOwnPropertyDescriptor(this,e),t.get||t.set||"function"!=typeof this[e]?delete this[e]:this[e]=O)},this.isDestroyed=function(){return n.isDestroyed},this.isReady=function(){return n.ready}},le=function(e,t){var o=void 0,r=void 0,n=void 0,s=void 0,a=void 0;this.matrix=new Float32Array(16),this.cumulativeMatrix=new Float32Array(16),this.ready=!1,this.width=1,this.height=1,this.seriously=A,this.transformRef=P[e],this.hook=e,this.id=V,V++,this.options=t,this.sources=null,this.targets=[],this.inputElements={},this.inputs={},this.methods={},this.listeners={},this.texture=null,this.frameBuffer=null,this.uniforms=null,this.dirty=!0,this.transformDirty=!0,this.renderDirty=!1,this.isDestroyed=!1,this.transformed=!1,this.plugin=i({},this.transformRef),this.transformRef.definition&&i(this.plugin,this.transformRef.definition.call(this,t));for(o in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(o)&&(r=this.plugin.inputs[o],r.method&&"function"==typeof r.method?this.methods[o]=r.method:"function"==typeof r.set&&"function"==typeof r.get&&(this.inputs[o]=r));d(this.plugin),a=$[e];for(o in this.plugin.inputs)this.plugin.inputs.hasOwnProperty(o)&&(r=this.plugin.inputs[o],"function"==typeof r.set&&"function"==typeof r.get&&"function"!=typeof r.method&&(n=r.get.call(this),s=void 0===r.defaultValue?n:r.defaultValue,s=r.validate.call(this,s,r,n),a&&void 0!==a[o]&&(s=r.validate.call(this,a[o],r,r.defaultValue,s),a[o]=s),s!==n&&r.set.call(this,s)));N.push(this),j[this.id]=this,this.pub=new he(this),G.push(this),z[e].push(this)},le.prototype=Object.create(se.prototype),le.prototype.constructor=le,le.prototype.setDirty=function(){this.renderDirty=!0,se.prototype.setDirty.call(this)},le.prototype.setTransformDirty=function(){var e=void 0,t=void 0;for(this.transformDirty=!0,this.dirty=!0,this.renderDirty=!0,e=0;e<this.targets.length;e++)t=this.targets[e],t.setTransformDirty?t.setTransformDirty():t.setDirty()},le.prototype.resize=function(){var e=void 0;for(se.prototype.resize.call(this),this.plugin.resize&&this.plugin.resize.call(this),e=0;e<this.targets.length;e++)this.targets[e].resize();this.setTransformDirty()},le.prototype.setSource=function(e){var t=void 0;if((t=b(e))!==this.source){if(C(t,this))throw new Error("Attempt to make cyclical connection.");this.source&&this.source.removeTarget(this),this.source=t,t.addTarget(this),t&&t.ready?this.setReady():this.setUnready(),this.resize()}},le.prototype.addTarget=function(e){var t=void 0;for(t=0;t<this.targets.length;t++)if(this.targets[t]===e)return;this.targets.push(e)},le.prototype.removeTarget=function(e){var t=this.targets&&this.targets.indexOf(e);t>=0&&this.targets.splice(t,1),this.targets&&this.targets.length&&this.resize()},le.prototype.setInput=function(e,t){var i=void 0,o=void 0,r=void 0;if(this.plugin.inputs.hasOwnProperty(e))return i=this.plugin.inputs[e],o=$[this.hook]&&void 0!==$[this.hook][e]?$[this.hook][e]:i.defaultValue,r=i.get.call(this),void 0===o&&(o=r),t=i.validate.call(this,t,i,o,r),i.set.call(this,t)&&this.setTransformDirty(),i.get.call(this)},le.prototype.alias=function(e,t){var i=this,o=void 0,r=void 0;if(Z.indexOf(t)>=0)throw new Error("'"+t+"' is a reserved name and cannot be used as an alias.");return this.plugin.inputs.hasOwnProperty(e)&&(t||(t=e),A.removeAlias(t),o=this.inputs[e],o?(r=i.inputs[e],Object.defineProperty(A,t,{configurable:!0,enumerable:!0,get:function(){return r.get.call(i)},set:function(e){r.set.call(i,e)&&i.setTransformDirty()}})):(o=this.methods[e])&&(r=o,A[t]=function(){r.apply(i,arguments)&&i.setTransformDirty()}),o&&(K[t]={node:this,input:e})),this},le.prototype.render=function(e){return this.source?(this.source.render(),this.transformDirty&&(this.transformed?this.source.cumulativeMatrix?X.multiply(this.cumulativeMatrix,this.matrix,this.source.cumulativeMatrix):X.copy(this.cumulativeMatrix,this.matrix):X.copy(this.cumulativeMatrix,this.source.cumulativeMatrix||y),this.transformDirty=!1),e&&te?(this.renderDirty&&(this.frameBuffer||(this.uniforms={resolution:[this.width,this.height]},this.frameBuffer=new h(te,this.width,this.height)),this.uniforms.source=this.source.texture,this.uniforms.transform=this.cumulativeMatrix||y,x(ne,oe,this.uniforms,this.frameBuffer.frameBuffer,this),this.renderDirty=!1),this.texture=this.frameBuffer.texture):this.source?this.texture=this.source.texture:this.texture=null,this.dirty=!1,this.texture):(this.transformDirty&&(X.copy(this.cumulativeMatrix,this.matrix),this.transformDirty=!1),this.texture=null,void(this.dirty=!1))},le.prototype.readPixels=function(e,t,i,o,n){var s=this.gl||te;if(!te)throw new Error("Cannot read pixels until a canvas is connected");if(this.render(!0),void 0===n)n=new Uint8Array(i*o*4);else if(!r(n,"Uint8Array"))throw new Error("Incompatible array type");return s.bindFramebuffer(te.FRAMEBUFFER,this.frameBuffer.frameBuffer),s.readPixels(e,t,i,o,te.RGBA,te.UNSIGNED_BYTE,n),n},le.prototype.destroy=function(){var e=void 0,t=void 0,i=void 0,o=this.hook;this.plugin.destroy&&"function"==typeof this.plugin.destroy&&this.plugin.destroy.call(this),delete this.effect,this.frameBuffer&&(this.frameBuffer.destroy(),delete this.frameBuffer,delete this.texture);for(e in this.inputElements)this.inputElements.hasOwnProperty(e)&&(i=this.inputElements[e],i.element.removeEventListener("change",i.listener,!0),i.element.removeEventListener("input",i.listener,!0));for(this.source&&this.source.removeTarget(this);this.targets.length;)(i=this.targets.pop())&&i.removeSource&&i.removeSource(this);for(t in this)this.hasOwnProperty(t)&&"id"!==t&&delete this[t];for(t in K)K.hasOwnProperty(t)&&(i=K[t],i.node===this&&A.removeAlias(t));e=G.indexOf(this),e>=0&&G.splice(e,1),e=z[o].indexOf(this),e>=0&&z[o].splice(e,1),se.prototype.destroy.call(this)},le.prototype.setReady=se.prototype.setReady,le.prototype.setUnready=se.prototype.setUnready,le.prototype.on=se.prototype.on,le.prototype.off=se.prototype.off,le.prototype.emit=se.prototype.emit,o=r(o,"HTMLCanvasElement")?{canvas:o}:o||{},o.canvas,this.effect=function(e,t){if(!R[e])throw new Error("Unknown effect: "+e);return new ue(e,t).pub},this.source=function(e,t,i){return b(e,t,i).pub},this.transform=function(e,t){var i=void 0;if("string"!=typeof e&&(t=e,e=!1),e){if(!P[e])throw new Error("Unknown transform: "+e)}else if(e=o&&o.defaultTransform||"2d",!P[e])throw new Error("No transform specified");return i=new le(e,t),i.pub},this.target=function(e,t,i){var o=void 0,r=void 0,n=void 0;for(e&&"string"==typeof e&&!S[e]&&(r=E.querySelector(e)),("string"!=typeof e||!t&&0!==t||r)&&(i&&"object"==typeof i||(i=t),t=r||e,e=null),"string"==typeof t&&isNaN(t)&&(t=E.querySelector(t)),n=0;n<I.length;n++)if(o=I[n],(!e||e===o.hook)&&(o.target===t||o.compare&&o.compare(t,i)))return o.pub;return o=new ce(e,t,i),o.pub},this.aliases=function(){return Object.keys(K)},this.removeAlias=function(e){K[e]&&(delete this[e],delete K[e])},this.defaults=function(e,t){var o=void 0;if(e)if("object"!=typeof e)null===t?delete $[e]:"object"==typeof t&&($[e]=i({},t));else for(o in e)e.hasOwnProperty(o)&&this.defaults(o,e[o]);else if(null===e)for(o in $)$.hasOwnProperty(o)&&delete $[o]},this.go=function(e,t){var i=void 0;for("function"==typeof e&&J.indexOf(e)<0&&J.push(e),"function"==typeof t&&Q.indexOf(t)<0&&Q.push(t),pe=!0,i=0;i<I.length;i++)I[i].go();ge||!J.length&&!Q.length||g()},this.stop=function(){J.length=0,Q.length=0,q(ge),ge=0},this.render=function(){var e=void 0;for(e=0;e<I.length;e++)I[e].render(o)},this.destroy=function(){for(var e=void 0,t=void 0,i=void 0;N.length;)t=N[0],t.pub.destroy();for(e in this)this.hasOwnProperty(e)&&"isDestroyed"!==e&&"id"!==e&&(i=Object.getOwnPropertyDescriptor(this,e),i.get||i.set||"function"!=typeof this[e]?delete this[e]:this[e]=O);A=null,U=[],I=[],Y=[],N=[],J.length=0,Q.length=0,q(ge),ge=0,ve=!0},this.isDestroyed=function(){return ve},this.incompatible=function(e){var t=void 0,i=void 0,o=!1;if(o=p.incompatible(e))return o;if(!e){for(t in _)if(_.hasOwnProperty(t)&&_[t].length&&(i=R[t])&&"function"==typeof i.compatible&&!i.compatible.call(this))return"plugin-"+t;for(t in F)if(F.hasOwnProperty(t)&&F[t].length&&(i=D[t])&&"function"==typeof i.compatible&&!i.compatible.call(this))return"source-"+t}return!1},this.isNode=function(e){var t=void 0;return!(!e||!(t=j[e.id])||t.isDestroyed)},this.isSource=function(e){return this.isNode(e)&&e instanceof de},this.isEffect=function(e){return this.isNode(e)&&e instanceof fe},this.isTransform=function(e){return this.isNode(e)&&e instanceof he},this.isTarget=function(e){return this.isNode(e)&&e instanceof me},Object.defineProperties(this,{id:{enumerable:!0,configurable:!0,get:function(){return B}}}),this.defaults(o.defaults)}var v,g,x,y,b,w,T,E=e.document,C=e.console,R={},P={},D={},S={},B=[],_={},z={},F={canvas:[],image:[],video:[]},A={},M=e.WeakMap&&new WeakMap,L=0,O=function(){},N={transparent:[0,0,0,0],black:[0,0,0,1],red:[1,0,0,1],green:[0,128/255,0,1],blue:[0,0,1,1],white:[1,1,1,1],silver:[192/255,192/255,192/255,1],gray:[128/255,128/255,128/255,1],maroon:[128/255,0,0,1],purple:[128/255,0,128/255,1],fuchsia:[1,0,1,1],lime:[0,1,0,1],olive:[128/255,128/255,0,1],yellow:[1,1,0,1],navy:[0,0,128/255,1],teal:[0,128/255,128/255,1],aqua:[0,1,1,1],orange:[1,165/255,0,1]},j=/^(rgb|hsl)a?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*(\d+(\.\d*)?)\s*)?\)/i,V=/^#(([0-9a-fA-F]{3,8}))/,U=["x","y","z","w"],I=["r","g","b","a"],k={srcRGB:770,dstRGB:771,srcAlpha:1,dstAlpha:771},G=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_TEXTURE_IMAGE_UNITS","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS"],H=/^[\t ]*#define[\t ]+SHADER_NAME\s+([^$\n\r]+)/i,X={frustum:function(e,t,i,o,r,n,s){s||(s=X.create());var a=t-e,u=o-i,l=n-r;return s[0]=2*r/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*r/u,s[6]=0,s[7]=0,s[8]=(t+e)/a,s[9]=(o+i)/u,s[10]=-(n+r)/l,s[11]=-1,s[12]=0,s[13]=0,s[14]=-n*r*2/l,s[15]=0,s},perspective:function(e,t,i,o,r){var n=i*Math.tan(e*Math.PI/360),s=n*t;return X.frustum(-s,s,-n,n,i,o,r)},multiply:function(e,t,i){var o=t[0],r=t[1],n=t[2],s=t[3],a=t[4],u=t[5],l=t[6],c=t[7],f=t[8],d=t[9],h=t[10],m=t[11],p=t[12],v=t[13],g=t[14],x=t[15],y=i[0],b=i[1],w=i[2],T=i[3];return e[0]=y*o+b*a+w*f+T*p,e[1]=y*r+b*u+w*d+T*v,e[2]=y*n+b*l+w*h+T*g,e[3]=y*s+b*c+w*m+T*x,y=i[4],b=i[5],w=i[6],T=i[7],e[4]=y*o+b*a+w*f+T*p,e[5]=y*r+b*u+w*d+T*v,e[6]=y*n+b*l+w*h+T*g,e[7]=y*s+b*c+w*m+T*x,y=i[8],b=i[9],w=i[10],T=i[11],e[8]=y*o+b*a+w*f+T*p,e[9]=y*r+b*u+w*d+T*v,e[10]=y*n+b*l+w*h+T*g,e[11]=y*s+b*c+w*m+T*x,y=i[12],b=i[13],w=i[14],T=i[15],e[12]=y*o+b*a+w*f+T*p,e[13]=y*r+b*u+w*d+T*v,e[14]=y*n+b*l+w*h+T*g,e[15]=y*s+b*c+w*m+T*x,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},W=function(){var t=0;return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(i){function o(){i(r+n)}var r=void 0,n=void 0,s=void 0;return r=(new Date).getTime(),n=Math.max(0,16-(r-t)),s=e.setTimeout(o,n),t=r+n,s}}(),q=function(){return e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.oCancelAnimationFrame||e.msCancelAnimationFrame||function(t){e.cancelTimeout(t)}}(),Y=["alias","destroy","effect","id","initialize","inputs","isDestroyed","isReady","matte","off","on","readPixels","render","title","update"],K=["alias","destroy","id","inputs","isDestroyed","isReady","off","on","source","title","update"],Z=["aliases","defaults","destroy","effect","go","id","incompatible","isDestroyed","isEffect","isNode","isSource","isTarget","isTransform","removeAlias","render","source","stop","target","transform"];return e.addEventListener("message",function(t){t.source===e&&"seriously-timeout-message"===t.data&&(t.stopPropagation(),B.length>0)&&B.shift()()},!0),h.prototype.resize=function(e,t){var i=this.gl;this.width===e&&this.height===t||(this.width=e,this.height=t,i&&(i.bindTexture(i.TEXTURE_2D,this.texture),i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,e,t),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null)))},h.prototype.destroy=function(){var e=this.gl;e&&(e.deleteFramebuffer(this.frameBuffer),e.deleteRenderbuffer(this.renderBuffer),this.ownTexture&&e.deleteTexture(this.texture)),delete this.frameBuffer,delete this.renderBuffer,delete this.texture,delete this.gl},m.prototype.use=function(){this.gl.useProgram(this.program)},p.incompatible=function(t){var i=void 0,o=void 0,r=void 0;if(void 0===x&&(i=E.createElement("canvas"),i&&i.getContext?e.WebGLRenderingContext?(o=c())||(x="context"):x="webgl":x="canvas"),x)return x;if(t){if((r=R[t])&&"function"==typeof r.compatible&&!r.compatible(o))return"plugin-"+t;if((r=D[t])&&"function"==typeof r.compatible&&!r.compatible(o))return"source-"+t}return!1},p.plugin=function(e,t,o){var r=void 0;return R[e]?void p.logger.warn("Effect ["+e+"] already loaded"):(void 0===o&&"object"==typeof t&&(o=t),o?(r=i({},o),"function"==typeof t&&(r.definition=t),r.reserved=Y,r.inputs&&d(r),r.title||(r.title=e),R[e]=r,_[e]=[],r):void 0)},p.removePlugin=function(e){var t=void 0,i=void 0;if(!e)return this;if(!R[e])return this;if(t=_[e]){for(;t.length;)i=t.shift(),i.destroy();delete _[e]}return delete R[e],this},p.source=function(e,t,o){var r=void 0;return D[e]?void p.logger.warn("Source ["+e+"] already loaded"):(void 0===o&&"object"==typeof t&&(o=t),o||t?(r=i({},o),"function"==typeof t&&(r.definition=t),r.title||(r.title=e),D[e]=r,F[e]=[],r):void 0)},p.removeSource=function(e){var t=void 0,i=void 0;if(!e)return this;if(!D[e])return this;if(t=F[e]){for(;t.length;)i=t.shift(),i.destroy();delete F[e]}return delete D[e],this},p.transform=function(e,t,o){var r=void 0;return P[e]?void p.logger.warn("Transform ["+e+"] already loaded"):(void 0===o&&"object"==typeof t&&(o=t),o||t?(r=i({},o),"function"==typeof t&&(r.definition=t),r.reserved=K,r.inputs&&d(r),r.title||(r.title=e),P[e]=r,z[e]=[],r):void 0)},p.removeTransform=function(e){var t=void 0,i=void 0;if(!e)return this;if(!P[e])return this;if(t=z[e]){for(;t.length;)i=t.shift(),i.destroy();delete z[e]}return delete P[e],this},p.target=function(e,t,o){var r=void 0;return S[e]?void p.logger.warn("Target ["+e+"] already loaded"):(void 0===o&&"object"==typeof t&&(o=t),o||t?(r=i({},o),"function"==typeof t&&(r.definition=t),r.title||(r.title=e),S[e]=r,A[e]=[],r):void 0)},p.removeTarget=function(e){var t=void 0,i=void 0;if(!e)return this;if(!S[e])return this;if(t=A[e]){for(;t.length;)i=t.shift(),i.destroy();delete A[e]}return delete S[e],this},p.inputValidators={color:function(e,t,i,o){var r=void 0,s=void 0,u=void 0,l=void 0;if(s=o||[],"string"==typeof e){if((u=j.exec(e))&&u.length){if(u.length<3)return s[0]=s[1]=s[2]=s[3]=0,s;for(s[3]=1,l=0;l<3;l++)s[l]=parseFloat(u[l+2])/255;return isNaN(u[6])||(s[3]=parseFloat(u[6])),"hsl"===u[1].toLowerCase()?n(s[0],s[1],s[2],s[3],s):s}if((u=V.exec(e))&&u.length)return r=u[1],3===r.length?(s[0]=parseInt(r[0],16)/15,s[1]=parseInt(r[1],16)/15,s[2]=parseInt(r[2],16)/15,s[3]=1):4===r.length?(s[0]=parseInt(r[0],16)/15,s[1]=parseInt(r[1],16)/15,s[2]=parseInt(r[2],16)/15,s[3]=parseInt(r[3],16)/15):6===r.length?(s[0]=parseInt(r.substr(0,2),16)/255,s[1]=parseInt(r.substr(2,2),16)/255,s[2]=parseInt(r.substr(4,2),16)/255,s[3]=1):8===r.length?(s[0]=parseInt(r.substr(0,2),16)/255,s[1]=parseInt(r.substr(2,2),16)/255,s[2]=parseInt(r.substr(4,2),16)/255,s[3]=parseInt(r.substr(6,2),16)/255):s[0]=s[1]=s[2]=s[3]=0,s;if(u=N[e.toLowerCase()]){for(l=0;l<4;l++)s[l]=u[l];return s}return g||(g=E.createElement("canvas").getContext("2d")),g.fillStyle=e,(r=g.fillStyle)&&"#000000"!==r?p.inputValidators.color(r,t,i,o):(s[0]=s[1]=s[2]=s[3]=0,s)}if(a(e)){if(s=e,s.length<3)return s[0]=s[1]=s[2]=s[3]=0,s;for(l=0;l<3;l++)if(isNaN(s[l]))return s[0]=s[1]=s[2]=s[3]=0,s;return s.length<4&&s.push(1),s}if("number"==typeof e)return s[0]=s[1]=s[2]=e,s[3]=1,s;if("object"==typeof e){for(l=0;l<4;l++)r=I[l],null===e[r]||isNaN(e[r])?s[l]=3===l?1:0:s[l]=e[r];return s}return s[0]=s[1]=s[2]=s[3]=0,s},number:function(e,t,i){return e=parseFloat(e),isNaN(e)?i||0:(t.mod&&(e-=t.mod*Math.floor(e/t.mod)),e<t.min?t.min:e>t.max?t.max:t.step?Math.round(e/t.step)*t.step:e)},enum:function(e,t,i){var o=t.options||[];return"string"==typeof e?e=e.toLowerCase():"number"==typeof e?e=e.toString():e||(e=""),o.hasOwnProperty(e)?e:i||""},vector:function(e,t,i,o){var r=void 0,n=void 0,s=void 0,u=t.dimensions||4;if(r=o||[],a(e)){for(n=0;n<u;n++)r[n]=e[n]||0;return r}if("object"==typeof e){for(n=0;n<u;n++)s=U[n],void 0===e[s]&&(s=I[n]),r[n]=e[s]||0;return r}for(e=parseFloat(e)||0,n=0;n<u;n++)r[n]=e;return r},boolean:function(e){return!(!e||e&&e.toLowerCase&&"false"===e.toLowerCase())},string:function(e){return"string"==typeof e?e:0===e||e?e.toString?e.toString():String(e):""}},p.prototype.effects=p.effects=function(){var e=void 0,t=void 0,i=void 0,o={},r=void 0,n=void 0;for(e in R)if(R.hasOwnProperty(e)){t=R[e],i={title:t.title||e,description:t.description||"",inputs:{}};for(n in t.inputs)t.inputs.hasOwnProperty(n)&&(r=t.inputs[n],i.inputs[n]={type:r.type,defaultValue:r.defaultValue,step:r.step,min:r.min,max:r.max,mod:r.mod,minCount:r.minCount,maxCount:r.maxCount,dimensions:r.dimensions,title:r.title||n,description:r.description||"",options:r.options||[]});o[e]=i}return o},e.Float32Array&&(y=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])),e.Seriously&&"object"==typeof e.Seriously&&function(){var t=void 0;for(t in e.Seriously)e.Seriously.hasOwnProperty(t)&&"plugin"!==t&&"object"==typeof e.Seriously[t]&&p.plugin(t,e.Seriously[t])}(),p.logger={log:o("log"),info:o("info"),warn:o("warn"),error:o("error")},p.util={mat4:X,checkSource:f,hslToRgb:n,colors:N,setTimeoutZero:u,ShaderProgram:m,FrameBuffer:h,requestAnimationFrame:W,shader:{makeNoise:"float makeNoise(float u, float v, float timer) {\n\tfloat x = u * v * mod(timer * 1000.0, 100.0);\n\tx = mod(x, 13.0) * mod(x, 127.0);\n\tfloat dx = mod(x, 0.01);\n\treturn clamp(0.1 + dx * 100.0, 0.0, 1.0);\n}\n",random:"#ifndef RANDOM\n#define RANDOM\nfloat random(vec2 n) {\n\treturn 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n#endif\n"}},p.source("video",function(t,i,o){function n(){t.removeEventListener("loadedmetadata",n,!0),f||(t.videoWidth?(u.width===t.videoWidth&&u.height===t.videoHeight||(u.width=t.videoWidth,u.height=t.videoHeight,u.resize()),d&&u.setReady()):(d=!0,setTimeout(n,50)))}function s(){h=!0}function a(){h=!1,u.setDirty()}var u=this,l=void 0,c=void 0,f=!1,d=!1,h=!1,m=0;if(r(t,"HTMLVideoElement"))return t.readyState?n():(d=!0,t.addEventListener("loadedmetadata",n,!0)),t.addEventListener("seeking",s,!1),t.addEventListener("seeked",a,!1),{deferTexture:d,source:t,render:function i(o){var r=void 0;if(m=t.currentTime,!t.videoHeight||!t.videoWidth)return!1;b?(c||(c=E.createElement("canvas").getContext("2d"),l=c.canvas,l.width=u.width,l.height=u.height),r=l,c.drawImage(t,0,0,u.width,u.height)):r=t,o.bindTexture(o.TEXTURE_2D,u.texture),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,u.flip),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,r),void 0===b){if(o.getError()===o.INVALID_VALUE)return b=!0,i(o);b=!1}return!0}catch(t){t.code===e.DOMException.SECURITY_ERR?(u.allowRefresh=!1,p.logger.error("Unable to access cross-domain image")):p.logger.error("Error rendering video source",t)}return!1},checkDirty:function(){return!h&&t.currentTime!==m},compare:function(e){return u.source===e},destroy:function(){f=!0,t.removeEventListener("seeking",s,!1),t.removeEventListener("seeked",a,!1),t.removeEventListener("loadedmetadata",n,!0)}}},{title:"Video"}),p.transform("2d",function(e){function t(){function e(e,i){t[12]=t[0]*e+t[4]*i+t[12],t[13]=t[1]*e+t[5]*i+t[13],t[14]=t[2]*e+t[6]*i+t[14],t[15]=t[3]*e+t[7]*i+t[15]}var t=i.matrix,h=void 0,m=void 0,p=void 0,v=void 0,g=void 0,x=void 0,y=void 0,b=void 0,w=void 0,T=void 0,E=void 0;if(!(u||l||c||f||d||1!==s||1!==a))return void(i.transformed=!1);X.identity(t),e(u+r,l+n),f&&(t[4]=f/i.width),d&&(t[1]=d/i.height),c&&(v=t[0],g=t[1],x=t[2],y=t[3],b=t[4],w=t[5],T=t[6],E=t[7],h=-(o?c*Math.PI/180:c),m=Math.sin(h),p=Math.cos(h),t[0]=v*p+b*m,t[1]=g*p+w*m,t[2]=x*p+T*m,t[3]=y*p+E*m,t[4]=b*p-v*m,t[5]=w*p-g*m,t[6]=T*p-x*m,t[7]=E*p-y*m),1!==s&&(t[0]*=s,t[1]*=s,t[2]*=s,t[3]*=s),1!==a&&(t[4]*=a,t[5]*=a,t[6]*=a,t[7]*=a),e(-r,-n),i.transformed=!0}var i=this,o=!(e&&e.radians),r=0,n=0,s=1,a=1,u=0,l=0,c=0,f=0,d=0;return{inputs:{reset:{method:function(){return r=0,n=0,s=1,a=1,u=0,l=0,c=0,f=0,d=0,!!i.transformed&&(i.transformed=!1,!0)}},translate:{method:function(e,i){return isNaN(e)&&(e=u),isNaN(i)&&(i=l),(e!==u||i!==l)&&(u=e,l=i,t(),!0)},type:["number","number"]},translateX:{get:function(){return u},set:function(e){return e!==u&&(u=e,t(),!0)},type:"number"},translateY:{get:function(){return l},set:function(e){return e!==l&&(l=e,t(),!0)},type:"number"},rotation:{get:function(){return c},set:function(e){return e!==c&&(c=parseFloat(e),t(),!0)},type:"number"},center:{method:function(e,i){return isNaN(e)&&(e=r),isNaN(i)&&(i=n),(e!==r||i!==n)&&(r=e,n=i,t(),!0)},type:["number","number"]},centerX:{get:function(){return r},set:function(e){return e!==r&&(r=e,t(),!0)},type:"number"},centerY:{get:function(){return n},set:function(e){return e!==n&&(n=e,t(),!0)},type:"number"},skew:{method:function(e,i){return isNaN(e)&&(e=f),isNaN(i)&&(i=d),(e!==f||i!==d)&&(f=e,d=i,t(),!0)},type:["number","number"]},skewX:{get:function(){return f},set:function(e){return e!==f&&(f=e,t(),!0)},type:"number"},skewY:{get:function(){return d},set:function(e){return e!==d&&(d=e,t(),!0)},type:"number"},scale:{method:function(e,i){var o=void 0,r=void 0;if(o=isNaN(e)?s:e,isNaN(i)){if(isNaN(e))return!1;r=o}else r=i;return(o!==s||r!==a)&&(s=o,a=r,t(),!0)},type:["number","number"]},scaleX:{get:function(){return s},set:function(e){return e!==s&&(s=e,t(),!0)},type:"number"},scaleY:{get:function(){return a},set:function(e){return e!==a&&(a=e,t(),!0)},type:"number"}}}},{title:"2D Transform",description:"Translate, Rotate, Scale, Skew"}),p.transform("flip",function(){function e(){var e=t.matrix;i?(e[0]=-1,e[5]=1):(e[0]=1,e[5]=-1)}var t=this,i=!0;return X.identity(t.matrix),e(),t.transformDirty=!0,t.transformed=!0,{inputs:{direction:{get:function(){return i?"horizontal":"vertical"},set:function(t){var o=void 0;return(o="vertical"!==t)!==i&&(i=o,e(),!0)},type:"string"}}}},{title:"Flip",description:"Flip Horizontal/Vertical"}),p.transform("reformat",function(){function e(){var e=o.matrix,t=r||o.width,i=n||o.height,a=void 0,u=void 0,l=o.source,c=l&&l.width||1,f=l&&l.height||1,d=void 0,h=void 0;return"distort"===s||t===c&&i===f?void(o.transformed=!1):(d=c/f,h=t/i,"none"===s?(a=c/t,u=f/i):"width"===s||"contain"===s&&h<=d?(a=1,u=h/d):"height"===s||"contain"===s&&h>d?(a=d/h,u=1):h>d?(a=1,u=h/d):(a=d/h,u=1),1===a&&1===u?void(o.transformed=!1):(X.identity(e),1!==a&&(e[0]*=a,e[1]*=a,e[2]*=a,e[3]*=a),1!==u&&(e[4]*=u,e[5]*=u,e[6]*=u,e[7]*=u),void(o.transformed=!0)))}function t(){return r||o.source&&o.source.width||1}function i(){return n||o.source&&o.source.height||1}var o=this,r=void 0,n=void 0,s="contain";return this.resize=function(){var o=t(),r=i(),n=void 0;if(this.width!==o||this.height!==r)for(this.width=o,this.height=r,this.uniforms&&this.uniforms.resolution&&(this.uniforms.resolution[0]=o,this.uniforms.resolution[1]=r),this.frameBuffer&&this.frameBuffer.resize&&this.frameBuffer.resize(o,r),n=0;n<this.targets.length;n++)this.targets[n].resize();this.setTransformDirty(),e()},{inputs:{width:{get:t,set:function(e){return(e=Math.floor(e))!==r&&(r=e,this.resize(),!1)},type:"number"},height:{get:i,set:function(e){return(e=Math.floor(e))!==n&&(n=e,this.resize(),!1)},type:"number"},mode:{get:function(){return s},set:function(t){return t!==s&&(s=t,e(),!0)},type:"enum",options:["cover","contain","distort","width","height","none"]}}}},{title:"Reformat",description:"Change output dimensions"}),w=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","varying vec2 vTexCoord;","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tvTexCoord = texCoord;","}\n"].join("\n"),T=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","void main(void) {","\t\tgl_FragColor = texture2D(source, vTexCoord);","}"].join("\n"),p.util.shader.noiseHelpers="#ifndef NOISE_HELPERS\n#define NOISE_HELPERS\nvec2 mod289(vec2 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 mod289(vec3 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec4 mod289(vec4 x) {\n\treturn x - floor(x * (1.0 / 289.0)) * 289.0;\n}\nvec3 permute(vec3 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 permute(vec4 x) {\n\treturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\nfloat taylorInvSqrt(float r) {\n\treturn 1.79284291400159 - 0.85373472095314 * r;\n}\n#endif\n",p.util.shader.snoise2d="#ifndef NOISE2D\n#define NOISE2D\nfloat snoise(vec2 v) {\n\tconst vec4 C = vec4(0.211324865405187, // (3.0-sqrt(3.0))/6.0\n\t\t0.366025403784439, // 0.5*(sqrt(3.0)-1.0)\n\t\t-0.577350269189626, // -1.0 + 2.0 * C.x\n\t\t0.024390243902439); // 1.0 / 41.0\n\tvec2 i = floor(v + dot(v, C.yy));\n\tvec2 x0 = v - i + dot(i, C.xx);\n\tvec2 i1;\n\t//i1.x = step(x0.y, x0.x); // x0.x > x0.y ? 1.0 : 0.0\n\t//i1.y = 1.0 - i1.x;\n\ti1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n\t// x0 = x0 - 0.0 + 0.0 * C.xx ;\n\t// x1 = x0 - i1 + 1.0 * C.xx ;\n\t// x2 = x0 - 1.0 + 2.0 * C.xx ;\n\tvec4 x12 = x0.xyxy + C.xxzz;\n\tx12.xy -= i1;\n\ti = mod289(i); // Avoid truncation effects in permutation\n\tvec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\n\tvec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);\n\tm = m*m ;\n\tm = m*m ;\n\tvec3 x = 2.0 * fract(p * C.www) - 1.0;\n\tvec3 h = abs(x) - 0.5;\n\tvec3 ox = floor(x + 0.5);\n\tvec3 a0 = x - ox;\n\tm *= 1.79284291400159 - 0.85373472095314 * (a0*a0 + h*h);\n\tvec3 g;\n\tg.x = a0.x * x0.x + h.x * x0.y;\n\tg.yz = a0.yz * x12.xz + h.yz * x12.yw;\n\treturn 130.0 * dot(m, g);\n}\n#endif\n",p.util.shader.snoise3d="#ifndef NOISE3D\n#define NOISE3D\nfloat snoise(vec3 v) {\n\tconst vec2 C = vec2(1.0/6.0, 1.0/3.0) ;\n\tconst vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n\tvec3 i = floor(v + dot(v, C.yyy));\n\tvec3 x0 = v - i + dot(i, C.xxx) ;\n\tvec3 g = step(x0.yzx, x0.xyz);\n\tvec3 l = 1.0 - g;\n\tvec3 i1 = min(g.xyz, l.zxy);\n\tvec3 i2 = max(g.xyz, l.zxy);\n\t// x0 = x0 - 0.0 + 0.0 * C.xxx;\n\t// x1 = x0 - i1 + 1.0 * C.xxx;\n\t// x2 = x0 - i2 + 2.0 * C.xxx;\n\t// x3 = x0 - 1.0 + 3.0 * C.xxx;\n\tvec3 x1 = x0 - i1 + C.xxx;\n\tvec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n\tvec3 x3 = x0 - D.yyy; // -1.0+3.0*C.x = -0.5 = -D.y\n\ti = mod289(i);\n\tvec4 p = permute(permute(permute(\n\t\t\t\t\t\ti.z + vec4(0.0, i1.z, i2.z, 1.0))\n\t\t\t\t\t\t+ i.y + vec4(0.0, i1.y, i2.y, 1.0))\n\t\t\t\t\t\t+ i.x + vec4(0.0, i1.x, i2.x, 1.0));\n\tfloat n_ = 0.142857142857; // 1.0/7.0\n\tvec3 ns = n_ * D.wyz - D.xzx;\n\tvec4 j = p - 49.0 * floor(p * ns.z * ns.z); // mod(p, 7 * 7)\n\tvec4 x_ = floor(j * ns.z);\n\tvec4 y_ = floor(j - 7.0 * x_); // mod(j, N)\n\tvec4 x = x_ * ns.x + ns.yyyy;\n\tvec4 y = y_ * ns.x + ns.yyyy;\n\tvec4 h = 1.0 - abs(x) - abs(y);\n\tvec4 b0 = vec4(x.xy, y.xy);\n\tvec4 b1 = vec4(x.zw, y.zw);\n\t//vec4 s0 = vec4(lessThan(b0, 0.0)) * 2.0 - 1.0;\n\t//vec4 s1 = vec4(lessThan(b1, 0.0)) * 2.0 - 1.0;\n\tvec4 s0 = floor(b0) * 2.0 + 1.0;\n\tvec4 s1 = floor(b1) * 2.0 + 1.0;\n\tvec4 sh = -step(h, vec4(0.0));\n\tvec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy ;\n\tvec4 a1 = b1.xzyw + s1.xzyw * sh.zzww ;\n\tvec3 p0 = vec3(a0.xy, h.x);\n\tvec3 p1 = vec3(a0.zw, h.y);\n\tvec3 p2 = vec3(a1.xy, h.z);\n\tvec3 p3 = vec3(a1.zw, h.w);\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tvec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n\tm = m * m;\n\treturn 42.0 * dot(m*m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n}\n#endif\n",p.util.shader.snoise4d="#ifndef NOISE4D\n#define NOISE4D\nvec4 grad4(float j, vec4 ip)\n\t{\n\tconst vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\n\tvec4 p, s;\n\n\tp.xyz = floor(fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\n\tp.w = 1.5 - dot(abs(p.xyz), ones.xyz);\n\ts = vec4(lessThan(p, vec4(0.0)));\n\tp.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\n\n\treturn p;\n\t}\n\n#define F4 0.309016994374947451\n\nfloat snoise(vec4 v)\n\t{\n\tconst vec4 C = vec4(0.138196601125011, // (5 - sqrt(5))/20 G4\n\t\t\t\t\t\t0.276393202250021, // 2 * G4\n\t\t\t\t\t\t0.414589803375032, // 3 * G4\n\t\t\t\t\t\t-0.447213595499958); // -1 + 4 * G4\n\n\tvec4 i = floor(v + dot(v, vec4(F4)));\n\tvec4 x0 = v - i + dot(i, C.xxxx);\n\n\n\tvec4 i0;\n\tvec3 isX = step(x0.yzw, x0.xxx);\n\tvec3 isYZ = step(x0.zww, x0.yyz);\n\ti0.x = isX.x + isX.y + isX.z;\n\ti0.yzw = 1.0 - isX;\n\ti0.y += isYZ.x + isYZ.y;\n\ti0.zw += 1.0 - isYZ.xy;\n\ti0.z += isYZ.z;\n\ti0.w += 1.0 - isYZ.z;\n\n\tvec4 i3 = clamp(i0, 0.0, 1.0);\n\tvec4 i2 = clamp(i0 - 1.0, 0.0, 1.0);\n\tvec4 i1 = clamp(i0 - 2.0, 0.0, 1.0);\n\n\tvec4 x1 = x0 - i1 + C.xxxx;\n\tvec4 x2 = x0 - i2 + C.yyyy;\n\tvec4 x3 = x0 - i3 + C.zzzz;\n\tvec4 x4 = x0 + C.wwww;\n\n\ti = mod289(i);\n\tfloat j0 = permute(permute(permute(permute(i.w) + i.z) + i.y) + i.x);\n\tvec4 j1 = permute(permute(permute(permute (\n\t\t\t\t\ti.w + vec4(i1.w, i2.w, i3.w, 1.0))\n\t\t\t\t\t+ i.z + vec4(i1.z, i2.z, i3.z, 1.0))\n\t\t\t\t\t+ i.y + vec4(i1.y, i2.y, i3.y, 1.0))\n\t\t\t\t\t+ i.x + vec4(i1.x, i2.x, i3.x, 1.0));\n\n\tvec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\n\n\tvec4 p0 = grad4(j0, ip);\n\tvec4 p1 = grad4(j1.x, ip);\n\tvec4 p2 = grad4(j1.y, ip);\n\tvec4 p3 = grad4(j1.z, ip);\n\tvec4 p4 = grad4(j1.w, ip);\n\n\tvec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n\tp0 *= norm.x;\n\tp1 *= norm.y;\n\tp2 *= norm.z;\n\tp3 *= norm.w;\n\tp4 *= taylorInvSqrt(dot(p4, p4));\n\n\tvec3 m0 = max(0.6 - vec3(dot(x0, x0), dot(x1, x1), dot(x2, x2)), 0.0);\n\tvec2 m1 = max(0.6 - vec2(dot(x3, x3), dot(x4, x4)), 0.0);\n\tm0 = m0 * m0;\n\tm1 = m1 * m1;\n\treturn 49.0 * (dot(m0*m0, vec3(dot(p0, x0), dot(p1, x1), dot(p2, x2)))\n\t\t\t\t\t\t\t+ dot(m1*m1, vec2(dot(p3, x3), dot(p4, x4)))) ;\n}\n#endif\n",p})},function(e,t,i){function o(e){return i(r(e))}function r(e){var t=n[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var n={"./seriously.accumulator":89,"./seriously.accumulator.js":89,"./seriously.ascii":90,"./seriously.ascii.js":90,"./seriously.bleach-bypass":91,"./seriously.bleach-bypass.js":91,"./seriously.blend":92,"./seriously.blend.js":92,"./seriously.blur":93,"./seriously.blur.js":93,"./seriously.brightness-contrast":94,"./seriously.brightness-contrast.js":94,"./seriously.channels":95,"./seriously.channels.js":95,"./seriously.checkerboard":96,"./seriously.checkerboard.js":96,"./seriously.chroma":97,"./seriously.chroma.js":97,"./seriously.color":98,"./seriously.color-select":99,"./seriously.color-select.js":99,"./seriously.color.js":98,"./seriously.colorcomplements":100,"./seriously.colorcomplements.js":100,"./seriously.colorcube":101,"./seriously.colorcube.js":101,"./seriously.crop":102,"./seriously.crop.js":102,"./seriously.daltonize":103,"./seriously.daltonize.js":103,"./seriously.directionblur":104,"./seriously.directionblur.js":104,"./seriously.dither":105,"./seriously.dither.js":105,"./seriously.edge":106,"./seriously.edge.js":106,"./seriously.emboss":107,"./seriously.emboss.js":107,"./seriously.exposure":108,"./seriously.exposure.js":108,"./seriously.expression":109,"./seriously.expression.js":109,"./seriously.fader":110,"./seriously.fader.js":110,"./seriously.falsecolor":111,"./seriously.falsecolor.js":111,"./seriously.filmgrain":112,"./seriously.filmgrain.js":112,"./seriously.freeze":113,"./seriously.freeze.js":113,"./seriously.fxaa":114,"./seriously.fxaa.js":114,"./seriously.hex":115,"./seriously.hex.js":115,"./seriously.highlights-shadows":116,"./seriously.highlights-shadows.js":116,"./seriously.hue-saturation":117,"./seriously.hue-saturation.js":117,"./seriously.invert":118,"./seriously.invert.js":118,"./seriously.js":87,"./seriously.kaleidoscope":119,"./seriously.kaleidoscope.js":119,"./seriously.layers":120,"./seriously.layers.js":120,"./seriously.linear-transfer":121,"./seriously.linear-transfer.js":121,"./seriously.lumakey":122,"./seriously.lumakey.js":122,"./seriously.lut":123,"./seriously.lut.js":123,"./seriously.mirror":124,"./seriously.mirror.js":124,"./seriously.nightvision":125,"./seriously.nightvision.js":125,"./seriously.noise":126,"./seriously.noise.js":126,"./seriously.opticalflow":127,"./seriously.opticalflow.js":127,"./seriously.panorama":128,"./seriously.panorama.js":128,"./seriously.pixelate":129,"./seriously.pixelate.js":129,"./seriously.polar":130,"./seriously.polar.js":130,"./seriously.repeat":131,"./seriously.repeat.js":131,"./seriously.ripple":132,"./seriously.ripple.js":132,"./seriously.scanlines":133,"./seriously.scanlines.js":133,"./seriously.select":134,"./seriously.select.js":134,"./seriously.sepia":135,"./seriously.sepia.js":135,"./seriously.simplex":136,"./seriously.simplex.js":136,"./seriously.sketch":137,"./seriously.sketch.js":137,"./seriously.split":138,"./seriously.split.js":138,"./seriously.temperature":139,"./seriously.temperature.js":139,"./seriously.throttle":140,"./seriously.throttle.js":140,"./seriously.tone":141,"./seriously.tone.js":141,"./seriously.tvglitch":142,"./seriously.tvglitch.js":142,"./seriously.vibrance":143,"./seriously.vibrance.js":143,"./seriously.vignette":144,"./seriously.vignette.js":144,"./seriously.whitebalance":145,"./seriously.whitebalance.js":145};o.keys=function(){return Object.keys(n)},o.resolve=r,e.exports=o,o.id=88},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";function t(e,t,i){function o(e){var o={base:(t||"base")+"."+e,blend:(i||"blend")+"."+e};return function(e){return o[e]||e}}return"vec3("+e.replace(/blend|base/g,o("r"))+", "+e.replace(/blend|base/g,o("g"))+", "+e.replace(/blend|base/g,o("b"))+")"}var i={normal:"blend",lighten:"max(blend, base)",darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:t("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:t("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:t("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))","blend","base"),colordodge:t("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:t("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:t("BlendLinearLightf(base, blend)"),vividlight:t("BlendVividLightf(base, blend)"),pinlight:t("BlendPinLightf(base, blend)"),hardmix:t("BlendHardMixf(base, blend)"),reflect:t("BlendReflectf(base, blend)"),glow:t("BlendReflectf(blend, base)")},o={normal:!0};e.plugin("accumulator",function(){function t(){var e=a.gl,t=a.width,i=a.height,o=a.inputs.startColor;e&&t&&i&&(e.viewport(0,0,t,i),e.clearColor.apply(e,o),e.bindFramebuffer(e.FRAMEBUFFER,n[0].frameBuffer),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,n[1].frameBuffer),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT))}var r={clear:!1},n=void 0,s=0,a=this,u=this.width,l=this.height;return{initialize:function(i,o){i(),n=[this.frameBuffer,new e.util.FrameBuffer(o,this.width,this.height)],t()},shader:function(e,t){var r=e.blendMode||"normal";return r=r.toLowerCase(),t.fragment=["#define SHADER_NAME seriously.accumulator."+r,"precision mediump float;","const vec3 ZERO = vec3(0.0);","const vec3 ONE = vec3(1.0);","const vec3 HALF = vec3(0.5);","const vec3 TWO = vec3(2.0);","#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)","#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)","#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)","#define BlendLightenf(base, blend)\t\tmax(blend, base)","#define BlendDarkenf(base, blend)\t\tmin(blend, base)","#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))","#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))","#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))","#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))","#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))","#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))","#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))","#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))","#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)","#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))","vec3 RGBToHSL(vec3 color) {","\tvec3 hsl;","\tfloat fmin = min(min(color.r, color.g), color.b);","\tfloat fmax = max(max(color.r, color.g), color.b);","\tfloat delta = fmax - fmin;","\thsl.z = (fmax + fmin) / 2.0;","\tif (delta == 0.0) {","\t\thsl.x = 0.0;","\t\thsl.y = 0.0;","\t} else {","\t\tif (hsl.z < 0.5)","\t\t\thsl.y = delta / (fmax + fmin);","\t\telse","\t\t\thsl.y = delta / (2.0 - fmax - fmin);","\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;","\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;","\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;","\t\tif (color.r == fmax )","\t\t\thsl.x = deltaB - deltaG;","\t\telse if (color.g == fmax)","\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;","\t\telse if (color.b == fmax)","\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;","\t\tif (hsl.x < 0.0)","\t\t\thsl.x += 1.0;","\t\telse if (hsl.x > 1.0)","\t\t\thsl.x -= 1.0;","\t}","\treturn hsl;","}","float HueToRGB(float f1, float f2, float hue) {","\tif (hue < 0.0)","\t\thue += 1.0;","\telse if (hue > 1.0)","\t\thue -= 1.0;","\tfloat res;","\tif ((6.0 * hue) < 1.0)","\t\tres = f1 + (f2 - f1) * 6.0 * hue;","\telse if ((2.0 * hue) < 1.0)","\t\tres = f2;","\telse if ((3.0 * hue) < 2.0)","\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;","\telse","\t\tres = f1;","\treturn res;","}","vec3 HSLToRGB(vec3 hsl) {","\tvec3 rgb;","\tif (hsl.y == 0.0)","\t\trgb = vec3(hsl.z);","\telse {","\t\tfloat f2;","\t\tif (hsl.z < 0.5)","\t\t\tf2 = hsl.z * (1.0 + hsl.y);","\t\telse","\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);","\t\tfloat f1 = 2.0 * hsl.z - f2;","\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));","\t\trgb.g = HueToRGB(f1, f2, hsl.x);","\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));","\t}","\treturn rgb;","}","vec3 BlendHue(vec3 base, vec3 blend) {","\tvec3 baseHSL = RGBToHSL(base);","\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));","}","vec3 BlendSaturation(vec3 base, vec3 blend) {","\tvec3 baseHSL = RGBToHSL(base);","\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));","}","vec3 BlendColor(vec3 base, vec3 blend) {","\tvec3 blendHSL = RGBToHSL(blend);","\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));","}","vec3 BlendLuminosity(vec3 base, vec3 blend) {","\tvec3 baseHSL = RGBToHSL(base);","\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));","}","vec3 BlendLighterColor(vec3 base, vec3 blend) {","\tfloat baseTotal = base.r + base.g + base.b;","\tfloat blendTotal = blend.r + blend.g + blend.b;","\treturn blendTotal > baseTotal ? blend : base;","}","vec3 BlendDarkerColor(vec3 base, vec3 blend) {","\tfloat baseTotal = base.r + base.g + base.b;","\tfloat blendTotal = blend.r + blend.g + blend.b;","\treturn blendTotal < baseTotal ? blend : base;","}","#define BlendFunction(base, blend) "+i[r],o[r]?"#define MIX_ALPHA":"","varying vec2 vTexCoord;","uniform sampler2D source;","uniform sampler2D previous;","uniform float opacity;","uniform float blendGamma;","vec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {","\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);","\treturn mix(base.rgb, blendedColor, opacity * blend.a);","}","vec4 linear(vec4 color, vec3 gamma) {","\treturn vec4(pow(color.rgb, gamma), color.a);","}","void main(void) {","\tvec3 exp = vec3(blendGamma);","\tvec4 topPixel = linear(texture2D(source, vTexCoord), exp);","\tvec4 bottomPixel = texture2D(previous, vTexCoord);","\tif (topPixel.a == 0.0) {","\t\tgl_FragColor = bottomPixel;","\t} else {","\t\tfloat alpha;","#ifdef MIX_ALPHA","\t\talpha = topPixel.a * opacity;","\t\talpha = alpha + bottomPixel.a * (1.0 - alpha);","#else","\t\talpha = bottomPixel.a;","#endif","\t\tbottomPixel = linear(bottomPixel, exp);","\t\tgl_FragColor = vec4(pow(BlendOpacity(bottomPixel, topPixel, opacity), 1.0 / exp), alpha);","\t}","}"].join("\n"),t},resize:function(){!n||this.width===u&&this.height===l||(u=this.width,l=this.height,n[0].resize(u,l),n[1].resize(u,l),t())},draw:function(e,i,o,a,u){var l=void 0;if(this.uniforms.previous=this.frameBuffer.texture,s=(s+1)%2,l=n[s],this.frameBuffer=l,this.texture=l.texture,this.inputs.clear)return t(),void u(this.baseShader,i,o,l.frameBuffer,null);u(e,i,o,l.frameBuffer,null,r)},destroy:function(){n&&(n[0].destroy(),n[1].destroy(),n.length=0)}}},{inPlace:!1,title:"Accumulator",description:"Draw on top of previous frame",inputs:{source:{type:"image",uniform:"source"},clear:{type:"boolean",defaultValue:!1},startColor:{type:"color",defaultValue:[0,0,0,0]},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4},blendMode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight","Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight","Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]]}}})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";var t=void 0,i=void 0;i=document.createElement("img"),i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAvAAAAAICAYAAACf+MsnAAAFY0lEQVR4Xu2Z644bOwyDN+//0NsOigEMQdRHyU6CFDnA+bHVWNaFojiTx8/Pz+/f/4/89/v7z9Xj8Tjib3XyTN9usFcMz8gt3h9zXf/O6nD/W1V7Vb9uXad+nHucZ9xenX7OqTHdSfmRXfmPsSn8xPMrllcfCkdVfHSe7Ned0/yp7jv2GPfqK+MCByc0zzvxKi5RPq8cuvE4+JrwpFM7N78K2yu+qb9kd3qV+ZjUx5n/+xnXP81ctW/UHQ5P3Gd360vxKf+n8dGpxXTeKu6h2ansFT6pvo5G2/FP99NsUf9d/xleInfetcj629m9cf9WOV5K+78R8ERGRLYO8VQiecd/1vwKEJV46JBJRzhRfXftVL/MTgM48UmL0l2OSmzs9kctAJfE4/1KkNFzbj8cjFHsJ/u460vhnPDfqddujJ27poLCWWBuHt0YKr/ki+yOKJnk5Z7pPLfLf4TZif+qvi7XuDWg+HbtNEe79ds9H7m1m2/3+YzLK5Hc9e/gYxdfNP+ZfdV9lT3usWn+9310/qiAdxa1O5gTEqVhoLudxVwVNPrvCqDp/ZX4d0Uk1Y7sbgyU4zooCk8nB3i9Y61V5wWpIjDlP+ZJsxPvmLxEOD2sntk5Pz1LBOb0L+sPfQGs6ksYpt7QAiHuUwtkgl+F3Qyf2YxTX53+Vdjfjc8VYIq7KT+abzof7ervZ8fX8d/Jyc3PmTcnRrrPEbyVTnD8T+Y38pH624mfNIr6muzO95S/sh1Gvog/XmW/a6N+scww43zgqLjcOX9cwFeESQK3Gpx32QggTlwk8Ei8OXfE4VMLeCLQiLBjfJM7VA069XefnZBGJz7Vr24dK3GwEoqLD7p/1+4IMWdRdxaMK9CmP4E62F7nm8S7s4B3BMCkBzQPVQ0IM06+2WLvzlDlI+NfF4d0ljiHuF/Zb/4m/4ojTgnA6f0qfiWA135P5l/NoFv/7txm+5ZyyOw0e1R/skd8ZKKwwnjXf9xLrkBV+2x3Pib9Vz3JOMaNL/KZ+oCkXhDUTLxEwLsC41OfI5DEYe9+mXfr0l2mJH5ISHTOUw2U8IjD5LyVUtxEmrvi4V5ejvijWNWicBbOyfsrYejkMMXmdIFEAZH19ASWnNyrPlBdKH+yU3y0gGjGKf4Mv51ft9zzKk83vul5qr9r7+CT9gHx2zvs0/yofpGX1AuC4svqhYJeJJydNZk/urcSxet91dfiUy94HX6oBHCHi5+F38svCeg1h+zZ6nyF5VUzVC8Q0X9LwE/IkMjmpJ3i27XvxuqQ0c4dp/JTfnb9T847AoNIW/nokIYrYKvnJvln/siPwtD0XAeTU+x0luEugWdLNeY4ecl260vxK8Efl3OnZi4uaZZIMBFeJ/hw6xrFvppvV1Q559d8MwwR50cskIBQ2KhE3y7/ZeddAUjxOr3diZ/8U3+I953z7uzR7Lj4rvjl9HxXvaHaOflSfSkf93y24xx94PpX89I5H2t9+fwK+KVzNOwdIeM+e905+ZqqRIj7pYHiU3FNFnBnkO+41EKige3cpX7GunwoARfjIwKrxNhEJFLfMrsbI+G/smfkojAa60vxPcNeCZCqhjSra6ydBaAWSFzaqnb01c4VEdVCWWPM7svstKDWuKrZpwUb7dVsOzPcxUeGdYdfdgV8Vr+Mv1R8Tn/iHcSNWR8jjjv9URzama9qbp0XlBP4y2Jw6u/E577AZTVz/BM/OfySzSjl79o73FRxaFdfuPG5/XE58PbXEvAT8UBn1HKuSIB8ThYwiZfJnd8z768Aib/3R/iN4J0VeMXcVwvynbl/735OBV6BKTfyT+e/T4/f7dP3uW8F3Aqs/PIHbWXeeeKjnSsAAAAASUVORK5CYII=",t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e.plugin("ascii",function(){function o(){l=h.height,u=h.width,c=Math.ceil(u/8),f=Math.ceil(l/8),d.resolution=h.uniforms.resolution,d.transform=t,n&&n.resize(c,f)}var r=void 0,n=void 0,s=void 0,a=void 0,u=void 0,l=void 0,c=void 0,f=void 0,d={},h=this;return{initialize:function(u){function l(){a.bindTexture(a.TEXTURE_2D,s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,i),a.bindTexture(a.TEXTURE_2D,null)}var h=this;u(),this.texture=this.frameBuffer.texture,a=this.gl,s=a.createTexture(),i.naturalWidth?l():i.addEventListener("load",function(){l(),h.setDirty()}),d.letters=s,a.bindTexture(a.TEXTURE_2D,this.texture||this.frameBuffer&&this.frameBuffer.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.bindTexture(a.TEXTURE_2D,null),o(),n=new e.util.FrameBuffer(a,c,f),a.bindTexture(a.TEXTURE_2D,n.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),this.uniforms.transform=t,r=this.baseShader},commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform sampler2D letters;","uniform vec4 background;","uniform vec2 resolution;","const vec3 lumcoeff = vec3(0.2125, 0.7154, 0.0721);","const vec2 fontSize = vec2(8.0, 8.0);","vec4 lookup(float ascii) {","\tvec2 pos = mod(vTexCoord * resolution, fontSize) / vec2(752.0, fontSize.x) + vec2(ascii, 0.0);","\treturn texture2D(letters, pos);","}","void main(void) {","\tvec4 sample = texture2D(source, vTexCoord);","\tvec4 clamped = vec4(floor(sample.rgb * 8.0) / 8.0, sample.a);","\tfloat luma = dot(sample.rgb,lumcoeff);","\tfloat char = floor(luma * 94.0) / 94.0;","\tgl_FragColor = mix(background, clamped, lookup(char).r);","}"].join("\n"),t},resize:o,draw:function(e,t,i,o,s){s(r,t,i,n.frameBuffer,!1,{width:c,height:f,blend:!1}),d.source=n.texture,d.background=i.background,s(e,t,d,o)},destroy:function(){n&&n.destroy(),a&&s&&a.deleteTexture(s)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},background:{type:"color",uniform:"background",defaultValue:[0,0,0,1]}},description:"Display image as ascii text in 8-bit color.",title:"Ascii Text"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("bleach-bypass",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float amount;","const vec4 one = vec4(1.0);","const vec4 two = vec4(2.0);","const vec4 lumcoeff = vec4(0.2125,0.7154,0.0721,0.0);","vec4 overlay(vec4 myInput, vec4 previousmix, vec4 amount) {","\tfloat luminance = dot(previousmix,lumcoeff);","\tfloat mixamount = clamp((luminance - 0.45) * 10.0, 0.0, 1.0);","\tvec4 branch1 = two * previousmix * myInput;","\tvec4 branch2 = one - (two * (one - previousmix) * (one - myInput));","\tvec4 result = mix(branch1, branch2, vec4(mixamount) );","\treturn mix(previousmix, result, amount);","}","void main (void)  {","\tvec4 pixel = texture2D(source, vTexCoord);","\tvec4 luma = vec4(vec3(dot(pixel,lumcoeff)), pixel.a);","\tgl_FragColor = overlay(luma, pixel, vec4(amount));","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:1,min:0,max:1}},title:"Bleach Bypass",categories:["film"],description:["Bleach Bypass film treatment","http://en.wikipedia.org/wiki/Bleach_bypass",'see: "Saving Private Ryan", "Minority Report"'].join("\n")})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";function t(e,t,i){function o(e){var o={base:(t||"base")+"."+e,blend:(i||"blend")+"."+e};return function(e){return o[e]||e}}return"vec3("+e.replace(/blend|base/g,o("r"))+", "+e.replace(/blend|base/g,o("g"))+", "+e.replace(/blend|base/g,o("b"))+")"}var i={normal:"blend",lighten:"max(blend, base)",darken:"min(blend, base)",multiply:"(base * blend)",average:"(base + blend / TWO)",add:"min(base + blend, ONE)",subtract:"max(base - blend, ZERO)",divide:"base / blend",difference:"abs(base - blend)",negation:"(ONE - abs(ONE - base - blend))",exclusion:"(base + blend - TWO * base * blend)",screen:"(ONE - ((ONE - base) * (ONE - blend)))",lineardodge:"min(base + blend, ONE)",phoenix:"(min(base, blend) - max(base, blend) + ONE)",linearburn:"max(base + blend - ONE, ZERO)",hue:"BlendHue(base, blend)",saturation:"BlendSaturation(base, blend)",color:"BlendColor(base, blend)",luminosity:"BlendLuminosity(base, blend)",darkercolor:"BlendDarkerColor(base, blend)",lightercolor:"BlendLighterColor(base, blend)",overlay:t("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))"),softlight:t("blend < 0.5 ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend))"),hardlight:t("base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend))","blend","base"),colordodge:t("blend == 1.0 ? blend : min(base / (1.0 - blend), 1.0)"),colorburn:t("blend == 0.0 ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0)"),linearlight:t("BlendLinearLightf(base, blend)"),vividlight:t("BlendVividLightf(base, blend)"),pinlight:t("BlendPinLightf(base, blend)"),hardmix:t("BlendHardMixf(base, blend)"),reflect:t("BlendReflectf(base, blend)"),glow:t("BlendReflectf(blend, base)")},o={},r=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);e.plugin("blend",function(){function e(){var e=a&&o[a.mode];e&&u&&(s.blendEquation=u[e[0]],s.srcRGB=u[e[1]],s.dstRGB=u[e[2]],s.srcAlpha=u[e[3]],s.dstAlpha=u[e[4]])}var t=void 0,n=void 0,s={clear:!1},a=void 0,u=void 0;return this.resize=function(){var e=void 0,i=void 0,o=this.inputs.sizeMode,r=void 0,s=void 0,a=void 0,u=this.inputs.bottom,l=this.inputs.top;for("bottom"===o||"top"===o?(r=this.inputs[o],r?(e=r.width,i=r.height):(e=1,i=1)):u?l?(s="union"===o?Math.max:Math.min,e=s(u.width,l.width),i=s(u.height,l.height)):(e=u.width,i=u.height):l?(e=l.width,i=l.height):(e=1,i=1),this.width===e&&this.height===i||(this.width=e,this.height=i,this.uniforms.resolution[0]=e,this.uniforms.resolution[1]=i,this.frameBuffer&&this.frameBuffer.resize(e,i),this.emit("resize"),this.setDirty()),this.uniforms.resBottom[0]=u&&u.width||1,this.uniforms.resBottom[1]=u&&u.height||1,this.uniforms.resTop[0]=l&&l.width||1,this.uniforms.resTop[1]=l&&l.height||1,t&&(u&&(n.resolution[0]=u.width,n.resolution[1]=u.height),l&&(t.resolution[0]=l.width,t.resolution[1]=l.height)),a=0;a<this.targets.length;a++)this.targets[a].resize()},this.uniforms.resTop=[1,1],this.uniforms.resBottom=[1,1],{initialize:function(t){a=this.inputs,t(),u=this.gl,e()},shader:function(e,s){var a=e.mode||"normal",u=void 0;return a=a.toLowerCase(),o[a]?(t||(u=this.inputs.top,t={resolution:[u&&u.width||1,u&&u.height||1],targetRes:this.uniforms.resolution,source:u,transform:u&&u.cumulativeMatrix||r,opacity:this.inputs.opacity},u=this.inputs.bottom,n={resolution:[u&&u.width||1,u&&u.height||1],targetRes:this.uniforms.resolution,source:u,transform:u&&u.cumulativeMatrix||r,opacity:1}),s.vertex=["#define SHADER_NAME seriously.blend."+a,"precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform vec2 targetRes;","uniform mat4 transform;","varying vec2 vTexCoord;","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.xy *= resolution / targetRes;","\tgl_Position.w = screenPosition.w;","\tvTexCoord = texCoord;","}\n"].join("\n"),s.fragment=["#define SHADER_NAME seriously.blend."+a,"precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float opacity;","void main(void) {","\tgl_FragColor = texture2D(source, vTexCoord);","\tgl_FragColor.a *= opacity;","}"].join("\n"),s):(t=null,n=null,s.vertex=["#define SHADER_NAME seriously.blend."+a,"precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform vec2 resBottom;","uniform vec2 resTop;","varying vec2 texCoordBottom;","varying vec2 texCoordTop;","const vec2 HALF = vec2(0.5);","void main(void) {","\tgl_Position = position;","\tvec2 adjusted = (texCoord - HALF) * resolution;","\ttexCoordBottom = adjusted / resBottom + HALF;","\ttexCoordTop = adjusted / resTop + HALF;","}"].join("\n"),s.fragment=["#define SHADER_NAME seriously.blend."+a,"precision mediump float;","const vec3 ZERO = vec3(0.0);","const vec3 ONE = vec3(1.0);","const vec3 HALF = vec3(0.5);","const vec3 TWO = vec3(2.0);","#define BlendAddf(base, blend)\t\t\tmin(base + blend, 1.0)","#define BlendLinearDodgef(base, blend)\tBlendAddf(base, blend)","#define BlendLinearBurnf(base, blend)\tmax(base + blend - 1.0, 0.0)","#define BlendLightenf(base, blend)\t\tmax(blend, base)","#define BlendDarkenf(base, blend)\t\tmin(blend, base)","#define BlendLinearLightf(base, blend)\t(blend < 0.5 ? BlendLinearBurnf(base, (2.0 * blend)) : BlendLinearDodgef(base, (2.0 * (blend - 0.5))))","#define BlendScreenf(base, blend)\t\t(1.0 - ((1.0 - base) * (1.0 - blend)))","#define BlendOverlayf(base, blend)\t\t(base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))","#define BlendSoftLightf(base, blend)\t((blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend)))","#define BlendColorDodgef(base, blend)\t((blend == 1.0) ? blend : min(base / (1.0 - blend), 1.0))","#define BlendColorBurnf(base, blend)\t((blend == 0.0) ? blend : max((1.0 - ((1.0 - base) / blend)), 0.0))","#define BlendVividLightf(base, blend)\t((blend < 0.5) ? BlendColorBurnf(base, (2.0 * blend)) : BlendColorDodgef(base, (2.0 * (blend - 0.5))))","#define BlendPinLightf(base, blend)\t((blend < 0.5) ? BlendDarkenf(base, (2.0 * blend)) : BlendLightenf(base, (2.0 *(blend - 0.5))))","#define BlendHardMixf(base, blend)\t\t((BlendVividLightf(base, blend) < 0.5) ? 0.0 : 1.0)","#define BlendReflectf(base, blend)\t\t((blend == 1.0) ? blend : min(base * base / (1.0 - blend), 1.0))","vec3 RGBToHSL(vec3 color) {","\tvec3 hsl;","\tfloat fmin = min(min(color.r, color.g), color.b);","\tfloat fmax = max(max(color.r, color.g), color.b);","\tfloat delta = fmax - fmin;","\thsl.z = (fmax + fmin) / 2.0;","\tif (delta == 0.0) {","\t\thsl.x = 0.0;","\t\thsl.y = 0.0;","\t} else {","\t\tif (hsl.z < 0.5)","\t\t\thsl.y = delta / (fmax + fmin);","\t\telse","\t\t\thsl.y = delta / (2.0 - fmax - fmin);","\t\tfloat deltaR = (((fmax - color.r) / 6.0) + (delta / 2.0)) / delta;","\t\tfloat deltaG = (((fmax - color.g) / 6.0) + (delta / 2.0)) / delta;","\t\tfloat deltaB = (((fmax - color.b) / 6.0) + (delta / 2.0)) / delta;","\t\tif (color.r == fmax )","\t\t\thsl.x = deltaB - deltaG;","\t\telse if (color.g == fmax)","\t\t\thsl.x = (1.0 / 3.0) + deltaR - deltaB;","\t\telse if (color.b == fmax)","\t\t\thsl.x = (2.0 / 3.0) + deltaG - deltaR;","\t\tif (hsl.x < 0.0)","\t\t\thsl.x += 1.0;","\t\telse if (hsl.x > 1.0)","\t\t\thsl.x -= 1.0;","\t}","\treturn hsl;","}","float HueToRGB(float f1, float f2, float hue) {","\tif (hue < 0.0)","\t\thue += 1.0;","\telse if (hue > 1.0)","\t\thue -= 1.0;","\tfloat res;","\tif ((6.0 * hue) < 1.0)","\t\tres = f1 + (f2 - f1) * 6.0 * hue;","\telse if ((2.0 * hue) < 1.0)","\t\tres = f2;","\telse if ((3.0 * hue) < 2.0)","\t\tres = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;","\telse","\t\tres = f1;","\treturn res;","}","vec3 HSLToRGB(vec3 hsl) {","\tvec3 rgb;","\tif (hsl.y == 0.0)","\t\trgb = vec3(hsl.z);","\telse {","\t\tfloat f2;","\t\tif (hsl.z < 0.5)","\t\t\tf2 = hsl.z * (1.0 + hsl.y);","\t\telse","\t\t\tf2 = (hsl.z + hsl.y) - (hsl.y * hsl.z);","\t\tfloat f1 = 2.0 * hsl.z - f2;","\t\trgb.r = HueToRGB(f1, f2, hsl.x + (1.0/3.0));","\t\trgb.g = HueToRGB(f1, f2, hsl.x);","\t\trgb.b= HueToRGB(f1, f2, hsl.x - (1.0/3.0));","\t}","\treturn rgb;","}","vec3 BlendHue(vec3 base, vec3 blend) {","\tvec3 baseHSL = RGBToHSL(base);","\treturn HSLToRGB(vec3(RGBToHSL(blend).r, baseHSL.g, baseHSL.b));","}","vec3 BlendSaturation(vec3 base, vec3 blend) {","\tvec3 baseHSL = RGBToHSL(base);","\treturn HSLToRGB(vec3(baseHSL.r, RGBToHSL(blend).g, baseHSL.b));","}","vec3 BlendColor(vec3 base, vec3 blend) {","\tvec3 blendHSL = RGBToHSL(blend);","\treturn HSLToRGB(vec3(blendHSL.r, blendHSL.g, RGBToHSL(base).b));","}","vec3 BlendLuminosity(vec3 base, vec3 blend) {","\tvec3 baseHSL = RGBToHSL(base);","\treturn HSLToRGB(vec3(baseHSL.r, baseHSL.g, RGBToHSL(blend).b));","}","vec3 BlendLighterColor(vec3 base, vec3 blend) {","\tfloat baseTotal = base.r + base.g + base.b;","\tfloat blendTotal = blend.r + blend.g + blend.b;","\treturn blendTotal > baseTotal ? blend : base;","}","vec3 BlendDarkerColor(vec3 base, vec3 blend) {","\tfloat baseTotal = base.r + base.g + base.b;","\tfloat blendTotal = blend.r + blend.g + blend.b;","\treturn blendTotal < baseTotal ? blend : base;","}","#define BlendFunction(base, blend) "+i[a],"varying vec2 texCoordBottom;","varying vec2 texCoordTop;","uniform sampler2D top;","uniform sampler2D bottom;","uniform float opacity;","uniform float blendGamma;","vec3 BlendOpacity(vec4 base, vec4 blend, float opacity) {","\tvec3 blendedColor = BlendFunction(base.rgb, blend.rgb);","\treturn mix(base.rgb, blendedColor, opacity * blend.a);","}","vec4 linear(vec4 color, vec3 gamma) {","\treturn vec4(pow(color.rgb, gamma), color.a);","}","void main(void) {","\tvec3 exp = vec3(blendGamma);","\tvec4 topPixel = linear(texture2D(top, texCoordTop), exp);","\tvec4 bottomPixel = texture2D(bottom, texCoordBottom);","\tif (topPixel.a == 0.0) {","\t\tgl_FragColor = bottomPixel;","\t} else {","\t\tbottomPixel = linear(bottomPixel, exp);","\t\tgl_FragColor = vec4(pow(BlendOpacity(bottomPixel, topPixel, opacity), 1.0 / exp), bottomPixel.a);","\t}","}"].join("\n"),s)},draw:function(e,i,r,a,l){o[this.inputs.mode]?(this.inputs.bottom?l(e,i,n,a):(u.viewport(0,0,this.width,this.height),u.bindFramebuffer(u.FRAMEBUFFER,a),u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT)),this.inputs.top&&this.inputs.opacity&&l(e,i,t,a,null,s)):l(e,i,r,a)},requires:function(e){return!(!this.inputs.opacity&&"top"===e)},inputs:{top:{type:"image",uniform:"top",update:function(){t&&(t.source=this.inputs.top,t.transform=this.inputs.top.cumulativeMatrix||r),this.resize()}},bottom:{type:"image",uniform:"bottom",update:function(){n&&(n.source=this.inputs.bottom,n.transform=this.inputs.bottom.cumulativeMatrix||r),this.resize()}},opacity:{type:"number",uniform:"opacity",defaultValue:1,min:0,max:1,updateSources:!0,update:function(e){t&&(t.opacity=e)}},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4},sizeMode:{type:"enum",defaultValue:"bottom",options:["bottom","top","union","intersection"],update:function(){this.resize()}},mode:{type:"enum",shaderDirty:!0,defaultValue:"normal",options:[["normal","Normal"],["lighten","Lighten"],["darken","Darken"],["multiply","Multiply"],["average","Average"],["add","Add"],["subtract","Subtract"],["divide","Divide"],["difference","Difference"],["negation","Negation"],["exclusion","Exclusion"],["screen","Screen"],["overlay","Overlay"],["softlight","Soft Light"],["hardlight","Hard Light"],["colordodge","Color Dodge"],["colorburn","Color Burn"],["lineardodge","Linear Dodge"],["linearburn","Linear Burn"],["linearlight","Linear Light"],["vividlight","Vivid Light"],["pinlight","Pin Light"],["hardmix","Hard Mix"],["reflect","Reflect"],["glow","Glow"],["phoenix","Phoenix"],["hue","Hue"],["saturation","Saturation"],["color","color"],["luminosity","Luminosity"],["darkercolor","Darker Color"],["lightercolor","Lighter Color"]],update:function(){e()}}}}},{inPlace:function(){return!!o[this.inputs.mode]},description:"Blend two layers",title:"Blend"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";var t=[.2,.3,.5,.8,1],i=t.length-1,o=[1,0],r=[0,1],n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);e.plugin("blur",function(s){var a=void 0,u=void 0,l=void 0,c={amount:0,blendGamma:2,inputScale:1,resolution:[this.width,this.height],transform:n,direction:null};return{initialize:function(t){var i=void 0;t(),(i=this.gl)&&(l=this.baseShader,a=new e.util.FrameBuffer(i,this.width,this.height),u=new e.util.FrameBuffer(i,this.width,this.height))},commonShader:!0,shader:function(e,t){return this.gl,t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","uniform vec2 direction;","uniform float amount;","uniform float inputScale;","const vec2 zero = vec2(0.0);","varying vec2 vTexCoord;","varying vec4 vTexCoords[4];","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position = screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tvTexCoord = texCoord;","\tvec2 one = vec2(1.0) * inputScale;","\tif (inputScale < 1.0) {","\t\tone -= 1.0 / resolution;","\t}","\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));","\tvec2 amount = direction * (inputScale * amount * 5.0 / resolution);","\tfor (int i = 0; i < 4; i++) {","\t\tfloat s = pow(3.0, float(i));","\t\tvTexCoords[i].xy = max(zero, min(one, vTexCoord + amount * s));","\t\tvTexCoords[i].zw = max(zero, min(one, vTexCoord - amount * s));","\t}","}"].join("\n"),t.fragment=["precision mediump float;\n","uniform sampler2D source;","uniform float blendGamma;","varying vec2 vTexCoord;","varying vec4 vTexCoords[4];","vec3 exp;","vec4 sample(sampler2D sampler, vec2 coord) {","\tvec4 pixel = texture2D(sampler, coord);","\tpixel.rgb = pow(pixel.rgb, exp);","\treturn pixel;","}","void main(void) {","\texp = vec3(blendGamma);","\tgl_FragColor = sample(source, vTexCoord) / 9.0;","\tfor (int i = 0; i < 4; i++) {","\t\tgl_FragColor += sample(source, vTexCoords[i].xy) / 9.0;","\t\tgl_FragColor += sample(source, vTexCoords[i].zw) / 9.0;","\t}","\tgl_FragColor.rgb = pow(gl_FragColor.rgb, 1.0 / exp);","}"].join("\n"),t},draw:function(e,n,s,f,d){var h=void 0,m=void 0,p=void 0,v=void 0,g=void 0,x={width:0,height:0,blend:!1},y=1;if(!(p=this.inputs.amount))return s.source=this.inputs.source.texture,void d(l,n,s,f);if(p<=.01)return s.inputScale=1,s.direction=o,s.source=this.inputs.source.texture,d(e,n,s,a.frameBuffer),s.direction=r,s.source=a.texture,void d(e,n,s,f);for(c.amount=p,c.blendGamma=s.blendGamma,c.source=this.inputs.source.texture,h=0;h<t.length;h++)m=Math.min(1,t[h]/p),v=Math.floor(m*this.width),g=Math.floor(m*this.height),c.resolution[0]=v,c.resolution[1]=g,c.inputScale=y,y=m,x.width=v,x.height=g,c.direction=o,d(e,n,c,a.frameBuffer,null,x),c.inputScale=m,c.source=a.texture,c.direction=r,d(e,n,c,h===i?f:u.frameBuffer,null,x),c.source=u.texture},resize:function(){c.resolution[0]=this.width,c.resolution[1]=this.height,a&&(a.resize(this.width,this.height),u.resize(this.width,this.height))},destroy:function(){a&&(a.destroy(),u.destroy(),a=null,u=null),c=null}}},{inputs:{source:{type:"image",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:.2,min:0,max:1},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4}},title:"Gaussian Blur"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("brightness-contrast",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float brightness;","uniform float saturation;","uniform float contrast;","const vec3 half3 = vec3(0.5);","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tvec3 color = pixel.rgb * brightness;","\tcolor = (color - half3) * contrast + half3;","\tgl_FragColor = vec4(color, pixel.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},brightness:{type:"number",uniform:"brightness",defaultValue:1,min:0},contrast:{type:"number",uniform:"contrast",defaultValue:1,min:0}},title:"Brightness/Contrast",description:"Multiply brightness and contrast values. Works the same as CSS filters."})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";var t=["Red","Green","Blue","Alpha"],i={r:0,g:1,b:2,a:3,x:0,y:1,z:2,w:3};e.plugin("channels",function(){function o(e,t,o){var r=void 0;return"string"==typeof e?(r=e.charAt(0).toLowerCase(),r=i[r],void 0===r&&(r=-1),r<0&&(r=parseFloat(e))):r=e,0===r||1===r||2===r||3===r?r:l.inputs[o]}function r(){var e=l.inputs,t=void 0,i=void 0,o=void 0,r=void 0;for(t=0;t<s.length;t++){for(o=s[t],r=u[t],r||(r=u[t]=[],l.uniforms["channels"+t]=r),i=0;i<16;i++)r[i]=0;r[e.red]=e.redSource===o?1:0,r[4+e.green]=e.greenSource===o?1:0,r[8+e.blue]=e.blueSource===o?1:0,r[12+e.alpha]=e.alphaSource===o?1:0}}function n(){function e(e){var i=void 0,o=void 0;i=t[e],i||(i=l.sources[e]=t[e]=t.source),(o=s.indexOf(i))<0&&(o=s.length,s.push(i),l.uniforms["source"+o]=i)}var t=l.inputs;s.length=0,e("redSource"),e("greenSource"),e("blueSource"),e("alphaSource"),l.resize(),r()}var s=[],a=[],u=[],l=this;return this.resize=function(){var e=void 0,t=void 0,i=this.inputs.sizeMode,o=void 0,r=void 0,n=void 0;if(s.length)if(1===s.length)n=s[0],e=n.width,t=n.height;else if("union"===i)for(e=0,t=0,o=0;o<s.length;o++)n=s[0],e=Math.max(e,n.width),t=Math.max(t,n.height);else if("intersection"===i)for(e=1/0,t=1/0,o=0;o<s.length;o++)n=s[0],e=Math.min(e,n.width),t=Math.min(t,n.height);else n=l.inputs[i+"Source"],n?(e=n.width,t=n.height):(e=1,t=1);else e=1,t=1;for(o=0;o<s.length;o++)n=s[o],r=l.uniforms["resolution"+o],r?(r[0]=n.width,r[1]=n.height):l.uniforms["resolution"+o]=[n.width,n.height];for(this.width===e&&this.height===t||(this.width=e,this.height=t,this.uniforms.resolution[0]=e,this.uniforms.resolution[1]=t,this.frameBuffer&&this.frameBuffer.resize(e,t),this.emit("resize"),this.setDirty()),o=0;o<this.targets.length;o++)this.targets[o].resize()},{shader:function(){var t=void 0,i=void 0,o=void 0,r=void 0,n="",u="",l="",c="";if(a[s.length])return a[s.length];for(t=0;t<s.length;t++)l+="varying vec2 vTexCoord"+t+";\n",n+="uniform sampler2D source"+t+";\nuniform mat4 channels"+t+";\nuniform vec2 resolution"+t+";\n\n",c+="    vTexCoord"+t+" = (position.xy * resolution / resolution"+t+") * 0.5 + 0.5;\n",u+="    if (all(greaterThanEqual(vTexCoord"+t+", vec2(0.0))) && all(lessThan(vTexCoord"+t+", vec2(1.0)))) {\n        gl_FragColor += texture2D(source"+t+", vTexCoord"+t+") * channels"+t+";\n    }\n";return o=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;",n,l,"void main(void) {",c,"\tgl_Position = position;","}\n"].join("\n"),i=["precision mediump float;",l,n,"void main(void) {","\tgl_FragColor = vec4(0.0);",u,"}"].join("\n"),r=new e.util.ShaderProgram(this.gl,o,i),a[s.length]=r,r},inputs:{sizeMode:{type:"enum",defaultValue:"red",options:["red","green","blue","alpha","union","intersection"],update:function(){this.resize()}},source:{type:"image",update:n,shaderDirty:!0},redSource:{type:"image",update:n,shaderDirty:!0},greenSource:{type:"image",update:n,shaderDirty:!0},blueSource:{type:"image",update:n,shaderDirty:!0},alphaSource:{type:"image",update:n,shaderDirty:!0},red:{type:"enum",options:t,validate:o,update:r,defaultValue:0},green:{type:"enum",options:t,validate:o,update:r,defaultValue:1},blue:{type:"enum",options:t,validate:o,update:r,defaultValue:2},alpha:{type:"enum",options:t,validate:o,update:r,defaultValue:3}}}},{inPlace:!1,title:"Channel Mapping"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("checkerboard",function(){function e(){t.resize()}var t=this;return{initialize:function(t){t(),e()},shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","uniform vec2 size;","uniform vec2 anchor;","vec2 pixelCoord;","varying vec2 vGridCoord;","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tpixelCoord = resolution * (texCoord - 0.5) / 2.0;","\tvGridCoord = (pixelCoord - anchor) / size;","}\n"].join("\n"),t.fragment=["precision mediump float;","varying vec2 vTexCoord;","varying vec2 vPixelCoord;","varying vec2 vGridCoord;","uniform vec2 resolution;","uniform vec2 anchor;","uniform vec2 size;","uniform vec4 color1;","uniform vec4 color2;","void main(void) {","\tvec2 modGridCoord = floor(mod(vGridCoord, 2.0));","\tif (modGridCoord.x == modGridCoord.y) {","\t\tgl_FragColor = color1;","\t} else  {","\t\tgl_FragColor = color2;","\t}","}"].join("\n"),t},inPlace:!0,inputs:{anchor:{type:"vector",uniform:"anchor",dimensions:2,defaultValue:[0,0]},size:{type:"vector",uniform:"size",dimensions:2,defaultValue:[4,4]},color1:{type:"color",uniform:"color1",defaultValue:[1,1,1,1]},color2:{type:"color",uniform:"color2",defaultValue:[187/255,187/255,187/255,1]},width:{type:"number",min:0,step:1,update:e,defaultValue:640},height:{type:"number",min:0,step:1,update:e,defaultValue:360}}}},{commonShader:!0,title:"Checkerboard",categories:["generator"]})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("chroma",{shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","varying vec2 vTexCoord;","uniform vec4 screen;","uniform float balance;","varying float screenSat;","varying vec3 screenPrimary;","void main(void) {","\tfloat fmin = min(min(screen.r, screen.g), screen.b);","\tfloat fmax = max(max(screen.r, screen.g), screen.b);","\tfloat secondaryComponents;","\tscreenPrimary = step(fmax, screen.rgb);","\tsecondaryComponents = dot(1.0 - screenPrimary, screen.rgb);","\tscreenSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position = screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tvTexCoord = texCoord;","}"].join("\n"),t.fragment=[this.inputs.mask?"#define MASK":"","precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec4 screen;","uniform float screenWeight;","uniform float balance;","uniform float clipBlack;","uniform float clipWhite;","uniform bool mask;","varying float screenSat;","varying vec3 screenPrimary;","void main(void) {","\tfloat pixelSat, secondaryComponents;","\tvec4 sourcePixel = texture2D(source, vTexCoord);","\tfloat fmin = min(min(sourcePixel.r, sourcePixel.g), sourcePixel.b);","\tfloat fmax = max(max(sourcePixel.r, sourcePixel.g), sourcePixel.b);","\tvec3 pixelPrimary = step(fmax, sourcePixel.rgb);","\tsecondaryComponents = dot(1.0 - pixelPrimary, sourcePixel.rgb);","\tpixelSat = fmax - mix(secondaryComponents - fmin, secondaryComponents / 2.0, balance);","\tfloat diffPrimary = dot(abs(pixelPrimary - screenPrimary), vec3(1.0));","\tfloat solid = step(1.0, step(pixelSat, 0.1) + step(fmax, 0.1) + diffPrimary);","\tfloat alpha = max(0.0, 1.0 - pixelSat / screenSat);","\talpha = smoothstep(clipBlack, clipWhite, alpha);","\tvec4 semiTransparentPixel = vec4((sourcePixel.rgb - (1.0 - alpha) * screen.rgb * screenWeight) / max(0.00001, alpha), alpha);","\tvec4 pixel = mix(semiTransparentPixel, sourcePixel, solid);","#ifdef MASK","\tgl_FragColor = vec4(vec3(pixel.a), 1.0);","#else","\tgl_FragColor = pixel;","#endif","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},screen:{type:"color",uniform:"screen",defaultValue:[66/255,195/255,31/255,1]},weight:{type:"number",uniform:"screenWeight",defaultValue:1,min:0},balance:{type:"number",uniform:"balance",defaultValue:1,min:0,max:1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:0,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},mask:{type:"boolean",defaultValue:!1,uniform:"mask",shaderDirty:!0}},title:"Chroma Key",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("color",function(){function t(){i.resize()}var i=this,o={width:1,height:1},r=!0;return this.resize=function(){var e=void 0,t=void 0,i=void 0,o=void 0;for(this.inputs&&this.inputs.width?(e=this.inputs.width,t=this.inputs.height||e):this.inputs&&this.inputs.height?e=t=this.inputs.height:(e=1,t=1),e=Math.floor(e),t=Math.floor(t),this.width===e&&this.height===t||(this.width=e,this.height=t,this.emit("resize"),this.setDirty()),i=0;i<this.targets.length;i++)o=this.targets[i],o.resize(),o.setTransformDirty&&o.setTransformDirty()},{initialize:function(i){this.frameBuffer=new e.util.FrameBuffer(this.gl,1,1),t(),r=!0},commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","void main(void) {","\tgl_Position = position;","}\n"].join("\n"),t.fragment=["precision mediump float;\n","uniform vec4 color;","void main(void) {","\tgl_FragColor = color;","}"].join("\n"),t},draw:function(e,t,i,n,s){r&&(s(e,t,i,n,null,o),r=!1)},inPlace:!0,inputs:{color:{type:"color",uniform:"color",defaultValue:[0,0,0,1],update:function(){r=!0}},width:{type:"number",min:0,step:1,update:t,defaultValue:640},height:{type:"number",min:0,step:1,update:t,defaultValue:360}}}},{title:"Color",description:"Generate color",categories:["generator"]})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("color-select",{shader:function(e,t,i){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","uniform float hueMin;","uniform float hueMax;","uniform float hueMinFalloff;","uniform float hueMaxFalloff;","uniform float saturationMin;","uniform float saturationMax;","uniform float saturationMinFalloff;","uniform float saturationMaxFalloff;","uniform float lightnessMin;","uniform float lightnessMax;","uniform float lightnessMinFalloff;","uniform float lightnessMaxFalloff;","varying vec2 vTexCoord;","varying vec4 adjustedHueRange;","varying vec4 saturationRange;","varying vec4 lightnessRange;","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tvTexCoord = texCoord;","\tfloat hueOffset = hueMin - hueMinFalloff;","\tadjustedHueRange = mod(vec4(hueOffset, hueMin - hueOffset, hueMax - hueOffset, hueMax + hueMaxFalloff - hueOffset), 360.0);","\tif (hueMin != hueMax) {","\t\tif (adjustedHueRange.z == 0.0) {","\t\t\tadjustedHueRange.z = 360.0;","\t\t\tadjustedHueRange.w += 360.0;","\t\t} else if (adjustedHueRange.w == 0.0) {","\t\t\tadjustedHueRange.w += 360.0;","\t\t}","\t}","\tsaturationRange = vec4(saturationMin - saturationMinFalloff, saturationMin, saturationMax, saturationMax + saturationMaxFalloff );","\tlightnessRange = vec4(lightnessMin - lightnessMinFalloff, lightnessMin, lightnessMax, lightnessMax + lightnessMaxFalloff );","}"].join("\n"),t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform bool mask;","varying vec4 adjustedHueRange;","varying vec4 saturationRange;","varying vec4 lightnessRange;","vec3 calcHSL(vec3 c) {","\tfloat minColor = min(c.r, min(c.g, c.b));","\tfloat maxColor = max(c.r, max(c.g, c.b));","\tfloat delta = maxColor - minColor;","\tvec3 hsl = vec3(0.0, 0.0, (maxColor + minColor) / 2.0);","\tif (delta > 0.0) {","\t\tif (hsl.z < 0.5) {","\t\t\thsl.y = delta / (maxColor + minColor);","\t\t} else {","\t\t\thsl.y = delta / (2.0 - maxColor - minColor);","\t\t}","\t\tif (c.r == maxColor) {","\t\t\thsl.x = (c.g - c.b) / delta;","\t\t} else if (c.g == maxColor) {","\t\t\thsl.x = 2.0 + (c.b - c.r) / delta;","\t\t} else {","\t\t\thsl.x = 4.0 + (c.r - c.g) / delta;","\t\t}","\t\thsl.x = hsl.x * 360.0 / 6.0;","\t\tif (hsl.x < 0.0) {","\t\t\thsl.x += 360.0;","\t\t} else {","\t\t\thsl.x = mod(hsl.x, 360.0);","\t\t}","\t}","\treturn hsl;","}","void main(void) {","\tvec4 color = texture2D(source, vTexCoord);","\tvec3 hsl = calcHSL(color.rgb);","\tfloat adjustedHue = mod(hsl.x - adjustedHueRange.x, 360.0);","\tfloat maskValue;","\tif (adjustedHue < adjustedHueRange.y) {","\t\tmaskValue = smoothstep(0.0, adjustedHueRange.y, adjustedHue);","\t} else if (adjustedHue < adjustedHueRange.z) {","\t\tmaskValue = 1.0;","\t} else {","\t\tmaskValue = 1.0 - smoothstep(adjustedHueRange.z, adjustedHueRange.w, adjustedHue);","\t}","\tif (maskValue > 0.0) {","\t\tif (hsl.y < saturationRange.y) {","\t\t\tmaskValue = min(maskValue, smoothstep(saturationRange.x, saturationRange.y, hsl.y));","\t\t} else {","\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(saturationRange.z, saturationRange.w, hsl.y));","\t\t}","\t}","\tif (maskValue > 0.0) {","\t\tif (hsl.z < lightnessRange.y) {","\t\t\tmaskValue = min(maskValue, smoothstep(lightnessRange.x, lightnessRange.z, hsl.y));","\t\t} else {","\t\t\tmaskValue = min(maskValue, 1.0 - smoothstep(lightnessRange.z, lightnessRange.w, hsl.z));","\t\t}","\t}","\tif (mask) {","\t\tgl_FragColor = vec4(maskValue, maskValue, maskValue, 1.0);","\t} else {","\t\tcolor.a = min(color.a, maskValue);","\t\tgl_FragColor = color;","\t}","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hueMin:{type:"number",uniform:"hueMin",defaultValue:0},hueMax:{type:"number",uniform:"hueMax",defaultValue:360},hueMinFalloff:{type:"number",uniform:"hueMinFalloff",defaultValue:0,min:0},hueMaxFalloff:{type:"number",uniform:"hueMaxFalloff",defaultValue:0,min:0},saturationMin:{type:"number",uniform:"saturationMin",defaultValue:0,min:0,max:1},saturationMax:{type:"number",uniform:"saturationMax",defaultValue:1,min:0,max:1},saturationMinFalloff:{type:"number",uniform:"saturationMinFalloff",defaultValue:0,min:0},saturationMaxFalloff:{type:"number",uniform:"saturationMaxFalloff",defaultValue:0,min:0},lightnessMin:{type:"number",uniform:"lightnessMin",defaultValue:0,min:0,max:1},lightnessMax:{type:"number",uniform:"lightnessMax",defaultValue:1,min:0,max:1},lightnessMinFalloff:{type:"number",uniform:"lightnessMinFalloff",defaultValue:0,min:0},lightnessMaxFalloff:{type:"number",uniform:"lightnessMaxFalloff",defaultValue:0,min:0},mask:{type:"boolean",defaultValue:!1,uniform:"mask"}},title:"Color Select",description:"Create a mask by hue, saturation and lightness range."})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("colorcomplements",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec4 guideColor;","uniform float correlation;","uniform float amount;","uniform float concentration;","float hueLerp(float h1, float h2, float v) {","\tfloat d = abs(h1 - h2);","\tif (d <= 0.5) {","\t\treturn mix(h1, h2, v);","\t} else if (h1 < h2) {","\t\treturn fract(mix((h1 + 1.0), h2, v));","\t} else {","\t\treturn fract(mix(h1, (h2 + 1.0), v));","\t}","}","vec3 rgbToHsv(vec3 c) {","\tvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);","\tvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);","\tfloat d = q.x - min(q.w, q.y);","\tfloat e = 1.0e-10;","\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsvToRgb(vec3 c) {","\tvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","\tvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 hsvComplement(vec3 hsv) {","\tvec3 compl = hsv;","\tcompl.x = mod(compl.x - 0.5, 1.0);","\treturn compl;","}","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tvec3 hsv = rgbToHsv(pixel.rgb);","\tvec3 hsvPole1 = rgbToHsv(guideColor.rgb);","\tvec3 hsvPole2 = hsvPole1;","\thsvPole2 = hsvComplement(hsvPole1);","\tfloat dist1 = abs(hsv.x - hsvPole1.x);","\tdist1 = dist1 > 0.5 ? 1.0 - dist1 : dist1;","\tfloat dist2 = abs(hsv.x - hsvPole2.x);","\tdist2 = dist2 > 0.5 ? 1.0 - dist2 : dist2;","\tfloat descent = smoothstep(0.0, correlation, hsv.y);","\tvec3 outputHsv = hsv;","\tvec3 pole = dist1 < dist2 ? hsvPole1 : hsvPole2;","\tfloat dist = min(dist1, dist2);","\tfloat c = descent * amount * (1.0 - pow((dist * 2.0), 1.0 / concentration));","\toutputHsv.x = hueLerp(hsv.x, pole.x, c);","\toutputHsv.y = mix(hsv.y, pole.y, c);","\tgl_FragColor = vec4(hsvToRgb(outputHsv), pixel.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:.8},concentration:{type:"number",uniform:"concentration",min:.1,max:4,defaultValue:2},correlation:{type:"number",uniform:"correlation",min:0,max:1,defaultValue:.5},guideColor:{type:"color",uniform:"guideColor",defaultValue:[1,.5,0,1]}},title:"Color Complements",categories:["color"],description:"http://theabyssgazes.blogspot.com/2010/03/teal-and-orange-hollywood-please-stop.html"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("colorcube",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","uniform sampler2D source;","uniform sampler2D colorCube;","varying vec2 vTexCoord;","vec3 sampleAs3DTexture(sampler2D tex, vec3 coord, float size) {","\tfloat sliceSize = 1.0 / size;","\tfloat slicePixelSize = sliceSize / size;","\tfloat sliceInnerSize = slicePixelSize * (size - 1.0);","\tfloat zSlice0 = min(floor(coord.z * size), size - 1.0);","\tfloat zSlice1 = min(zSlice0 + 1.0, size - 1.0);","\tfloat xOffset = slicePixelSize * 0.5 + coord.x * sliceInnerSize;","\tfloat s0 = xOffset + (zSlice0 * sliceSize);","\tfloat s1 = xOffset + (zSlice1 * sliceSize);","\tvec3 slice0Color = texture2D(tex, vec2(s0, 1.0 - coord.y)).rgb;","\tvec3 slice1Color = texture2D(tex, vec2(s1, 1.0 - coord.y)).rgb;","\tfloat zOffset = mod(coord.z * size, 1.0);","\treturn mix(slice0Color, slice1Color, zOffset);","}","void main(void) {","\tvec4 originalColor = texture2D(source, vTexCoord);","\tvec3 color = sampleAs3DTexture(colorCube, originalColor.rgb, 8.0);","\tgl_FragColor = vec4(color, originalColor.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},cube:{type:"image",uniform:"colorCube"}},title:"Color Cube",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("crop",function(){function e(){var e=1,i=1,o=void t.inputs.source,r=void 0;for(t.source?(e=t.source.width,i=t.source.height):t.sources&&t.sources.source&&(e=t.sources.source.width,i=t.sources.source.height),e=e-t.inputs.left-t.inputs.right,i=i-t.inputs.top-t.inputs.bottom,e=Math.max(1,Math.floor(e)),i=Math.max(1,Math.floor(i)),t.width===e&&t.height===i||(t.width=e,t.height=i,t.uniforms.resolution[0]=e,t.uniforms.resolution[1]=i,t.frameBuffer&&t.frameBuffer.resize(t.width,t.height),t.emit("resize"),t.setDirty()),r=0;r<t.targets.length;r++)o=t.targets[r],o.resize(),o.setTransformDirty&&o.setTransformDirty()}var t=this;return t.resize=e,{commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","uniform float top;","uniform float left;","uniform float bottom;","uniform float right;","varying vec2 vTexCoord;","const vec2 ZERO = vec2(0.0);","const vec2 ONE = vec2(1.0);","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tvec2 dim = resolution + vec2(right + left, bottom + top);","\tvec2 scale = dim / resolution;","\tvec2 offset = vec2(left, bottom) / resolution;","\tvTexCoord = max(ZERO, (texCoord + offset) / scale);","}\n"].join("\n"),t},inputs:{source:{type:"image",uniform:"source",update:e},top:{type:"number",uniform:"top",min:0,step:1,update:e,defaultValue:0},left:{type:"number",uniform:"left",min:0,step:1,update:e,defaultValue:0},bottom:{type:"number",uniform:"bottom",min:0,step:1,update:e,defaultValue:0},right:{type:"number",uniform:"right",min:0,step:1,update:e,defaultValue:0}}}},{inPlace:!0,title:"Crop"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("daltonize",{commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec3 position;","attribute vec2 texCoord;","uniform mat4 transform;","varying vec2 vTexCoord;","void main(void) {","\tgl_Position = transform * vec4(position, 1.0);","\tvTexCoord = vec2(texCoord.s, texCoord.t);","}"].join("\n"),t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float cbtype;","void main(void) {","\tvec4 color = texture2D(source, vTexCoord);","\tif (cbtype == 0.0) {","\t\tgl_FragColor = color;","\t\treturn;","\t}","\tconst mat3 RGBLMS = mat3( \t\t17.8824, 43.5161, 4.11935,\t\t3.45565, 27.1554, 3.86714,\t\t0.0299566, 0.184309, 1.46709\t);","\tvec3 LMS = color.rgb * RGBLMS;","\tvec3 lms = vec3(0.0,0.0,0.0);","\tif (cbtype < 0.33) {","\t\tlms = vec3(\t\t\t\t(2.02344 * LMS.g) + (-2.52581 * LMS.b),\t\t\tLMS.g,\t\t\tLMS.b\t\t);","\t}","\tif (cbtype > 0.33 && cbtype < 0.66) {","\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\t(0.494207 * LMS.r) + (1.24827 * LMS.b),\t\t\tLMS.b\t\t);","\t}","\tif (cbtype > 0.66) {","\t\tlms = vec3(\t\t\t\tLMS.r,\t\t\tLMS.g,\t\t\t(-0.395913 * LMS.r) + (0.801109 * LMS.g)\t\t);","\t}","\tconst mat3 LMSRGB = mat3(    \t\t0.0809444479, -0.130504409, 0.116721066,\t\t-0.0102485335, 0.0540193266, -0.113614708,\t\t-0.000365296938, -0.00412161469, 0.693511405\t);","\tvec3 RGB = lms * LMSRGB;","\tRGB.rgb = color.rgb - RGB.rgb;","\tRGB.g = 0.7*RGB.r + RGB.g;","\tRGB.b = 0.7*RGB.r + RGB.b;","\tcolor.rgb = color.rgb + RGB.rgb;","\tgl_FragColor = color;","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},type:{title:"Type",type:"enum",uniform:"cbtype",defaultValue:"0.2",options:[["0.0","Off"],["0.2","Protanope"],["0.6","Deuteranope"],["0.8","Tritanope"]]}},title:"Daltonize",description:"Add contrast to colours to assist CVD (colour-blind) users."})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";var t=[.2,.3,.5,.8],i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);e.plugin("directionblur",function(o){var r=void 0,n=void 0,s={amount:0,blendGamma:2,angle:0,inputScale:1,resolution:[this.width,this.height],transform:i,projection:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};return{initialize:function(t){var i=void 0;t(),(i=this.gl)&&(r=[new e.util.FrameBuffer(i,this.width,this.height),new e.util.FrameBuffer(i,this.width,this.height)])},commonShader:!0,shader:function(e,t){return this.gl,n=this.baseShader,t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 projection;","uniform mat4 transform;","uniform float angle;","uniform float amount;","uniform float inputScale;","const vec2 zero = vec2(0.0);","varying vec2 vTexCoord;","varying vec4 vTexCoords[4];","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position = screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tvTexCoord = texCoord;","\tvec2 one = vec2(1.0) * inputScale;","\tif (inputScale < 1.0) {","\t\tone -= 1.0 / resolution;","\t}","\tvTexCoord = max(zero, min(one, texCoord.st * inputScale));","\tvec2 amount = vec2(cos(angle), sin(angle)) * amount * 5.0 / resolution;","\tfor (int i = 0; i < 4; i++) {","\t\tfloat s = pow(3.0, float(i));","\t\tvTexCoords[i].xy = max(zero, min(one, vTexCoord + amount * s));","\t\tvTexCoords[i].zw = max(zero, min(one, vTexCoord - amount * s));","\t}","}"].join("\n"),t.fragment=["precision mediump float;\n","uniform sampler2D source;","uniform float angle;","uniform float amount;","uniform float blendGamma;","varying vec2 vTexCoord;","varying vec4 vTexCoords[4];","vec3 exp;","vec4 sample(sampler2D sampler, vec2 coord) {","\tvec4 pixel = texture2D(sampler, coord);","\tpixel.rgb = pow(pixel.rgb, exp);","\treturn pixel;","}","void main(void) {","\texp = vec3(blendGamma);","\tgl_FragColor = sample(source, vTexCoord) / 9.0;","\tfor (int i = 0; i < 4; i++) {","\t\tgl_FragColor += sample(source, vTexCoords[i].xy) / 9.0;","\t\tgl_FragColor += sample(source, vTexCoords[i].zw) / 9.0;","\t}","\tgl_FragColor.rgb = pow(gl_FragColor.rgb, 1.0 / exp);","}"].join("\n"),t},draw:function(e,i,o,a,u){var l=void 0,c=void 0,f=void 0,d=void 0,h=void 0,m=void 0,p={width:0,height:0,blend:!1},v=1;if(!(d=this.inputs.amount))return void u(n,i,o,a);if(d<=.01)return void u(e,i,o,a);for(s.amount=d,s.angle=this.inputs.angle,s.projection[0]=this.height/this.width,l=0;l<t.length;l++)f=Math.min(1,t[l]/d),h=Math.floor(f*this.width),m=Math.floor(f*this.height),s.source=c?c.texture:this.inputs.source.texture,c=r[l%2],s.inputScale=v,v=f,p.width=h,p.height=m,u(e,i,s,c.frameBuffer,null,p);s.source=c.texture,s.inputScale=v,u(e,i,s,a)},resize:function(){s.resolution[0]=this.width,s.resolution[1]=this.height,r&&(r[0].resize(this.width,this.height),r[1].resize(this.width,this.height))},destroy:function(){r&&(r[0].destroy(),r[1].destroy(),r=null),n&&n.destroy(),s=null}}},{inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},amount:{type:"number",uniform:"amount",defaultValue:.4,min:0,max:1},angle:{type:"number",uniform:"angle",defaultValue:0},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4}},title:"Directional Motion Blur"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("dither",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","#define mod4(a) (a >= 4 ? a - 4 : a)","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","const mat4 dither = mat4(1.0, 33.0, 9.0, 41.0,49.0, 17.0, 57.0, 25.0,13.0, 45.0, 5.0, 37.0,61.0, 29.0, 53.0, 21.0);","float find_closest(int x, int y, float c0) {","\tfloat limit = 0.0;","\tint x4 = mod4(x);","\tint y4 = mod4(y);","\tfor (int i = 0; i < 4; i++) {","\t\tif (i == x4) {","\t\t\tfor (int j = 0; j < 4; j++) {","\t\t\t\tif (j == y4) {","\t\t\t\t\tlimit = dither[i][j];","\t\t\t\t\tbreak;","\t\t\t\t}","\t\t\t}","\t\t}","\t}","\tif (x < 4) {","\t\tif (y >= 4) {","\t\t\tlimit += 3.0;","\t\t}","\t} else {","\t\tif (y >= 4) {","\t\t\tlimit += 1.0;","\t\t} else {","\t\t\tlimit += 2.0;","\t\t}","\t}","\tlimit /= 65.0;","\treturn c0 < limit ? 0.0 : 1.0;","}","void main (void)  {","\tvec4 pixel = texture2D(source, vTexCoord);","\tvec2 coord = vTexCoord * resolution;","\tint x = int(mod(coord.x, 8.0));","\tint y = int(mod(coord.y, 8.0));","\tpixel.r = find_closest(x, y, pixel.r);","\tpixel.g = find_closest(x, y, pixel.g);","\tpixel.b = find_closest(x, y, pixel.b);","\tgl_FragColor = pixel;","}"].join("\n"),t},inPlace:!1,inputs:{source:{type:"image",uniform:"source"}},title:"Dither"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";function t(e,t){var i=void 0;for(i=0;i<t.length;i++)t[i]*=e;return t}var i=Math.sqrt,o=void 0,r=void 0,n=[],s=void 0,a=void 0,u=void 0;for(s=[t(1/(2*i(2)),[1,i(2),1,0,0,0,-1,-i(2),-1]),t(1/(2*i(2)),[1,0,-1,i(2),0,-i(2),1,0,-1]),t(1/(2*i(2)),[0,-1,i(2),1,0,-1,-i(2),1,0]),t(1/(2*i(2)),[i(2),-1,0,-1,0,1,0,1,-i(2)]),t(.5,[0,1,0,-1,0,-1,0,1,0]),t(.5,[-1,0,1,0,0,0,1,0,-1]),t(1/6,[1,-2,1,-2,4,-2,1,-2,1]),t(1/6,[-2,1,-2,1,4,1,-2,1,-2]),t(1/3,[1,1,1,1,1,1,1,1,1])],o=0;o<s.length;o++)for(r=0;r<s[o].length;r++)n.push(s[o][r]);a=new Float32Array(n),u=new Float32Array([1,2,1,0,0,0,-1,-2,-1,1,0,-1,2,0,-2,1,0,-1]),e.plugin("edge",{initialize:function(e){e(),this.uniforms.pixelWidth=1/this.width,this.uniforms.pixelHeight=1/this.height,"sobel"===this.inputs.mode?this.uniforms.G=u:this.uniforms.G=a},shader:function(e,t){var i=void 0;return i="sobel"===e.mode?"#define N_MATRICES 2\n#define SOBEL\n":"#define N_MATRICES 9\n",t.fragment=[i,"precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float pixelWidth;","uniform float pixelHeight;","uniform mat3 G[9];","void main(void) {","\tmat3 I;","\tfloat dp3, cnv[9];","\tvec3 tc;","\tfloat fi = 0.0, fj = 0.0;","\tfor (int i = 0; i < 3; i++) {","\t\tfj = 0.0;","\t\tfor (int j = 0; j < 3; j++) {","\t\t\tI[i][j] = length( texture2D(source, vTexCoord + vec2((fi - 1.0) * pixelWidth, (fj - 1.0) * pixelHeight)).rgb );","\t\t\tfj += 1.0;","\t\t};","\t\tfi += 1.0;","\t};","\tfor (int i = 0; i < N_MATRICES; i++) {","\t\tdp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);","\t\tcnv[i] = dp3 * dp3;","\t};","#ifdef SOBEL","\ttc = vec3(0.5 * sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));","#else","\tfloat M = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]);","\tfloat S = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]) + (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + cnv[8];","\ttc = vec3(sqrt(M/S));","#endif","\tgl_FragColor = vec4(tc, 1.0);","}"].join("\n"),t},resize:function(){this.uniforms.pixelWidth=1/this.width,this.uniforms.pixelHeight=1/this.height},inputs:{source:{type:"image",uniform:"source"},mode:{type:"enum",shaderDirty:!0,defaultValue:"sobel",options:[["sobel","Sobel"],["frei-chen","Frei-Chen"]],update:function(){"sobel"===this.inputs.mode?this.uniforms.G=u:this.uniforms.G=a}}},description:"Edge Detect",title:"Edge Detect"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("emboss",{commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","varying vec2 vTexCoord1;","varying vec2 vTexCoord2;","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tvec2 offset = 1.0 / resolution;","\tvTexCoord1 = texCoord - offset;","\tvTexCoord2 = texCoord + offset;","}"].join("\n"),t.fragment=["precision mediump float;","varying vec2 vTexCoord1;","varying vec2 vTexCoord2;","uniform sampler2D source;","uniform float amount;","const vec3 average = vec3(1.0 / 3.0);","void main (void)  {","\tvec4 pixel = vec4(0.5, 0.5, 0.5, 1.0);","\tpixel -= texture2D(source, vTexCoord1) * amount;","\tpixel += texture2D(source, vTexCoord2) * amount;","\tpixel.rgb = vec3(dot(pixel.rgb, average));","\tgl_FragColor = pixel;","}"].join("\n"),t},inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:1,min:-85,max:85}},title:"Emboss",categories:[],description:"Emboss"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("exposure",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float exposure;","void main (void)  {","\tvec4 pixel = texture2D(source, vTexCoord);","\tgl_FragColor = vec4(pow(2.0, exposure) * pixel.rgb, pixel.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},exposure:{type:"number",uniform:"exposure",defaultValue:1,min:-8,max:8}},title:"Exposure",categories:["film"],description:"Exposure control"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(i){"use strict";function o(e){return e-Math.floor(e)==0?e+".0":e}var r={red:"rgba.r",blue:"rgba.b",green:"rgba.g",alpha:"rgba.a",x:"dim.x",y:"dim.y",width:"resolution.x",height:"resolution.y",a:"a",b:"b",c:"c",d:"d",luma:["luma","rgba"]},n={dim:"vec2 dim = vTexCoord * resolution;",rgba:"vec4 rgba = texture2D(source, vTexCoord);",luma:"float luma = dot(rgba.rgb, vec3(0.2125,0.7154,0.0721));",atan2:{source:"#define atan2(x, y) atan(x / y)",global:!0},and:{source:["float and(float a, float b) {","\tif (a == 0.0) {","\t\treturn 0.0;","\t}","\treturn b;","}"].join("\n"),global:!0},or:{source:["float or(float a, float b) {","\tif (a != 0.0) {","\t\treturn a;","\t}","\treturn b;","}"].join("\n"),global:!0},luminance:{source:["const vec3 lumaCoeffs = vec3(0.2125,0.7154,0.0721);","float luminance(float r, float g, float b) {","\treturn dot(vec3(r, g, b), lumaCoeffs);","}"].join("\n"),global:!0},saturation:{source:["float saturation(float r, float g, float b) {","\tfloat lo = min(r, min(g, b));","\tfloat hi = max(r, max(g, b));","\tfloat l = (lo + hi) / 2.0;","\tfloat d = hi - lo;","\treturn l > 0.5 ? d / (2.0 - hi - lo) : d / (hi + lo);","}"].join("\n"),global:!0},lightness:{source:["float lightness(float r, float g, float b) {","\tfloat lo = min(r, min(g, b));","\tfloat hi = max(r, max(g, b));","\treturn (lo + hi) / 2.0;","}"].join("\n"),global:!0},hue:{source:["float hue(float r, float g, float b) {","\tfloat h;","\tif (r > g && r > b) {","\t\th = (g - b) / d + (g < b ? 6.0 : 0.0);","\t} else if (g > r && g > b) {","\t\th = (b - r) / d + 2.0;","\t} else {","\t\th = (r - g) / d + 4.0;","\t}","\treturn h / 6.0;","}"].join("\n"),global:!0}},s={radians:1,degrees:1,sin:1,cos:1,tan:1,asin:1,acos:1,atan:1,pow:2,exp:1,log:1,exp2:1,log2:1,sqrt:1,inversesqrt:1,abs:1,sign:1,floor:1,ceil:1,fract:1,mod:2,min:2,max:2,clamp:3,mix:3,step:2,smoothstep:3,and:2,or:2,atan2:2,hue:3,saturation:3,lightness:3,luminance:3},a={"-":!0,"!":!0,"+":!0},u={"+":!1,"-":!1,"*":!1,"/":!1,"%":"mod","&&":"and","||":"or","===":"==","==":!0,"!==":"!=","!=":!0,">=":!0,"<=":!0,"<":!0,">":!0},l=void 0,c=void 0,f=void 0,d=void 0;["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"].forEach(function(e){r[e]=e,n[e]={source:"const float "+e+" = "+Math[e]+";",global:!0}});for(c in r)r.hasOwnProperty(c)&&(f=r[c],"string"==typeof f&&(f=[f]),l=f[0].split("."),l.length>1&&f.push(l[0]),r[c]=f);for(c in n)n.hasOwnProperty(c)&&"string"==typeof(f=n[c])&&(n[c]={source:f,global:!1});i.plugin("expression",function(){function e(){var e=t.inputs;e.blue===e.red&&e.green===e.blue?e.rgb=e.red:e.rgb=""}var t=this;return{shader:function(e,t){function i(e){var t=void 0,l=void 0,c=void 0,f=void 0;if("MemberExpression"===e.type)throw new Error('Expression Error: Unknown object "'+(e.object.name||"this")+'"');if("BinaryExpression"===e.type||"LogicalExpression"===e.type){if(!e.right)throw new Error("Expression Error: Bad binary expression");if(!e.left)return e.type="UnaryExpression",e.argument=e.right,i(e);if(t=e.operator,void 0===(l=u[t]))throw new Error('Expression Error: Unknown operator "'+t+'"');if("string"==typeof l)if(l in u)t=u[l],l=u[t];else if(2===s[l])return h[l]=!0,l+"("+i(e.left)+", "+i(e.right)+")";return(l?"float":"")+"("+i(e.left)+" "+t+" "+i(e.right)+")"}if("CallExpression"===e.type){if("Identifier"!==e.callee.type)throw new Error("Expression Error: Unknown function");if(t=e.callee.name,void 0===(l=s[t]))throw new Error('Expression Error: Unknown function "'+t+'"');if(l>e.arguments.length)throw new Error('Expression Error: Function "'+t+'" requires at least '+l+" arguments");for(f=[],c=0;c<l;c++)f.push(i(e.arguments[c]));return h[t]=!0,t+"("+f.join(", ")+")"}if("Identifier"===e.type){if(!(f=r[e.name]))throw new Error('Expression Error: Unknown identifier "'+e.name+'"');for(c=f.length-1;c>=0;c--)l=f[c],n[l]&&(h[l]=!0);return f[0]}if("Literal"===e.type){if("true"===e.raw)return 1;if("true"===e.raw)return 0;if("number"!=typeof e.value||isNaN(e.value))throw new Error("Expression Error: Invalid literal "+e.raw);return o(e.value)}if("UnaryExpression"===e.type){if(t=e.operator,!(l=a[t]))throw new Error('Expression Error: Unknown operator "'+t+'"');return t+"("+i(e.argument)+")"}}var l={},c={red:"",green:"",blue:"",alpha:""},f={},h=void 0,m=void 0,p=void 0,v=void 0,g=[],x=[],y=[],b=void 0;for(p in c)c.hasOwnProperty(p)&&(m=e[p]||p,c[p]=m,l[m]="");for(m in l)if(l.hasOwnProperty(m))try{h={},b=d(m),l[m]=i(b);for(p in h)h.hasOwnProperty(p)&&(f[p]=h[p]);h.luma&&(f.rgba=!0)}catch(e){console.log(e.message),l[m]="0.0"}for(p in f)f.hasOwnProperty(p)&&(h=n[p])&&(h.global?g.push(h.source):x.push("\t"+h.source));for(p in c)c.hasOwnProperty(p)&&(m=c[p],y.push(l[m]));return v=["precision mediump float;","varying vec2 vTexCoord;","varying vec4 vPosition;","uniform sampler2D source;","uniform float a, b, c, d;","uniform vec2 resolution;",g.join("\n"),"void main(void) {",x.join("\n"),"\tgl_FragColor = vec4(","\t\t"+y.join(",\n\t\t"),"\t);","}"],t.fragment=v.join("\n"),t},inputs:{source:{type:"image",uniform:"source",shaderDirty:!0},a:{type:"number",uniform:"a",defaultValue:0},b:{type:"number",uniform:"b",defaultValue:0},c:{type:"number",uniform:"c",defaultValue:0},d:{type:"number",uniform:"d",defaultValue:0},rgb:{type:"string",update:function(e){var i=t.inputs;i.red=i.green=i.blue=e},shaderDirty:!0},red:{type:"string",update:e,shaderDirty:!0},green:{type:"string",update:e,shaderDirty:!0},blue:{type:"string",update:e,shaderDirty:!0},alpha:{type:"string",shaderDirty:!0}}}},{inPlace:!1,title:"Expression"}),function(i){var o="Compound",r="MemberExpression",n="Literal",s={"-":!0,"!":!0,"~":!0,"+":!0},a={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},u=function(e){var t=void 0,i=0;for(var o in e)(t=o.length)>i&&e.hasOwnProperty(o)&&(i=t);return i},l=u(s),c=u(a),f={true:!0,false:!1,null:null},d=function(e){return a[e]||0},h=function(e,t,i){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:i}},m=function(e){return e>=48&&57>=e},p=function(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e},v=function(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e},g=function(e){for(var t,i,u=0,g=e.charAt,x=e.charCodeAt,y=function(t){return g.call(e,t)},b=function(t){return x.call(e,t)},w=e.length,T=function(){for(var e=b(u);32===e||9===e;)e=b(++u)},E=function(){T();for(var t=e.substr(u,c),i=t.length;i>0;){if(a.hasOwnProperty(t))return u+=i,t;t=t.substr(0,--i)}return!1},C=function(){var e=void 0,t=void 0,i=void 0,o=void 0,r=void 0,n=void 0,s=void 0,a=void 0;if(n=R(),!(t=E()))return n;if(r={value:t,prec:d(t)},!(s=R()))throw new Error("Expected expression after "+t+" at character "+u);for(o=[n,r,s];(t=E())&&0!==(i=d(t));){for(r={value:t,prec:i};o.length>2&&i<=o[o.length-2].prec;)s=o.pop(),t=o.pop().value,n=o.pop(),e=h(t,n,s),o.push(e);if(!(e=R()))throw new Error("Expected expression after "+t+" at character "+u);o.push(r),o.push(e)}for(a=o.length-1,e=o[a];a>1;)e=h(o[a-1].value,o[a-2],e),a-=2;return e},R=function t(){var i=void 0,o=void 0,r=void 0;if(T(),i=b(u),m(i)||46===i)return P();if(39===i||34===i)return D();if(p(i))return _();if(40===i)return z();for(o=e.substr(u,l),r=o.length;r>0;){if(s.hasOwnProperty(o))return u+=r,{type:"UnaryExpression",operator:o,argument:t(),prefix:!0};o=o.substr(0,--r)}return!1},P=function(){for(var e="";m(b(u));)e+=y(u++);if("."===y(u))for(e+=y(u++);m(b(u));)e+=y(u++);if("e"===y(u)||"E"===y(u)){for(e+=y(u++),("+"===y(u)||"-"===y(u))&&(e+=y(u++));m(b(u));)e+=y(u++);if(!m(b(u-1)))throw new Error("Expected exponent ("+e+y(u)+") at character "+u)}if(p(b(u)))throw new Error("Variable names cannot start with a number ("+e+y(u)+") at character "+u);return{type:n,value:parseFloat(e),raw:e}},D=function(){for(var e,t="",i=y(u++),o=!1;w>u;){if((e=y(u++))===i){o=!0;break}if("\\"===e)switch(e=y(u++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v"}else t+=e}if(!o)throw new Error('Unclosed quote after "'+t+'"');return{type:n,value:t,raw:i+t+i}},S=function(){var t=void 0,i=b(u),o=u;if(!p(i))throw new Error("Unexpected "+y(u)+"at character "+u);for(u++;w>u&&(i=b(u),v(i));)u++;return t=e.slice(o,u),f.hasOwnProperty(t)?{type:n,value:f[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},B=function(){for(var e,t,i=[];w>u;){if(T(),")"===(e=y(u))){u++;break}if(","===e)u++;else{if(!(t=C())||t.type===o)throw new Error("Expected comma at character "+u);i.push(t)}}return i},_=function(){var e=void 0,t=void 0;for(t=S(),T(),e=y(u);"."===e||"["===e||"("===e;){if("."===e)u++,T(),t={type:r,computed:!1,object:t,property:S()};else if("["===e){if(u++,t={type:r,computed:!0,object:t,property:C()},T(),"]"!==(e=y(u)))throw new Error("Unclosed [ at character "+u);u++,T()}else"("===e&&(u++,t={type:"CallExpression",arguments:B(),callee:t});T(),e=y(u)}return t},z=function(){u++;var e=C();if(T(),")"===y(u))return u++,e;throw new Error("Unclosed ( at character "+u)},F=[];w>u;)if(";"===(t=y(u))||","===t)u++;else if(i=C())F.push(i);else if(w>u)throw new Error("Unexpected '"+y(u)+"' at character "+u);return 1===F.length?F[0]:{type:o,body:F}};if(g.version="0.2.9",g.toString=function(){return"JavaScript Expression Parser (JSEP) v"+g.version},g.addUnaryOp=function(e){return s[e]=!0,this},g.addBinaryOp=function(e,t){return c=Math.max(e.length,c),a[e]=t,this},g.removeUnaryOp=function(e){return delete s[e],e.length===l&&(l=u(s)),this},g.removeBinaryOp=function(e){return delete a[e],e.length===c&&(c=u(a)),this},void 0===t){var x=i.jsep;i.jsep=g,g.noConflict=function(){return i.jsep===g&&(i.jsep=x),g}}else void 0!==e&&e.exports?t=e.exports=g:t.parse=g}(window),d=window.jsep.noConflict()})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("fader",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec4 color;","uniform float amount;","void main(void) {","\tgl_FragColor = texture2D(source, vTexCoord);","\tgl_FragColor = mix(gl_FragColor, color, amount);","}"].join("\n"),t},requires:function(e,t){return t.amount<1},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},color:{type:"color",uniform:"color",defaultValue:[0,0,0,1]},amount:{type:"number",uniform:"amount",defaultValue:.5,min:0,max:1}},title:"Fader",description:"Fade image to a color"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("falsecolor",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float amount;","uniform vec4 black;","uniform vec4 white;","const vec3 luma = vec3(0.2125, 0.7154, 0.0721);","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat luminance = dot(pixel.rgb, luma);","\tvec4 result = mix(black, white, luminance);","\tgl_FragColor = vec4(result.rgb, pixel.a * result.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},black:{type:"color",uniform:"black",defaultValue:[0,0,.5,1]},white:{type:"color",uniform:"white",defaultValue:[1,0,0,1]}},title:"False Color"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("filmgrain",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","uniform float time;","uniform float amount;","uniform bool colored;","float timer;","const float permTexUnit = 1.0/256.0;","const float permTexUnitHalf = 0.5/256.0;","vec4 rnm(in vec2 tc) {","\tfloat noise = sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;","\tfloat noiseR = fract(noise)*2.0-1.0;","\tfloat noiseG = fract(noise*1.2154)*2.0-1.0; ","\tfloat noiseB = fract(noise*1.3453)*2.0-1.0;","\tfloat noiseA = fract(noise*1.3647)*2.0-1.0;","\t","\treturn vec4(noiseR,noiseG,noiseB,noiseA);","}","float fade(in float t) {","\treturn t*t*t*(t*(t*6.0-15.0)+10.0);","}","float pnoise3D(in vec3 p) {","\tvec3 pi = permTexUnit*floor(p)+permTexUnitHalf;","\tvec3 pf = fract(p);","\tfloat perm00 = rnm(pi.xy).a ;","\tvec3 grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;","\tfloat n000 = dot(grad000, pf);","\tvec3 grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));","\tfloat perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;","\tvec3 grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;","\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));","\tvec3 grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));","\tfloat perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;","\tvec3 grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;","\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));","\tvec3 grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));","\tfloat perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;","\tvec3 grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;","\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));","\tvec3 grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));","\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));","\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));","\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));","\treturn n_xyz;","}","void main(void) {","\ttimer = mod(time, 10000.0) / 10000.0;","\tvec4 pixel = texture2D(source, vTexCoord);","\tvec3 noise = vec3(pnoise3D(vec3(vTexCoord * resolution, timer + 0.0)));","\tif (colored) {","\t\tnoise.g = pnoise3D(vec3(vTexCoord * resolution, timer + 1.0));","\t\tnoise.b = pnoise3D(vec3(vTexCoord * resolution, timer + 2.0));","\t}","\tgl_FragColor = vec4(pixel.rgb + noise * amount, pixel.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",uniform:"time",mod:65536},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:.03},colored:{type:"boolean",uniform:"colored",defaultValue:!1}},title:"Film Grain",description:"Don't over-do it."})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("freeze",{draw:function(e,t,i,o,r){this.inputs.frozen||r(e,t,i,o)},requires:function(){return!this.inputs.frozen},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},frozen:{type:"boolean",defaultValue:!1,updateSources:!0}},title:"Freeze",description:"Freeze Frame"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("fxaa",{commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","varying vec2 vTexCoord;","varying vec2 vTexCoordNW;","varying vec2 vTexCoordNE;","varying vec2 vTexCoordSW;","varying vec2 vTexCoordSE;","const vec2 diag = vec2(1.0, -1.0);","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tvTexCoord = texCoord;","\tvec2 invRes = 1.0 / resolution;","\tvTexCoordNW = texCoord - invRes;","\tvTexCoordNE = texCoord + invRes * diag;","\tvTexCoordSW = texCoord - invRes * diag;","\tvTexCoordSE = texCoord + invRes;","}\n"].join("\n"),t.fragment=["precision mediump float;","#define FXAA_REDUCE_MIN (1.0 / 128.0)","#define FXAA_REDUCE_MUL (1.0 / 8.0)","#define FXAA_SPAN_MAX 8.0","varying vec2 vTexCoord;","varying vec2 vTexCoordNW;","varying vec2 vTexCoordNE;","varying vec2 vTexCoordSW;","varying vec2 vTexCoordSE;","uniform vec2 resolution;","uniform sampler2D source;","const vec3 luma = vec3(0.299, 0.587, 0.114);","void main(void) {","\tvec4 original = texture2D(source, vTexCoord);","\tvec3 rgbNW = texture2D(source, vTexCoordNW).rgb;","\tvec3 rgbNE = texture2D(source, vTexCoordNE).rgb;","\tvec3 rgbSW = texture2D(source, vTexCoordSW).rgb;","\tvec3 rgbSE = texture2D(source, vTexCoordSE).rgb;","\tfloat lumaNW = dot(rgbNW, luma);","\tfloat lumaNE = dot(rgbNE, luma);","\tfloat lumaSW = dot(rgbSW, luma);","\tfloat lumaSE = dot(rgbSE, luma);","\tfloat lumaM = dot(original.rgb, luma);","\tfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));","\tfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));","\tvec2 dir = vec2(-((lumaNW + lumaNE) - (lumaSW + lumaSE)), ((lumaNW + lumaSW) - (lumaNE + lumaSE)));","\tfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * 0.25 * FXAA_REDUCE_MUL, FXAA_REDUCE_MIN);","\tfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);","\tdir = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX), dir * rcpDirMin)) / resolution;","\tvec3 rgbA = 0.5 * (","\t\ttexture2D(source, vTexCoord + dir * (1.0 / 3.0 - 0.5)).rgb +","\t\ttexture2D(source, vTexCoord + dir * (2.0 / 3.0 - 0.5)).rgb);","\tvec3 rgbB = rgbA * 0.5 + 0.25 * (","\t\ttexture2D(source, vTexCoord - dir * 0.5).rgb +","\t\ttexture2D(source, vTexCoord + dir * 0.5).rgb);","\tfloat lumaB = dot(rgbB, luma);","\tif (lumaB < lumaMin || lumaB > lumaMax) {","\t\tgl_FragColor = vec4(rgbA, original.a);","\t} else {","\t\tgl_FragColor = vec4(rgbB, original.a);","\t}","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"FXAA",description:"Fast approximate anti-aliasing"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("hex",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;\n","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","uniform vec2 center;","uniform float size;","void main(void) {","\tvec2 aspect = normalize(resolution);","\tvec2 tex = (vTexCoord * aspect - center) / size;","\ttex.y /= 0.866025404;","\ttex.x -= tex.y * 0.5;","\tvec2 a;","\tif (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {","\t\ta = vec2(floor(tex.x), floor(tex.y));","\t} else {","\t\ta = vec2(ceil(tex.x), ceil(tex.y));","\t}","\tvec2 b = vec2(ceil(tex.x), floor(tex.y));","\tvec2 c = vec2(floor(tex.x), ceil(tex.y));","\tvec3 tex3 = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);","\tvec3 a3 = vec3(a.x, a.y, 1.0 - a.x - a.y);","\tvec3 b3 = vec3(b.x, b.y, 1.0 - b.x - b.y);","\tvec3 c3 = vec3(c.x, c.y, 1.0 - c.x - c.y);","\tfloat alen =length(tex3 - a3);","\tfloat blen =length(tex3 - b3);","\tfloat clen =length(tex3 - c3);","\tvec2 choice;","\tif (alen < blen) {","\t\tif (alen < clen) {","\t\t\tchoice = a;","\t\t} else {","\t\t\tchoice = c;","\t\t}","\t} else {","\t\tif (blen < clen) {","\t\t\tchoice = b;","\t\t} else {","\t\t\tchoice = c;","\t\t}","\t}","\tchoice.x += choice.y * 0.5;","\tchoice.y *= 0.866025404;","\tchoice *= size / aspect;","\tgl_FragColor = texture2D(source, choice + center / aspect);","}"].join("\n"),t},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},size:{type:"number",uniform:"size",min:0,max:.4,defaultValue:.01},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[0,0]}},title:"Hex",description:"Hexagonal Pixelate"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("highlights-shadows",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float shadows;","uniform float highlights;","const vec3 luma = vec3(0.2125, 0.7154, 0.0721);","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat luminance = dot(pixel.rgb, luma);","\tfloat shadow = clamp((pow(luminance, 1.0 / (shadows + 1.0)) + (-0.76) * pow(luminance, 2.0 / (shadows + 1.0))) - luminance, 0.0, 1.0);","\tfloat highlight = clamp((1.0 - (pow(1.0 - luminance, 1.0 / (2.0 - highlights)) + (-0.8) * pow(1.0 - luminance, 2.0 / (2.0 - highlights)))) - luminance, -1.0, 0.0);","\tvec3 rgb = (luminance + shadow + highlight) * (pixel.rgb / vec3(luminance));","\tgl_FragColor = vec4(rgb, pixel.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},highlights:{type:"number",uniform:"highlights",min:0,max:1,defaultValue:1},shadows:{type:"number",uniform:"shadows",min:0,max:1,defaultValue:0}},title:"Highlights/Shadows",description:"Darken highlights, lighten shadows"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("hue-saturation",{commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 projection;","uniform mat4 transform;","uniform float hue;","uniform float saturation;","varying vec2 vTexCoord;","varying vec3 weights;","void main(void) {","\tfloat angle = hue * 3.14159265358979323846264;","\tfloat s = sin(angle);","\tfloat c = cos(angle);","\tweights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position = screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tvTexCoord = texCoord;","}"].join("\n"),t.fragment=["precision mediump float;","varying vec2 vTexCoord;","varying vec3 weights;","uniform sampler2D source;","uniform float hue;","uniform float saturation;","void main(void) {","\tvec4 color = texture2D(source, vTexCoord);","\tfloat len = length(color.rgb);","\tcolor.rgb = vec3(dot(color.rgb, weights.xyz), dot(color.rgb, weights.zxy), dot(color.rgb, weights.yzx) );","\tvec3 adjustment = (color.r + color.g + color.b) / 3.0 - color.rgb;","\tif (saturation > 0.0) {","\t\tadjustment *= (1.0 - 1.0 / (1.0 - saturation));","\t} else {","\t\tadjustment *= (-saturation);","\t}","\tcolor.rgb += adjustment;","\tgl_FragColor = color;","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},hue:{type:"number",uniform:"hue",defaultValue:.4,min:-1,max:1},saturation:{type:"number",uniform:"saturation",defaultValue:0,min:-1,max:1}},title:"Hue/Saturation",description:"Rotate hue and multiply saturation."})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("invert",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","void main(void) {","\tgl_FragColor = texture2D(source, vTexCoord);","\tgl_FragColor = vec4(1.0 - gl_FragColor.rgb, gl_FragColor.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Invert",description:"Invert image color"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("kaleidoscope",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float segments;","uniform float offset;","const float PI = "+Math.PI+";","const float TAU = 2.0 * PI;","void main(void) {","\tif (segments == 0.0) {","\t\tgl_FragColor = texture2D(source, vTexCoord);","\t} else {","\t\tvec2 centered = vTexCoord - 0.5;","\t\tfloat r = length(centered);","\t\tfloat theta = atan(centered.y, centered.x);","\t\ttheta = mod(theta, TAU / segments);","\t\ttheta = abs(theta - PI / segments);","\t\tvec2 newCoords = r * vec2(cos(theta), sin(theta)) + 0.5;","\t\tgl_FragColor = texture2D(source, mod(newCoords - offset, 1.0));","\t}","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},segments:{type:"number",uniform:"segments",defaultValue:6},offset:{type:"number",uniform:"offset",defaultValue:0}},title:"Kaleidoscope"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";var t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),i=/\d+/;e.plugin("layers",function(e){function o(){n.resize()}var r=void 0,n=this,s={clear:!1},a=void 0,u=void 0;for("number"==typeof e&&e>=2?r=e:(r=e&&e.count||4,r=Math.max(2,r)),u={sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection"],update:function(){this.resize()}}},a=0;a<r;a++)u.sizeMode.options.push(a.toString()),u.sizeMode.options.push("source"+a),u["source"+a]={type:"image",update:o},u["opacity"+a]={type:"number",defaultValue:1,min:0,max:1,updateSources:!0};return this.uniforms.layerResolution=[1,1],this.resize=function(){var e=void 0,t=void 0,o=this.inputs.sizeMode,n=void 0,s=void 0,a=void 0,u=void 0;if("union"===o)for(e=0,t=0,n=0;n<r;n++)(a=this.inputs["source"+n])&&(e=Math.max(e,a.width),t=Math.max(t,a.height));else if("intersection"===o)for(e=1/0,t=1/0,n=0;n<r;n++)(a=this.inputs["source"+n])&&(e=Math.min(e,a.width),t=Math.min(t,a.height));else e=1,t=1,s=r-1,u=i.exec(this.inputs.sizeMode),u&&(s=Math.min(parseInt(u[0],10),s)),(a=this.inputs["source"+s])&&(e=a.width,t=a.height);if(this.width!==e||this.height!==t)for(this.width=e,this.height=t,this.uniforms.resolution[0]=e,this.uniforms.resolution[1]=t,this.frameBuffer&&this.frameBuffer.resize(e,t),this.emit("resize"),this.setDirty(),n=0;n<this.targets.length;n++)this.targets[n].resize()},{initialize:function(e){var t=this.gl;e(),s.blendEquation=t.FUNC_ADD,s.srcRGB=t.SRC_ALPHA,s.dstRGB=t.ONE_MINUS_SRC_ALPHA,s.srcAlpha=t.SRC_ALPHA,s.dstAlpha=t.DST_ALPHA},commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform vec2 layerResolution;","uniform mat4 transform;","varying vec2 vTexCoord;","void main(void) {","\tvec4 screenPosition = vec4(position.xy * layerResolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / layerResolution;","\tgl_Position.z = screenPosition.z * 2.0 / (layerResolution.x / layerResolution.y);","\tgl_Position.xy *= layerResolution / resolution;","\tgl_Position.w = screenPosition.w;","\tvTexCoord = texCoord;","}\n"].join("\n"),t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float opacity;","void main(void) {","\tif (any(lessThan(vTexCoord, vec2(0.0))) || any(greaterThanEqual(vTexCoord, vec2(1.0)))) {","\t\tgl_FragColor = vec4(0.0);","\t} else {","\t\tgl_FragColor = texture2D(source, vTexCoord);","\t\tgl_FragColor *= opacity;","\t}","}"].join("\n"),t},requires:function(e,t){var o=void 0,n=r;return o=i.exec(this.inputs.sizeMode),o&&(n=parseInt(o[0],10)),!(n>=r||!t[e]||!t["opacity"+n])},draw:function(e,i,o,n,a){var u=void 0,l=void 0,c=void 0,f=this.gl;for(f.viewport(0,0,this.width,this.height),f.bindFramebuffer(f.FRAMEBUFFER,n),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT),u=0;u<r;u++)c=this.inputs["source"+u],l=this.inputs["opacity"+u],c&&l&&(o.opacity=l,o.layerResolution[0]=c.width,o.layerResolution[1]=c.height,o.source=c,o.transform=c.cumulativeMatrix||t,a(e,i,o,n,null,s))},inputs:u}},{inPlace:!0,description:"Multiple layers",title:"Layers"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("linear-transfer",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec4 slope;","uniform vec4 intercept;","const vec3 half3 = vec3(0.5);","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tgl_FragColor = pixel * slope + intercept;","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},slope:{type:"vector",dimensions:4,uniform:"slope",defaultValue:[1,1,1,1]},intercept:{type:"vector",uniform:"intercept",dimensions:4,defaultValue:[0,0,0,0]}},title:"Linear Transfer",description:"For each color channel: [slope] * [value] + [intercept]"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("lumakey",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float threshold;","uniform float clipBlack;","uniform float clipWhite;","uniform bool invert;","const vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);","void main (void)  {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat luma = dot(pixel.rgb,lumcoeff);","\tfloat alpha = 1.0 - smoothstep(clipBlack, clipWhite, luma);","\tif (invert) alpha = 1.0 - alpha;","\tgl_FragColor = vec4(pixel.rgb, min(pixel.a, alpha) );","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},clipBlack:{type:"number",uniform:"clipBlack",defaultValue:.9,min:0,max:1},clipWhite:{type:"number",uniform:"clipWhite",defaultValue:1,min:0,max:1},invert:{type:"boolean",uniform:"invert",defaultValue:!1}},title:"Luma Key",categories:["key"],description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("lut",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform sampler2D lut;","uniform float amount;","void main(void) {","\tvec4 textureColor = texture2D(source, vTexCoord);","\ttextureColor = clamp(textureColor, 0.0, 1.0);","\tfloat blueColor = textureColor.b * 63.0;","\tvec2 quad1;","\tquad1.y = floor(floor(blueColor) / 8.0);","\tquad1.x = floor(blueColor) - (quad1.y * 8.0);","\tvec2 quad2;","\tquad2.y = floor(ceil(blueColor) / 8.0);","\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);","\tvec2 texPos1;","\ttexPos1 = (quad1 * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.rg);","\tvec2 texPos2;","\ttexPos2 = (quad2 * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.rg);","\tlowp vec4 newColor1 = texture2D(lut, vec2(texPos1.x, 1.0 - texPos1.y));","\tlowp vec4 newColor2 = texture2D(lut, vec2(texPos2.x, 1.0 - texPos2.y));","\tvec4 newColor = mix(newColor1, newColor2, fract(blueColor));","\tgl_FragColor = mix(textureColor, newColor, amount);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},lut:{type:"image",uniform:"lut"},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:1}},title:"Color Look-Up Table",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("mirror",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","uniform vec2 resolution;","uniform sampler2D source;","varying vec2 vTexCoord;","void main(void) {","\tgl_FragColor = texture2D(source, vec2(0.5 - abs(0.5 - vTexCoord.x), vTexCoord.y));","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Mirror",description:"Shader Mirror Effect"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("nightvision",{commonShader:!0,shader:function(e,t,i){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float time;","uniform float luminanceThreshold;","uniform float amplification;","uniform vec3 nightVisionColor;",i.shader.makeNoise,"void main(void) {","\tvec3 noise = vec3(makeNoise(vTexCoord.x, vTexCoord.y, time), makeNoise(vTexCoord.x, vTexCoord.y, time * 200.0 + 1.0), makeNoise(vTexCoord.x, vTexCoord.y, time * 100.0 + 3.0));","\tvec4 pixel = texture2D(source, vTexCoord + noise.xy * 0.0025);","\tfloat luminance = dot(vec3(0.299, 0.587, 0.114), pixel.rgb);","\tpixel.rgb *= step(luminanceThreshold, luminance) * amplification;","\tgl_FragColor = vec4( (pixel.rgb + noise * 0.1) * nightVisionColor, pixel.a);","}"].join("\n"),t},inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",uniform:"time",defaultValue:0,mod:65536},luminanceThreshold:{type:"number",uniform:"luminanceThreshold",defaultValue:.1,min:0,max:1},amplification:{type:"number",uniform:"amplification",defaultValue:1.4,min:0},color:{type:"color",uniform:"nightVisionColor",defaultValue:[.1,.95,.2]}},title:"Night Vision",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("noise",{shader:function(e,t,i){var o=["precision mediump float;","#define Blend(base, blend, funcf)\t\tvec3(funcf(base.r, blend.r), funcf(base.g, blend.g), funcf(base.b, blend.b))","#define BlendOverlayf(base, blend) (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)))","#define BlendOverlay(base, blend)\t\tBlend(base, blend, BlendOverlayf)","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","uniform float amount;","uniform float time;",i.shader.noiseHelpers,i.shader.snoise3d,i.shader.random,"void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat r = random(vec2(time * vTexCoord.xy));","\tfloat noise = snoise(vec3(vTexCoord * (1024.4 + r * 512.0), time)) * 0.5;"];return e.overlay?(o.push("\tvec3 overlay = BlendOverlay(pixel.rgb, vec3(noise));"),o.push("\tpixel.rgb = mix(pixel.rgb, overlay, amount);")):o.push("\tpixel.rgb += noise * amount;"),o.push("\tgl_FragColor = pixel;}"),t.fragment=o.join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},overlay:{type:"boolean",shaderDirty:!0,defaultValue:!0},amount:{type:"number",uniform:"amount",min:0,max:1,defaultValue:1},time:{type:"number",uniform:"time",defaultValue:0,mod:65536}},title:"Noise",description:"Add noise"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("opticalflow",function(){var t=void 0,i=void 0;return{initialize:function(o){t=new e.util.FrameBuffer(this.gl,this.width,this.height),o(),i=this.baseShader},resize:function(){t.resize(this.width,this.height)},commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform sampler2D previous;","uniform vec2 resolution;","uniform vec2 scale;","uniform float offsetX;","uniform float lambda;","void main() {","\tvec4 a = texture2D(previous, vTexCoord);","\tvec4 b = texture2D(source, vTexCoord);","\tvec2 offset = offsetX / resolution;","\tvec2 x1 = vec2(offset.x, 0.0);","\tvec2 y1 = vec2(0.0, offset.y);","\tvec4 curdif = b - a;","\tvec4 gradx = texture2D(source, vTexCoord + x1) - texture2D(source, vTexCoord - x1);","\tgradx += texture2D(previous, vTexCoord + x1) - texture2D(previous, vTexCoord - x1);","\tvec4 grady = texture2D(source, vTexCoord + y1) - texture2D(source, vTexCoord - y1);","\tgrady += texture2D(previous, vTexCoord + y1) - texture2D(previous, vTexCoord - y1);","\tvec4 gradmag = sqrt((gradx * gradx) + (grady * grady) + vec4(lambda));","\tvec4 vx = curdif * (gradx / gradmag);","\tfloat vxd = vx.r;","\tvec2 xout = vec2(max(vxd, 0.0), abs(min(vxd, 0.0))) * scale.x;","\tvec4 vy = curdif * (grady / gradmag);","\tfloat vyd = vy.r;","\tvec2 yout = vec2(max(vyd, 0.0), abs(min(vyd, 0.0))) * scale.y;","\tgl_FragColor = clamp(vec4(xout.xy, yout.xy), 0.0, 1.0);","\tgl_FragColor.a = 1.0;","}"].join("\n"),t},draw:function(e,o,r,n,s){r.previous=t.texture,s(e,o,r,n),s(i,o,r,t.frameBuffer)},destroy:function(){t&&(t.destroy(),t=null)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},lambda:{type:"number",uniform:"lambda",min:0,defaultValue:0,description:"noise limiting"},scaleResult:{type:"vector",dimensions:2,uniform:"scale",defaultValue:[1,1]},offset:{type:"number",uniform:"offsetX",defaultValue:1,min:1,max:100,description:"distance between texel samples for gradient calculation"}},description:"Horn-Schunke Optical Flow",title:"Optical Flow"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("panorama",function(){function e(){t.resize()}var t=this;return this.resize=function(){var e=this.width,i=this.height,o=t.inputs.source,r=void 0;for(this.source?(e=this.source.width,i=this.source.height):this.sources&&this.sources.source?(e=this.sources.source.width,i=this.sources.source.height):(e=1,i=1),t.inputs.width?(e=t.inputs.width,t.inputs.height?i=t.inputs.height:o&&(i=e*o.height/o.width)):t.inputs.height&&(i=t.inputs.height,o&&(e=i*o.width/o.height)),e=Math.floor(e),i=Math.floor(i),o&&(this.uniforms.resolution[0]=e,this.uniforms.resolution[1]=i),this.width===e&&this.height===i||(this.width=e,this.height=i,this.frameBuffer&&this.frameBuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty()),r=0;r<this.targets.length;r++)this.targets[r].resize()},{shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform vec2 resolution;","uniform sampler2D source;","uniform float fov;","uniform float yaw;","uniform float pitch;","const float M_PI = 3.141592653589793238462643;","const float M_TWOPI = 6.283185307179586476925286;","mat3 rotationMatrix(vec2 euler) {","\tvec2 se = sin(euler);","\tvec2 ce = cos(euler);","\treturn mat3(ce.x, 0, -se.x, 0, 1, 0, se.x, 0, ce.x) * ","\t\t\tmat3(1, 0, 0, 0, ce.y, -se.y, 0, se.y, ce.y);","}","vec3 toCartesian( vec2 st ) {","\treturn normalize(vec3(st.x, st.y, 0.5 / tan(0.5 * radians(fov))));","}","vec2 toSpherical(vec3 cartesianCoord) {","\tvec2 st = vec2(","\t\tatan(cartesianCoord.x, cartesianCoord.z),","\t\tacos(cartesianCoord.y)","\t);","\tif(st.x < 0.0)","\t\tst.x += M_TWOPI;","\treturn st;","}","void main(void) {","\tvec2 sphericalCoord = gl_FragCoord.xy / resolution - vec2(0.5);","\tsphericalCoord.y *= -resolution.y / resolution.x;","\tvec3 cartesianCoord = rotationMatrix(radians(vec2(yaw + 180., -pitch))) * toCartesian(sphericalCoord);","\tgl_FragColor = texture2D(source, toSpherical( cartesianCoord )/vec2(M_TWOPI, M_PI));","}"].join("\n"),t},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},width:{type:"number",min:0,step:1,update:e,defaultValue:640},height:{type:"number",min:0,step:1,update:e,defaultValue:360},yaw:{type:"number",uniform:"yaw",min:0,max:360,defaultValue:0},fov:{type:"number",uniform:"fov",min:0,max:180,defaultValue:80},pitch:{type:"number",uniform:"pitch",min:-90,max:90,defaultValue:0}}}},{commonShader:!0,title:"Panorama"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("pixelate",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","uniform vec2 pixelSize;","void main(void) {","\tvec2 delta = pixelSize / resolution;","\tgl_FragColor = texture2D(source, delta * floor(vTexCoord / delta));","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},pixelSize:{type:"vector",dimensions:2,defaultValue:[8,8],min:0,uniform:"pixelSize"}},title:"Pixelate"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("polar",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float angle;","const float PI = "+Math.PI+";","void main(void) {","\tvec2 norm = (1.0 - vTexCoord) * 2.0 - 1.0;","\tfloat theta = mod(PI + atan(norm.x, norm.y) - angle * (PI / 180.0), PI * 2.0);","\tvec2 polar = vec2(theta / (2.0 * PI), length(norm));","\tgl_FragColor = texture2D(source, polar);","}"].join("\n"),t},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},angle:{type:"number",uniform:"angle",defaultValue:0}},title:"Polar Coordinates",description:"Convert cartesian to polar coordinates"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";var t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),i=e.util.mat4;e.plugin("repeat",function(){function e(){n.resize()}var o={clear:!1},r=new Float32Array(16),n=this;return this.resize=function(){var e=this.width,t=this.height,i=n.inputs.source,o=void 0;for(this.source?(e=this.source.width,t=this.source.height):this.sources&&this.sources.source?(e=this.sources.source.width,t=this.sources.source.height):(e=1,t=1),n.inputs.width?(e=n.inputs.width,n.inputs.height?t=n.inputs.height:i&&(t=e*i.height/i.width)):n.inputs.height&&(t=n.inputs.height,i&&(e=t*i.width/i.height)),e=Math.floor(e),t=Math.floor(t),i&&(this.uniforms.resolution[0]=i.width,this.uniforms.resolution[1]=i.height),this.width===e&&this.height===t||(this.width=e,this.height=t,this.uniforms.targetRes[0]=this.width,this.uniforms.targetRes[1]=this.height,this.frameBuffer&&this.frameBuffer.resize(this.width,this.height),this.emit("resize"),this.setDirty()),o=0;o<this.targets.length;o++)this.targets[o].resize()},this.uniforms.targetRes=[1,1],{initialize:function(e){e(),this.uniforms.transform=r},commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform vec2 targetRes;","uniform mat4 transform;","varying vec2 vTexCoord;","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position = screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.xy *= resolution / targetRes;","\tvTexCoord = texCoord;","}\n"].join("\n"),t},draw:function(e,r,n,s,a){var u=void 0,l=this.inputs.source,c=this.inputs.transform,f=c&&c.cumulativeMatrix,d=this.inputs.repeat,h=this.gl;for(f&&c.transformed?i.copy(n.transform,l&&l.cumulativeMatrix||t):d=Math.min(d,1),h.viewport(0,0,this.width,this.height),h.bindFramebuffer(h.FRAMEBUFFER,s),h.clearColor(0,0,0,0),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT),u=d-1;u>=0;u--)a(e,r,n,s,null,o),u&&i.multiply(n.transform,f,n.transform)},inputs:{source:{type:"image",uniform:"source",update:function(){e(),this.uniforms.transform=r}},transform:{type:"image"},repeat:{type:"number",step:1,min:0,defaultValue:8},width:{type:"number",min:0,step:1,update:e,defaultValue:0},height:{type:"number",min:0,step:1,update:e,defaultValue:0}}}},{inPlace:!0,description:"Draw image multiple times, transforming each time",title:"Repeat"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("ripple",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float wave;","uniform float distortion;","uniform vec2 center;","void main(void) {","\tfloat scalar = abs(1.0 - abs(distance(vTexCoord, center)));","\tfloat sinOffset = sin(wave / scalar);","\tsinOffset = clamp(sinOffset, 0.0, 1.0);","\tfloat sinSign = cos(wave / scalar);","\tsinOffset = sinOffset * distortion / 32.0;","\tgl_FragColor = texture2D(source, vTexCoord + sinOffset * sinSign);","}"].join("\n"),t},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},wave:{type:"number",uniform:"wave",defaultValue:Math.PI/.75},distortion:{type:"number",uniform:"distortion",defaultValue:1},center:{type:"vector",uniform:"center",dimensions:2,defaultValue:[.5,.5]}},title:"Ripple Distortion",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("scanlines",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float lines;","uniform float width;","uniform float intensity;","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tfloat darken = 2.0 * abs( fract(vTexCoord.y * lines / 2.0) - 0.5);","\tdarken = clamp(darken - width + 0.5, 0.0, 1.0);","\tdarken = 1.0 - ((1.0 - darken) * intensity);","\tgl_FragColor = vec4(pixel.rgb * darken, 1.0);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},lines:{type:"number",uniform:"lines",defaultValue:60},size:{type:"number",uniform:"size",defaultValue:.2,min:0,max:1},intensity:{type:"number",uniform:"intensity",defaultValue:.1,min:0,max:1}},title:"Scan Lines",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";var t=/\d+/;e.plugin("select",function(e){function i(){n.resize()}function o(){var e=n.inputs.active,t=void 0;t=n.inputs["source"+e],n.texture=t&&t.texture,i()}var r=void 0,n=this,s=void 0,a=void 0;for("number"==typeof e&&e>=2?r=e:(r=e&&e.count||4,r=Math.max(2,r)),a={active:{type:"number",step:1,min:0,max:r-1,defaultValue:0,update:o,updateSources:!0},sizeMode:{type:"enum",defaultValue:"0",options:["union","intersection","active"],update:i}},s=0;s<r;s++)a.sizeMode.options.push(s.toString()),a.sizeMode.options.push("source"+s),a["source"+s]={type:"image",update:o};return this.uniforms.layerResolution=[1,1],this.resize=function(){var e=void 0,i=void 0,o=this.inputs.sizeMode,n=void 0,s=void 0,a=void 0,u=void 0;if("union"===o)for(e=0,i=0,n=0;n<r;n++)(a=this.inputs["source"+n])&&(e=Math.max(e,a.width),i=Math.max(i,a.height));else if("intersection"===o)for(e=1/0,i=1/0,n=0;n<r;n++)(a=this.inputs["source"+n])&&(e=Math.min(e,a.width),i=Math.min(i,a.height));else if("active"===o)n=this.inputs.active,a=this.inputs["source"+n],e=Math.max(1,a&&a.width||1),i=Math.max(1,a&&a.height||1);else for(e=1,i=1,s=r-1,u=t.exec(this.inputs.sizeMode),u&&(s=Math.min(parseInt(u[0],10),s)),n=0;n<=s;n++)if(a=this.inputs["source"+n]){e=a.width,i=a.height;break}for(this.width===e&&this.height===i||(this.width=e,this.height=i,this.emit("resize"),this.setDirty()),n=0;n<this.targets.length;n++)this.targets[n].resize()},{initialize:function(){this.initialized=!0,this.shaderDirty=!1},requires:function(e){return!(!this.inputs[e]||e!=="source"+this.inputs.active)},draw:function(){var e=n.inputs.active,t=void 0;t=n.inputs["source"+e],n.texture=t&&t.texture},inputs:a}},{title:"Select",description:"Select a single source image from a list of source nodes.",inPlace:!1,commonShader:!0})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("sepia",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec4 light;","uniform vec4 dark;","uniform float desat;","uniform float toned;","const mat4 coeff = mat4(0.393, 0.349, 0.272, 1.0,0.796, 0.686, 0.534, 1.0, 0.189, 0.168, 0.131, 1.0, 0.0, 0.0, 0.0, 1.0 );","void main(void) {","\tvec4 sourcePixel = texture2D(source, vTexCoord);","\tgl_FragColor = coeff * sourcePixel;","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"}},title:"Sepia",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("simplex",function(){function e(){t.resize()}var t=this;return{shader:function(e,t,i){function o(e){return e-Math.floor(e)==0?e+".0":e}var r=1,n=1,s=void 0,a=0;for(t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform float amount;","uniform vec2 noiseScale;","uniform vec2 noiseOffset;","uniform float time;","uniform vec4 black;","uniform vec4 white;",i.shader.noiseHelpers,i.shader.snoise3d,"void main(void) {","\tfloat total = 0.0;","\tvec3 pos = vec3(vTexCoord.xy * noiseScale + noiseOffset, time);"].join("\n"),s=0;s<e.octaves;s++)r=Math.pow(2,s),n=Math.pow(e.persistence,s),a+=n,t.fragment+="\ttotal += snoise(pos * "+o(r)+") * "+o(n)+";\n";return t.fragment+=["\ttotal *= amount / "+o(a)+";","\ttotal = (total + 1.0)/ 2.0;","\tgl_FragColor = mix(black, white, total);","}"].join("\n"),t},inputs:{noiseScale:{type:"vector",dimensions:2,uniform:"noiseScale",defaultValue:[1,1]},noiseOffset:{type:"vector",dimensions:2,uniform:"noiseOffset",defaultValue:[0,0]},octaves:{type:"number",shaderDirty:!0,min:1,max:8,step:1,defaultValue:1},persistence:{type:"number",defaultValue:.5,min:0,max:.5},amount:{type:"number",uniform:"amount",min:0,defaultValue:1},time:{type:"number",uniform:"time",defaultValue:0},width:{type:"number",min:0,step:1,update:e,defaultValue:0},height:{type:"number",min:0,step:1,update:e,defaultValue:0},black:{type:"color",uniform:"black",defaultValue:[0,0,0,1]},white:{type:"color",uniform:"white",defaultValue:[1,1,1,1]}}}},{title:"Simplex Noise",description:"Generate Simplex Noise"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("sketch",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec2 resolution;","float res = resolution.x;","float n0 = 97.0 / res;","float n1 = 15.0 / res;","float n2 = 97.0 / res;","float n3 = 9.7 / res;","float total = n2 + ( 4.0 * n0 ) + ( 4.0 * n1 );","const vec3 div3 = vec3(1.0 / 3.0);","void main(void) {","\tfloat offset, temp1, temp2;","\tvec4 m, p0, p1, p2, p3, p4, p5, p6, p7, p8;","\toffset = n3;","\tp0=texture2D(source,vTexCoord);","\tp1=texture2D(source,vTexCoord+vec2(-offset,-offset));","\tp2=texture2D(source,vTexCoord+vec2( offset,-offset));","\tp3=texture2D(source,vTexCoord+vec2( offset, offset));","\tp4=texture2D(source,vTexCoord+vec2(-offset, offset));","\toffset=n3*2.0;","\tp5=texture2D(source,vTexCoord+vec2(-offset,-offset));","\tp6=texture2D(source,vTexCoord+vec2( offset,-offset));","\tp7=texture2D(source,vTexCoord+vec2( offset, offset));","\tp8=texture2D(source,vTexCoord+vec2(-offset, offset));","\tm = (p0 * n2 + (p1 + p2 + p3 + p4) * n0 + (p5 + p6 + p7 + p8) * n1) / total;","\ttemp1 = dot(p0.rgb, div3);","\ttemp2 = dot(m.rgb, div3);","\tif (temp2 <= 0.0005) {","\t\tgl_FragColor = vec4( 1.0, 1.0, 1.0, p0.a);","\t} else {","\t\tgl_FragColor = vec4( vec3(min(temp1 / temp2, 1.0)), p0.a);","\t}","}"].join("\n"),t},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1}},title:"Sketch",description:"Pencil/charcoal sketch"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("split",function(){var e=void 0,t=[1,1],i=[1,1];return this.resize=function(){var e=void 0,o=void 0,r=this.inputs.sizeMode,n=void 0,s=void 0,a=void 0,u=this.inputs.sourceA,l=this.inputs.sourceB;for("a"===r||"b"===r?(n="a"===r?u:l,n?(e=n.width,o=n.height):(e=1,o=1)):u?l?(s="union"===r?Math.max:Math.min,e=s(u.width,l.width),o=s(u.height,l.height)):(e=u.width,o=u.height):l?(e=l.width,o=l.height):(e=1,o=1),this.width===e&&this.height===o||(this.width=e,this.height=o,this.uniforms.resolution[0]=e,this.uniforms.resolution[1]=o,this.frameBuffer&&this.frameBuffer.resize(e,o),this.emit("resize"),this.setDirty()),u&&(t[0]=u.width,t[1]=u.height),l&&(i[0]=l.width,i[1]=l.height),a=0;a<this.targets.length;a++)this.targets[a].resize()},{initialize:function(o){o(),this.uniforms.resolutionA=t,this.uniforms.resolutionB=i,e=this.baseShader},commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform vec2 resolutionA;","uniform vec2 resolutionB;","uniform mat4 projection;","varying vec2 vTexCoord;","varying vec2 vTexCoordA;","varying vec2 vTexCoordB;","uniform float angle;","varying float c;","varying float s;","varying float t;","void main(void) {","   c = cos(angle);","   s = sin(angle);","\tt = abs(c + s);","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tvec2 adjustedTexCoord = (texCoord - 0.5) * resolution;","\tvTexCoordA = adjustedTexCoord / resolutionA + 0.5;","\tvTexCoordB = adjustedTexCoord / resolutionB + 0.5;","\tvTexCoord = texCoord;","}"].join("\n"),t.fragment=["precision mediump float;\n","varying vec2 vTexCoord;","varying vec2 vTexCoordA;","varying vec2 vTexCoordB;","varying float c;","varying float s;","varying float t;","uniform sampler2D sourceA;","uniform sampler2D sourceB;","uniform float split;","uniform float angle;","uniform float fuzzy;","uniform float blendGamma;","vec4 textureLookup(sampler2D tex, vec2 texCoord, vec3 exp) {","\tif (any(lessThan(texCoord, vec2(0.0))) || any(greaterThan(texCoord, vec2(1.0)))) {","\t\treturn vec4(0.0);","\t} else {","\t\tvec4 pixel = texture2D(tex, texCoord);","\t\tpixel.rgb = pow(pixel.rgb, exp);","\t\treturn pixel;","\t}","}","void main(void) {","\tvec3 exp = vec3(blendGamma);","\tvec4 pixel1 = textureLookup(sourceA, vTexCoordA, exp);","\tvec4 pixel2 = textureLookup(sourceB, vTexCoordB, exp);","\tfloat mn = (split - fuzzy * (1.0 - split));","\tfloat mx = (split + fuzzy * split);;","\tvec2 coords = vTexCoord - vec2(0.5);","\tcoords = vec2(coords.x * c - coords.y * s, coords.x * s + coords.y * c);","\tfloat scale = max(abs(c - s), abs(s + c));","\tcoords /= scale;","\tcoords += vec2(0.5);","\tfloat x = coords.x;","\tgl_FragColor = mix(pixel2, pixel1, smoothstep(mn, mx, x));","\tgl_FragColor.rgb = pow(gl_FragColor.rgb, 1.0 / exp);","}"].join("\n"),t},draw:function(t,i,o,r,n){return o.split>=1?(o.source=o.sourceB,void n(e,i,o,r)):o.split<=0?(o.source=o.sourceA,void n(e,i,o,r)):void n(t,i,o,r)},inPlace:!1,requires:function(e,t){return!("sourceA"===e&&t.split>=1||"sourceB"===e&&t.split<=0)}}},{inputs:{sourceA:{type:"image",uniform:"sourceA",shaderDirty:!1,update:function(){this.resize()}},sourceB:{type:"image",uniform:"sourceB",shaderDirty:!1,update:function(){this.resize()}},sizeMode:{type:"enum",defaultValue:"a",options:["a","b","union","intersection"],update:function(){this.resize()}},split:{type:"number",uniform:"split",defaultValue:.5,min:0,max:1,updateSources:!0},angle:{type:"number",uniform:"angle",defaultValue:0},fuzzy:{type:"number",uniform:"fuzzy",defaultValue:0,min:0,max:1},blendGamma:{type:"number",uniform:"blendGamma",defaultValue:2.2,min:0,max:4}},description:"Split screen or wipe",title:"Split"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("temperature",{commonShader:!0,shader:function(e,t){return t.vertex=["precision mediump float;","attribute vec4 position;","attribute vec2 texCoord;","uniform vec2 resolution;","uniform mat4 transform;","uniform float temperature;","varying vec2 vTexCoord;","varying vec3 tempFactor;","const vec3 luma = vec3(0.2125,0.7154,0.0721);","vec3 temperatureRGB(float t) {","\tfloat temp = t / 100.0;","\tvec3 color = vec3(1.0);","\tif (temp < 66.0) {","\t\tcolor.g = 0.3900815787690196 * log(temp) - 0.6318414437886275;","\t\tcolor.b = 0.543206789110196 * log(temp - 10.0) - 1.19625408914;","\t} else {","\t\tcolor.r = 1.292936186062745 * pow(temp - 60.0, -0.1332047592);","\t\tcolor.g = 1.129890860895294 * pow(temp - 60.0, -0.0755148492);","\t}","\treturn color;","}","void main(void) {","\tvec4 screenPosition = vec4(position.xy * resolution / 2.0, position.z, position.w);","\tscreenPosition = transform * screenPosition;","\tgl_Position.xy = screenPosition.xy * 2.0 / resolution;","\tgl_Position.z = screenPosition.z * 2.0 / (resolution.x / resolution.y);","\tgl_Position.w = screenPosition.w;","\tvTexCoord = texCoord;","\tvec3 tempColor = temperatureRGB(temperature);","\ttempFactor = dot(tempColor, luma) / tempColor;","}\n"].join("\n"),t.fragment=["precision mediump float;","varying vec2 vTexCoord;","varying vec3 tempFactor;","uniform sampler2D source;","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tgl_FragColor = vec4(pixel.rgb * tempFactor, pixel.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},temperature:{type:"number",uniform:"temperature",defaultValue:6500,min:3e3,max:25e3}},title:"Color Temperature",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("throttle",function(){var e=0;return{draw:function(t,i,o,r,n){this.inputs.frameRate&&Date.now()-e>=1e3/this.inputs.frameRate&&(n(t,i,o,r),e=Date.now())},requires:function(t,i){return!!(i.frameRate&&Date.now()-e>=1e3/i.frameRate)}}},{inPlace:!0,commonShader:!0,title:"Throttle",description:"Throttle frame rate",inputs:{source:{type:"image",uniform:"source"},frameRate:{type:"number",uniform:"opacity",defaultValue:15,min:0}}})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("tone",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform vec4 light;","uniform vec4 dark;","uniform float desat;","uniform float toned;","const vec3 lumcoeff = vec3(0.2125,0.7154,0.0721);","void main(void) {","\tvec4 sourcePixel = texture2D(source, vTexCoord);","\tvec3 sceneColor = light.rgb * sourcePixel.rgb;","\tvec3 gray = vec3(dot(lumcoeff, sceneColor));","\tvec3 muted = mix(sceneColor, gray, desat);","\tvec3 tonedColor = mix(dark.rgb, light.rgb, gray);","\tgl_FragColor = vec4(mix(muted, tonedColor, toned), sourcePixel.a);","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},light:{type:"color",uniform:"light",defaultValue:[1,.9,.5,1]},dark:{type:"color",uniform:"dark",defaultValue:[.2,.05,0,1]},toned:{type:"number",uniform:"toned",defaultValue:1,minimumRange:0,maximumRange:1},desat:{type:"number",uniform:"desat",defaultValue:.5,minimumRange:0,maximumRange:1}},title:"Tone",description:""})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("tvglitch",function(){var t=void 0,i=void 0,o=void 0,r=void 0,n=void 0,s=void 0;return{initialize:function(i){var a=void 0,u=void 0,l=void 0,c=void 0,f=void 0,d=void 0;for(s=this.gl,t=this.height,d=[],u=.3-.02,l=.8-.2,a=0;a<20;a++)d.push(2*Math.random()-1),d.push(Math.random()*l+.2),d.push(Math.random()*u+.02),d.push(.2*Math.random());o=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,o),s.bufferData(s.ARRAY_BUFFER,new Float32Array(d),s.STATIC_DRAW),o.itemSize=4,o.numItems=20,c=["#define SHADER_NAME seriously.tvglitch.particle","precision mediump float;","attribute vec4 particle;","uniform float time;","uniform float height;","varying float intensity;","void main(void) {","\tfloat y = particle.x + time * particle.y;","\ty = fract((y + 1.0) / 2.0) * 4.0 - 2.0;","\tintensity = particle.w;","\tgl_Position = vec4(0.0, -y , 1.0, 2.0);","\tgl_PointSize = height * particle.z;","}"].join("\n"),f=["#define SHADER_NAME seriously.tvglitch.particle","precision mediump float;","varying float intensity;","void main(void) {","\tgl_FragColor = vec4(1.0);","\tgl_FragColor.a = 2.0 * intensity * (1.0 - abs(gl_PointCoord.y - 0.5));","}"].join("\n"),r=new e.util.ShaderProgram(s,c,f),n=new e.util.FrameBuffer(s,1,Math.max(1,this.height/2)),i()},commonShader:!0,shader:function(t,i){return i.fragment=["precision mediump float;","#define HardLight(top, bottom)  (1.0 - 2.0 * (1.0 - top) * (1.0 - bottom))","varying vec2 vTexCoord;","uniform sampler2D source;","uniform sampler2D particles;","uniform float time;","uniform float scanlines;","uniform float lineSync;","uniform float lineHeight;","uniform float distortion;","uniform float vsync;","uniform float bars;","uniform float frameSharpness;","uniform float frameShape;","uniform float frameLimit;","uniform vec4 frameColor;",e.util.shader.noiseHelpers+e.util.shader.snoise2d+"void main(void) {","\tvec2 texCoord = vTexCoord;","\tfloat drandom = snoise(vec2(time * 10.0, texCoord.y /lineHeight));","\tfloat distortAmount = distortion * (drandom - 0.25) * 0.5;","\tvec4 particleOffset = texture2D(particles, vec2(0.0, texCoord.y));","\tdistortAmount -= lineSync * (2.0 * particleOffset.a - 0.5);","\ttexCoord.x -= distortAmount;","\ttexCoord.x = mod(texCoord.x, 1.0);","\tfloat roll;","\tif (vsync != 0.0) {","\t\troll = fract(time / vsync);","\t\ttexCoord.y = mod(texCoord.y - roll, 1.0);","\t}","\tvec4 pixel = texture2D(source, texCoord);","\tfloat barsAmount = particleOffset.r;","\tif (barsAmount > 0.0) {","\t\tpixel = vec4(pixel.r + bars * barsAmount,pixel.g + bars * barsAmount,pixel.b + bars * barsAmount,pixel.a);","\t}","\tif (mod(texCoord.y / lineHeight, 2.0) < 1.0 ) {","\t\tpixel.rgb *= (1.0 - scanlines);","\t}","\tfloat f = (1.0 - gl_FragCoord.x * gl_FragCoord.x) * (1.0 - gl_FragCoord.y * gl_FragCoord.y);","\tfloat frame = clamp( frameSharpness * (pow(f, frameShape) - frameLimit), 0.0, 1.0);","\tgl_FragColor = mix(frameColor, pixel, frame);","}"].join("\n"),i},resize:function(){n&&n.resize(1,Math.max(1,this.height/2))},draw:function(e,a,u,l,c){var f=i!==this.inputs.time,d=void 0;t!==this.height&&(t=this.height,f=!0),u.lineHeight=1/this.height,this.inputs.verticalSync?(d=.2/this.inputs.verticalSync,u.vsync=d):(d=1,u.vsync=0),u.time=this.inputs.time%(1e3*d),u.distortion=Math.random()*this.inputs.distortion,f&&(this.inputs.lineSync||this.inputs.bars)&&(r.use(),s.viewport(0,0,1,this.height/2),s.bindFramebuffer(s.FRAMEBUFFER,n.frameBuffer),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enableVertexAttribArray(r.location.particle),s.bindBuffer(s.ARRAY_BUFFER,o),s.vertexAttribPointer(r.location.particle,o.itemSize,s.FLOAT,!1,0,0),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE),r.time.set(u.time*this.inputs.barsRate),r.height.set(this.height),s.drawArrays(s.POINTS,0,20),i=this.inputs.time),u.particles=n.texture,c(e,a,u,l)},destroy:function(){o=null,n&&(n.destroy(),n=null)}}},{inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},time:{type:"number",defaultValue:0},distortion:{type:"number",defaultValue:.1,min:0,max:1},verticalSync:{type:"number",defaultValue:.1,min:0,max:1},lineSync:{type:"number",uniform:"lineSync",defaultValue:.2,min:0,max:1},scanlines:{type:"number",uniform:"scanlines",defaultValue:.3,min:0,max:1},bars:{type:"number",uniform:"bars",defaultValue:0,min:0,max:1},barsRate:{type:"number",defaultValue:1},frameShape:{type:"number",uniform:"frameShape",min:0,max:2,defaultValue:.27},frameLimit:{type:"number",uniform:"frameLimit",min:-1,max:1,defaultValue:.34},frameSharpness:{type:"number",uniform:"frameSharpness",min:0,max:40,defaultValue:8.4},frameColor:{type:"color",uniform:"frameColor",defaultValue:[0,0,0,1]}},title:"TV Glitch"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("vibrance",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float amount;","void main(void) {","\tvec4 color = texture2D(source, vTexCoord);","\tfloat average = (color.r + color.g + color.b) / 3.0;","\tfloat mx = max(color.r, max(color.g, color.b));","\tfloat amt = (mx - average) * (-3.0 * amount);","\tcolor.rgb = mix(color.rgb, vec3(mx), amt);","\tgl_FragColor = color;","}"].join("\n"),t},inPlace:!0,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:0,min:-1,max:1}},title:"Vibrance",description:"Non-peaking saturation effect"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";e.plugin("vignette",{commonShader:!0,shader:function(e,t){return t.fragment=["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float amount;","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","\tvec2 pos = vTexCoord.xy - 0.5;","\tfloat vignette = 1.0 - (dot(pos, pos) * amount);","\tgl_FragColor = vec4(pixel.rgb * vignette, pixel.a);","}"].join("\n"),t},inPlace:!1,inputs:{source:{type:"image",uniform:"source"},amount:{type:"number",uniform:"amount",defaultValue:1,min:0}},title:"Vignette",description:"Vignette"})})},function(e,t,i){var o,r,n;!function(s,a){"use strict";r=[i(87)],o=a,void 0!==(n="function"==typeof o?o.apply(t,r):o)&&(e.exports=n)}(window,function(e){"use strict";var t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);e.plugin("whitebalance",function(){function i(i,o){var c=void 0,d=void 0,h=void 0,m=void 0;if((n!==i||s!==o)&&(n=i,s=o,d=Math.ceil(Math.log(Math.max(o,i))/u),c=Math.pow(2,d),c>f&&(d=Math.ceil(Math.log(f)/u),c=f),d++,a!==c)){for(a=c;r.length>d;)r.pop().fb.destroy();for(;r.length<d;)m=r.length,h=Math.pow(2,m),r.push({fb:new e.util.FrameBuffer(l.gl,h,h),opts:{width:h,height:h},uniforms:{level:r.length,offset:.25/h,transform:t,projection:t,resolution:[h,h]}}),m&&(r[m-1].uniforms.source=r[m].fb.texture)}}var o=void 0,r=[],n=void 0,s=void 0,a=void 0,u=Math.log(2),l=this,c=void 0,f=void 0;return{initialize:function(e){c=this.gl,f=c.getParameter(c.MAX_TEXTURE_SIZE),this.inputs.auto&&i(this.width,this.height),e()},shader:function(t,i){var r=t.auto;return r&&!o&&(o=new e.util.ShaderProgram(this.gl,i.vertex,["precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","uniform float offset;","uniform int level;","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord - vec2(offset)) +","\t\ttexture2D(source, vTexCoord + vec2(offset, -offset)) +","\t\ttexture2D(source, vTexCoord + vec2(offset)) +","\t\ttexture2D(source, vTexCoord + vec2(-offset, offset));","\tpixel /= 4.0;","\tgl_FragColor = pixel;","}"].join("\n"))),i.fragment=[r?"#define AUTO":"","precision mediump float;","varying vec2 vTexCoord;","uniform sampler2D source;","#ifdef AUTO","uniform sampler2D whiteSource;","#else","uniform vec4 white;","#endif","const vec3 luma = vec3(0.2125, 0.7154, 0.0721);","void main(void) {","\tvec4 pixel = texture2D(source, vTexCoord);","#ifdef AUTO","\tvec4 white = texture2D(whiteSource, vTexCoord);","#endif","\tvec3 target = vec3(dot(white.rgb, luma));","\tpixel.rgb = pixel.rgb * target / white.rgb;","\tgl_FragColor = pixel;","}"].join("\n"),i},resize:function(){this.gl&&this.inputs.auto&&i(this.width,this.height)},draw:function(e,t,i,n,s){var a=void 0,u=void 0;if(this.inputs.auto){for(a=r.length-1,r[a].uniforms.source=i.source;a>=0;)u=r[a],s(o,t,u.uniforms,u.fb.frameBuffer,null,u.opts),a--;i.whiteSource=r[0].fb.texture}s(e,t,i,n)},destroy:function(){for(;r.length;)r.pop().destroy()},inPlace:!1,inputs:{source:{type:"image",uniform:"source",shaderDirty:!1},white:{type:"color",uniform:"white",defaultValue:[1,1,1]},auto:{type:"boolean",shaderDirty:!0,defaultValue:!0}}}},{title:"White Balance"})})}]));
//# sourceMappingURL=0.a22a89bc0a187c99d724.js.map